<!DOCTYPE html>
<html data-content_root="./" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/><meta content="width=device-width, initial-scale=1" name="viewport"/>
<title>LAB: Solid State Spin Laboratory — 6.2410 -- Laboratory for Quantum Information Science and Engineering</title>
<script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
<!-- 
    this give us a css class that will be invisible only if js is disabled 
  -->
<noscript>
<style>
      .pst-js-only { display: none !important; }

    </style>
</noscript>
<!-- Loaded before other Sphinx assets -->
<link href="_static/styles/theme.css?digest=26a4bc78f4c0ddb94549" rel="stylesheet"/>
<link href="_static/styles/pydata-sphinx-theme.css?digest=26a4bc78f4c0ddb94549" rel="stylesheet"/>
<link href="_static/pygments.css?v=fa44fd50" rel="stylesheet" type="text/css"/>
<link href="_static/styles/sphinx-book-theme.css?v=a3416100" rel="stylesheet" type="text/css"/>
<link href="_static/togglebutton.css?v=13237357" rel="stylesheet" type="text/css"/>
<link href="_static/copybutton.css?v=76b2166b" rel="stylesheet" type="text/css"/>
<link href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css?v=be8a1c11" rel="stylesheet" type="text/css"/>
<link href="_static/sphinx-thebe.css?v=4fa983c6" rel="stylesheet" type="text/css"/>
<link href="_static/sphinx-design.min.css?v=95c83b7e" rel="stylesheet" type="text/css"/>
<!-- So that users can add custom icons -->
<script src="_static/scripts/fontawesome.js?digest=26a4bc78f4c0ddb94549"></script>
<!-- Pre-loaded scripts that we'll load fully later -->
<link as="script" href="_static/scripts/bootstrap.js?digest=26a4bc78f4c0ddb94549" rel="preload"/>
<link as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=26a4bc78f4c0ddb94549" rel="preload"/>
<script src="_static/documentation_options.js?v=9eb32ce0"></script>
<script src="_static/doctools.js?v=9a2dae69"></script>
<script src="_static/sphinx_highlight.js?v=dc90522c"></script>
<script src="_static/clipboard.min.js?v=a7894cd8"></script>
<script src="_static/copybutton.js?v=f281be69"></script>
<script src="_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
<script>let toggleHintShow = 'Click to show';</script>
<script>let toggleHintHide = 'Click to hide';</script>
<script>let toggleOpenOnPrint = 'true';</script>
<script src="_static/togglebutton.js?v=4a39c7ea"></script>
<script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
<script src="_static/design-tabs.js?v=f930bc37"></script>
<script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
<script async="async" src="_static/sphinx-thebe.js?v=c100c467"></script>
<script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
<script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
<script>window.MathJax = {"tex": {"macros": {"ket": ["\\left|{#1}\\right\\rangle", 1], "bra": ["\\left\\langle{#1}\\right|", 1], "braket": ["\\left\\langle{#1}\\middle|{#2}\\right\\rangle", 2], "adagger": ["\\hat{a}^{\\dagger}"], "ahat": ["\\hat{a}"], "bdagger": ["\\hat{b}^{\\dagger}"], "bhat": ["\\hat{b}"], "cdagger": ["\\hat{c}^{\\dagger}"], "chat": ["\\hat{c}"], "ddagger": ["\\hat{d}^{\\dagger}"], "dhat": ["\\hat{d}"], "edagger": ["\\hat{e}^{\\dagger}"], "ehat": ["\\hat{e}"], "fdagger": ["\\hat{f}^{\\dagger}"], "fhat": ["\\hat{f}"], "gdagger": ["\\hat{g}^{\\dagger}"], "ghat": ["\\hat{g}"], "hdagger": ["\\hat{h}^{\\dagger}"], "hhat": ["\\hat{h}"], "gtwo": ["g^{(2)}"], "H": ["\\ket{H}"], "V": ["\\ket{V}"], "D": ["\\ket{D}"], "AD": ["\\ket{AD}"]}}, "options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
<script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
<script>DOCUMENTATION_OPTIONS.pagename = 'Cavity_QED_Sensor_Bosch';</script>
<link href="genindex.html" rel="index" title="Index"/>
<link href="search.html" rel="search" title="Search"/>
<link href="TEMPLATES/TEMPLATE-6.2410-summary-report.html" rel="prev" title="Summary Report Template"/>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<meta content="en" name="docsearch:language"/>
<meta content="" name="docsearch:version"/>
<link href="_static/styles/chattutor.style.css" rel="stylesheet" type="text/css"/></head>
<body data-bs-root-margin="0px 0px -60%" data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-default-mode="" data-offset="180">
<div class="skip-link d-print-none" id="pst-skip-link"><a href="#main-content">Skip to main content</a></div>
<div id="pst-scroll-pixel-helper"></div>
<button class="btn rounded-pill" id="pst-back-to-top" type="button">
<i class="fa-solid fa-arrow-up"></i>Back to top</button>
<dialog id="pst-search-dialog">
<form action="search.html" class="bd-search d-flex align-items-center" method="get">
<i class="fa-solid fa-magnifying-glass"></i>
<input aria-label="Search this book..." autocapitalize="off" autocomplete="off" autocorrect="off" class="form-control" name="q" placeholder="Search this book..." spellcheck="false" type="search"/>
<span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
</dialog>
<div class="pst-async-banner-revealer d-none">
<aside aria-label="Version warning" class="d-none d-print-none" id="bd-header-version-warning"></aside>
</div>
<header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
</header>
<div class="bd-container">
<div class="bd-container__inner bd-page-width">
<dialog id="pst-primary-sidebar-modal"></dialog>
<div class="bd-sidebar-primary bd-sidebar" id="pst-primary-sidebar">
<div class="sidebar-header-items sidebar-primary__section">
</div>
<div class="sidebar-primary-items__start sidebar-primary__section">
<div class="sidebar-primary-item">
<a class="navbar-brand logo" href="intro.html">
<img alt="6.2410 -- Laboratory for Quantum Information Science and Engineering - Home" class="logo__image only-light" src="_static/logo-ibm.jpg"/>
<img alt="6.2410 -- Laboratory for Quantum Information Science and Engineering - Home" class="logo__image only-dark pst-js-only" src="_static/logo-ibm.jpg"/>
</a></div>
<div class="sidebar-primary-item">
<button aria-label="Search" class="btn search-button-field search-button__button pst-js-only" data-bs-placement="bottom" data-bs-toggle="tooltip" title="Search">
<i class="fa-solid fa-magnifying-glass"></i>
<span class="search-button__default-text">Search</span>
<span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button></div>
<div class="sidebar-primary-item"><nav aria-label="Main" class="bd-links bd-docs-nav">
<div class="bd-toc-item navbar-nav active">
<ul class="nav bd-sidenav bd-sidenav__home-link">
<li class="toctree-l1">
<a class="reference internal" href="intro.html">
                    6.2410 – Laboratory in Quantum Systems Engineering: Quantum Engineering Platforms
                </a>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Introductory Material</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="BASICS-quantum-optics-basics.html">BASICS – Quantum Optics</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">T3E1 -- Interference, Entanglement, Quantum-Enhanced Sensing</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="T3E1-TEXT--entanglement-interference-quantum-enhanced-sensing.html">TEXT – Interference, Entanglement and Quantum-Enhanced Metrology</a></li>
<li class="toctree-l1"><a class="reference internal" href="T3E1-LAB--entanglement-interference-quantum-enhanced-sensing.html">LAB – Interference, Entanglement and Quantum-Enhanced Metrology</a></li>
<li class="toctree-l1"><a class="reference internal" href="T3E1-EXTRAS-interference-2-homodyne-detection.html">EXTRAS – Homodyne Detection</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">T2E1 -- Quantum Information and Quantum Key Distribution</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="T2E1-TEXT-HBT.html">TEXT - Introduction to single photons with the quED (Week 1)</a></li>
<li class="toctree-l1"><a class="reference internal" href="T2E1-LAB-HBT.html">LAB – Hanbury Brown - Twiss Lab (Week 1)</a></li>
<li class="toctree-l1"><a class="reference internal" href="T2E1-TEXT-QKD.html">TEXT – QKD (Week 2)</a></li>
<li class="toctree-l1"><a class="reference internal" href="T2E1-LAB-BB84.html">LAB – QKD (Week 2)</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">T3E3 -- Solid State Spins</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="quNV-Jupyter/T3E3-PARKOUR-Quantum-Sensing-with-Solid-State-Spins.html">TRAINING - Interfacing with the Vector Network Analyzer</a></li>
<li class="toctree-l1"><a class="reference internal" href="quNV-Jupyter/T3E3-TEXT-Quantum-Sensing-with-Solid-State-Spins.html">TEXT: Introduction to NV centers in diamond and cavity-based magnetometry</a></li>
<li class="toctree-l1"><a class="reference internal" href="quNV-Jupyter/T3E3-LAB-Week1-Quantum-Sensing-with-Solid-State-Spins.html">LAB - Quantum Sensing with Solid State Spins (Week 1)</a></li>
<li class="toctree-l1"><a class="reference internal" href="quNV-Jupyter/T3E3-LAB-Week2-Quantum-Sensing-with-Solid-State-Spins.html">LAB – Quantum Sensing With Solid State Spins (Week 2)</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">T1:3E2 -- Quantum Simulation Lab</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="simulation-modules/T1-3E3-Activity-Cavity_QED_sensor.html">Activity 1: Solid State Spis – Cavity QED Digital Twin</a></li>
<li class="toctree-l1"><a class="reference internal" href="simulation-modules/T1-3E3-Activity-Compuational_HOM.html">Activity 2 – Two-photon (HOM) interference simulation</a></li>
<li class="toctree-l1"><a class="reference internal" href="simulation-modules/T1_3E2_spdc_simulation_by_qutip.html">Activity 3: SPDC Simulation by QuTip</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Final Projects</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="FINAL-PROJECTS.html">Final Design Project</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Templates</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="TEMPLATES/TEMPLATE-6.2410-summary-report.html">Summary Report Template</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">MIT Bosch Digital Twin</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 current active"><a class="current reference internal" href="#">LAB: Solid State Spin Laboratory</a></li>
</ul>
</div>
</nav></div>
</div>
<div class="sidebar-primary-items__end sidebar-primary__section">
</div>
<div id="rtd-footer-container"></div>
</div>
<main class="bd-main" id="main-content" role="main">
<div class="sbt-scroll-pixel-helper"></div>
<div class="bd-content">
<div class="bd-article-container">
<div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
<div class="header-article-items__start">
<div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" data-bs-placement="bottom" data-bs-toggle="tooltip" title="Toggle primary sidebar">
<span class="fa-solid fa-bars"></span>
</button></div>
</div>
<div class="header-article-items__end">
<div class="header-article-item">
<div class="article-header-buttons">
<div class="dropdown dropdown-launch-buttons">
<button aria-expanded="false" aria-label="Launch interactive content" class="btn dropdown-toggle" data-bs-toggle="dropdown" type="button">
<i class="fas fa-rocket"></i>
</button>
<ul class="dropdown-menu">
<li><a class="btn btn-sm dropdown-item" data-bs-placement="left" data-bs-toggle="tooltip" href="https://mybinder.org/v2/gh/dkeathley/S23-6.2410-lab/main?urlpath=tree/Cavity_QED_Sensor_Bosch.ipynb" target="_blank" title="Launch on Binder">
<span class="btn__icon-container">
<img alt="Binder logo" src="_static/images/logo_binder.svg"/>
</span>
<span class="btn__text-container">Binder</span>
</a>
</li>
<li><a class="btn btn-sm dropdown-item" data-bs-placement="left" data-bs-toggle="tooltip" href="https://colab.research.google.com/github/dkeathley/S23-6.2410-lab/blob/main/Cavity_QED_Sensor_Bosch.ipynb" target="_blank" title="Launch on Colab">
<span class="btn__icon-container">
<img alt="Colab logo" src="_static/images/logo_colab.png"/>
</span>
<span class="btn__text-container">Colab</span>
</a>
</li>
</ul>
</div>
<div class="dropdown dropdown-source-buttons">
<button aria-expanded="false" aria-label="Source repositories" class="btn dropdown-toggle" data-bs-toggle="dropdown" type="button">
<i class="fab fa-github"></i>
</button>
<ul class="dropdown-menu">
<li><a class="btn btn-sm btn-source-repository-button dropdown-item" data-bs-placement="left" data-bs-toggle="tooltip" href="https://github.com/dkeathley/S23-6.2410-lab" target="_blank" title="Source repository">
<span class="btn__icon-container">
<i class="fab fa-github"></i>
</span>
<span class="btn__text-container">Repository</span>
</a>
</li>
<li><a class="btn btn-sm btn-source-issues-button dropdown-item" data-bs-placement="left" data-bs-toggle="tooltip" href="https://github.com/dkeathley/S23-6.2410-lab/issues/new?title=Issue%20on%20page%20%2FCavity_QED_Sensor_Bosch.html&amp;body=Your%20issue%20content%20here." target="_blank" title="Open an issue">
<span class="btn__icon-container">
<i class="fas fa-lightbulb"></i>
</span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
</ul>
</div>
<div class="dropdown dropdown-download-buttons">
<button aria-expanded="false" aria-label="Download this page" class="btn dropdown-toggle" data-bs-toggle="dropdown" type="button">
<i class="fas fa-download"></i>
</button>
<ul class="dropdown-menu">
<li><a class="btn btn-sm btn-download-source-button dropdown-item" data-bs-placement="left" data-bs-toggle="tooltip" href="_sources/Cavity_QED_Sensor_Bosch.ipynb" target="_blank" title="Download source file">
<span class="btn__icon-container">
<i class="fas fa-file"></i>
</span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
<li>
<button class="btn btn-sm btn-download-pdf-button dropdown-item" data-bs-placement="left" data-bs-toggle="tooltip" onclick="window.print()" title="Print to PDF">
<span class="btn__icon-container">
<i class="fas fa-file-pdf"></i>
</span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
</ul>
</div>
<button class="btn btn-sm btn-fullscreen-button" data-bs-placement="bottom" data-bs-toggle="tooltip" onclick="toggleFullScreen()" title="Fullscreen mode">
<span class="btn__icon-container">
<i class="fas fa-expand"></i>
</span>
</button>
<button aria-label="Color mode" class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" data-bs-placement="bottom" data-bs-title="Color mode" data-bs-toggle="tooltip">
<i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light" title="Light"></i>
<i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark" title="Dark"></i>
<i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto" title="System Settings"></i>
</button>
<button aria-label="Search" class="btn btn-sm pst-navbar-icon search-button search-button__button pst-js-only" data-bs-placement="bottom" data-bs-toggle="tooltip" title="Search">
<i class="fa-solid fa-magnifying-glass fa-lg"></i>
</button>
<button class="sidebar-toggle secondary-toggle btn btn-sm" data-bs-placement="bottom" data-bs-toggle="tooltip" title="Toggle secondary sidebar">
<span class="fa-solid fa-list"></span>
</button>
</div></div>
</div>
</div>
</div>
<div class="onlyprint" id="jb-print-docs-body">
<h1>LAB: Solid State Spin Laboratory</h1>
<!-- Table of contents -->
<div id="print-main-content">
<div id="jb-print-toc">
<div>
<h2> Contents </h2>
</div>
<nav aria-label="Page">
<ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#cavity-coupled-quantum-electrodynamic-qed-sensor">Cavity-coupled quantum electrodynamic (QED) sensor</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#minimum-detectable-magnetic-field">Minimum detectable magnetic field</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lab-aims">Lab aims</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#sensitivity-model">Sensitivity Model</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#sensitivity-optimization-over-diamond-volume-and-nv-density">Sensitivity Optimization Over Diamond Volume and NV Density</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#sensitivity-optimization-over-cavity-mode-volume-and-quality-factor">Sensitivity Optimization over Cavity Mode Volume and Quality Factor</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#power-scaling">Power Scaling</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#linear-scaling">Linear Scaling</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#power-optimization">Power Optimization</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#current-experimental-setup">Current Experimental Setup</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Power Optimization</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#note-this-next-three-cells-are-commented-out-because-this-process-takes-a-long-time-to-run">NOTE: This next three cells are commented out because this process takes a long time to run</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#a-more-rigorous-method">A more rigorous method</a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">Current Experimental Setup</a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">Power Optimization</a></li>
</ul>
</li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">NOTE: This next three cells are commented out because this process takes a long time to run</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#power-optimized-over-diamond-parameters-with-current-resonator">Power Optimized over Diamond Parameters with Current Resonator</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#power-optimized-over-cavity-design-and-diamond-parameters">Power Optimized over Cavity Design and Diamond Parameters</a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#parameter-selection">Parameter Selection</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#high-frequency">High Frequency</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#sensitivity-improvements-at-high-frequency">Sensitivity Improvements at High Frequency</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#power-reduction-at-high-frequency">Power Reduction at High Frequency</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#first-power-model">First Power Model</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#second-power-model">Second Power Model</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#stealth-magnet">Stealth Magnet</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#permanent-magnets">Permanent Magnets</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#dispersive-readout-model">Dispersive Readout Model</a></li>
</ul>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div id="searchbox"></div>
<article class="bd-article">
<section class="tex2jax_ignore mathjax_ignore" id="lab-solid-state-spin-laboratory">
<h1>LAB: Solid State Spin Laboratory<a class="headerlink" href="#lab-solid-state-spin-laboratory" title="Link to this heading">#</a></h1>
<ul class="simple">
<li><p>Introduction</p></li>
<li><p>Pre-lab reading: Read the introduction to the quTools quNV experiment <a class="reference external" href="https://qutools.com/qunv/">here</a></p></li>
</ul>
<section id="cavity-coupled-quantum-electrodynamic-qed-sensor">
<h2>Cavity-coupled quantum electrodynamic (QED) sensor<a class="headerlink" href="#cavity-coupled-quantum-electrodynamic-qed-sensor" title="Link to this heading">#</a></h2>
<p>Hanfeng Wang, Matthew E. Trusheim, and Dirk Englund - Dec. 2022</p>
<p>Resonators for electromagnetic fields in the range of 1-100 GHz are essential in a range of quantum technologies, including superconducting quantum computers, microwave-optical quantum information interfaces, as well as sensors. Here, we consider microwave cavities coupled to ensembles of electron and nuclear spins associated with nitrogen vacancy (NV) centers in diamond. Following the discovery of coherent quantum dynamics of NV centers in the late 1990s, NV centers have emerged as leading quantum sensors for quantities ranging from electromagnetic fields to temperature, strain, rotation (gyroscopes), and have even been proposed for exotic schemes like dark matter detection. The key advantages of NV centers in sensing applications, over other electron spin systems, are their long coherence times and avaible optical polarization at room temperature.</p>
<p>Suggested reading for this laboratory on hybrid systems of microwave cavities coupled to NV spin ensembles specifically:
– 1 ) <a class="reference external" href="https://www.nature.com/articles/s41467-021-21256-7">E. Eisenach et al, Cavity-enhanced microwave readout of a solid-state spin sensor</a></p>
<p>– [optional] <a class="reference external" href="https://https://journals.aps.org/rmp/abstract/10.1103/RevModPhys.92.015004">JF Barry et. al. Sensitivity optimization for NV-diamond magnetometry</a></p>
<p>– [optional] <a class="reference external" href="https://https://arxiv.org/abs/2203.03462"> D. Fahey et. al., Steady-state microwave mode cooling with a diamond NV ensemble</a></p>
<p>– <a class="reference external" href="https://arxiv.org/abs/2009.02427">ME Trusheim et. al. A Polariton-Stabilized Spin Clock
</a></p>
<p>Upon optical excitation, nonradiative decay through a spin-state-dependent intersystem crossing produces spin-state-dependent fluorescence contrast and polarize NV spin to m_s = 0 ground state. A common way for NV spin readout relies on detecting this spin-state-dependent fluorescence. However, due to the low photon detection efficiency (C~0.015) for NV ensemble, the NV magnetic sensitivity is limited by the photon-shot-noise-limit.</p>
<p>One way to solve this problem is to use NV-cavity coupling, where we couple NV centers to another system (cavity in this case) and read the NV resonance frequency by via the cavity mode.</p>
<ol class="arabic simple">
<li><p>List item</p></li>
<li><p>List item</p></li>
</ol>
<figure class="align-default" id="cavity-qed-setup">
<a class="bg-primary mb-1 reference internal image-reference" href="https://drive.google.com/uc?export=view&amp;id=1GHuXwtSyHI6-wn5o7Llhv7QndVyWUVbk"><img alt="HOM-setup" class="bg-primary mb-1" src="https://drive.google.com/uc?export=view&amp;id=1GHuXwtSyHI6-wn5o7Llhv7QndVyWUVbk" style="width: 800px;"/></a>
<figcaption>
<p><span class="caption-number">Fig. 67 </span><span class="caption-text">Experimental setup for studying quantum spins.</span><a class="headerlink" href="#cavity-qed-setup" title="Link to this image">#</a></p>
</figcaption>
</figure>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">ipywidgets</span> <span class="k">as</span> <span class="nn">widgets</span>
<span class="kn">from</span> <span class="nn">ipywidgets</span> <span class="kn">import</span> <span class="n">HBox</span><span class="p">,</span> <span class="n">VBox</span>
<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">display</span>
<span class="o">%</span><span class="k">matplotlib</span> inline

<span class="nd">@widgets</span><span class="o">.</span><span class="n">interact_manual</span><span class="p">(</span>
    <span class="n">g0_in</span><span class="o">=</span><span class="p">(</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">1.</span><span class="p">),</span><span class="n">kc0_in</span><span class="o">=</span><span class="p">(</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">1000.</span><span class="p">),</span><span class="n">kc1_in</span><span class="o">=</span><span class="p">(</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">1000.</span><span class="p">),</span><span class="n">ks_in</span><span class="o">=</span><span class="p">(</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">1000.</span><span class="p">))</span>
<span class="k">def</span> <span class="nf">runFunc</span><span class="p">(</span><span class="n">g0_in</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">kc0_in</span> <span class="o">=</span> <span class="mi">70</span><span class="p">,</span> <span class="n">kc1_in</span> <span class="o">=</span> <span class="mi">111</span><span class="p">,</span> <span class="n">ks_in</span> <span class="o">=</span> <span class="mi">308</span><span class="p">):</span>
    <span class="n">kc0</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">kc0_in</span><span class="p">;</span> <span class="c1">#kHz  Cavity linewidth</span>
    <span class="n">kc1</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">kc1_in</span><span class="p">;</span> <span class="c1">#kHz   Cavity-loop coupling (output coupling)</span>

    <span class="n">ks</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">ks_in</span><span class="p">;</span> <span class="c1">#kHz  Spin coherence time</span>


    <span class="n">density_NVs</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span> <span class="c1">#PPM Density of NV centers in the diamond, given in ppm</span>
    <span class="n">diamondDensity</span> <span class="o">=</span> <span class="mf">1.76e29</span><span class="p">;</span> <span class="c1"># atoms/m^3 Atomic density of diamond</span>
    <span class="n">density_NVs_SI</span> <span class="o">=</span> <span class="n">density_NVs</span><span class="o">*</span><span class="mf">1e-6</span><span class="o">*</span><span class="n">diamondDensity</span><span class="p">;</span> <span class="c1"># NV/m^3</span>

    <span class="n">diamond_sample_dim_x</span><span class="o">=</span><span class="mf">3e-3</span><span class="p">;</span> <span class="c1"># m Diamond spatial dimensions, assuming cuboid</span>
    <span class="n">diamond_sample_dim_y</span><span class="o">=</span><span class="mf">3e-3</span><span class="p">;</span> <span class="c1"># m</span>
    <span class="n">diamond_sample_dim_z</span><span class="o">=</span><span class="mf">0.5e-3</span><span class="p">;</span> <span class="c1"># m</span>
    <span class="n">diamond_sample_volume</span> <span class="o">=</span> <span class="n">diamond_sample_dim_x</span><span class="o">*</span><span class="n">diamond_sample_dim_y</span><span class="o">*</span><span class="n">diamond_sample_dim_z</span><span class="p">;</span> 

    <span class="n">N_NVs</span><span class="o">=</span> <span class="n">density_NVs_SI</span><span class="o">*</span><span class="n">diamond_sample_volume</span> <span class="p">;</span> <span class="c1"># the number of NVs in the diamond</span>

    <span class="n">g0</span> <span class="o">=</span> <span class="n">g0_in</span><span class="o">*</span><span class="mf">1e-3</span><span class="p">;</span> <span class="c1">#kHz   Coupling strength for single spin, see referenced papers  </span>

    <span class="n">geff</span> <span class="o">=</span> <span class="n">g0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">N_NVs</span><span class="p">);</span> <span class="c1"># Total coupling scales as sqrt(N)</span>


    <span class="n">kc</span> <span class="o">=</span> <span class="n">kc0</span> <span class="o">+</span> <span class="n">kc1</span><span class="p">;</span> <span class="c1"># Total cavity loss</span>

    <span class="n">xnum</span> <span class="o">=</span> <span class="mi">101</span><span class="p">;</span> <span class="c1"># number of points to plot in x</span>
    <span class="n">ynum</span> <span class="o">=</span> <span class="mi">121</span><span class="p">;</span>

    <span class="c1"># initialize sweep parameters </span>
    <span class="n">wdc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">0.8</span><span class="p">,</span><span class="mf">0.8</span><span class="p">,</span><span class="n">num</span><span class="o">=</span><span class="n">xnum</span><span class="p">)</span><span class="o">*</span><span class="mf">1e3</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">;</span>  <span class="c1">#kHz  Detuning of the probe frequency and cavity frequency</span>
    <span class="n">wsc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">7.4</span><span class="p">,</span><span class="mf">7.4</span><span class="p">,</span><span class="n">num</span><span class="o">=</span><span class="n">ynum</span><span class="p">)</span><span class="o">*</span><span class="mf">1e3</span><span class="o">*</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">;</span>  <span class="c1">#kHz  Detuning of the spin frequency and cavity frequency</span>

    <span class="c1"># initialize output ararys</span>
    <span class="n">inphaseOut</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">xnum</span><span class="p">,</span><span class="n">ynum</span><span class="p">));</span>
    <span class="n">quadratureOut</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">xnum</span><span class="p">,</span><span class="n">ynum</span><span class="p">));</span>

    <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">xnum</span><span class="p">):</span>

      <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ynum</span><span class="p">):</span>

        <span class="n">wds</span> <span class="o">=</span> <span class="n">wdc</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">-</span><span class="n">wsc</span><span class="p">[</span><span class="n">jj</span><span class="p">];</span> <span class="c1">#spin-cavity detuning</span>

        <span class="c1"># Cavity reflection signal from references</span>
        <span class="n">refOutput</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="o">+</span> <span class="n">kc1</span><span class="o">/</span><span class="p">(</span><span class="n">kc</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="n">wdc</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">+</span><span class="nb">pow</span><span class="p">(</span><span class="n">geff</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">ks</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span><span class="n">j</span><span class="o">*</span><span class="n">wds</span><span class="p">));</span> 
        <span class="n">inphaseOut</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="n">jj</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">refOutput</span><span class="p">);</span> <span class="c1"># In-phase part of the cavity signal </span>
        <span class="n">quadratureOut</span><span class="p">[</span><span class="n">ii</span><span class="p">][</span><span class="n">jj</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">refOutput</span><span class="p">);</span>  <span class="c1"># Quadrature part of the cavity signal </span>

    <span class="n">y</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">7.4</span><span class="p">,</span><span class="mf">7.4</span><span class="p">,</span><span class="n">num</span><span class="o">=</span><span class="n">ynum</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">0.8</span><span class="p">,</span><span class="mf">0.8</span><span class="p">,</span><span class="n">num</span><span class="o">=</span><span class="n">xnum</span><span class="p">),)</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">figAxes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">sharex</span><span class="o">=</span><span class="s1">'all'</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="s1">'all'</span><span class="p">)</span>
    <span class="n">ax1</span> <span class="o">=</span> <span class="n">figAxes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">];</span>
    <span class="n">ax2</span> <span class="o">=</span> <span class="n">figAxes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">];</span>
    <span class="n">ax3</span> <span class="o">=</span> <span class="n">figAxes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">];</span>
    <span class="n">ax4</span> <span class="o">=</span> <span class="n">figAxes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">];</span>


    <span class="n">c</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">quadratureOut</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">'Q'</span><span class="p">)</span>
    <span class="c1">#ax1.set_xlabel('fsc (MHz)')</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">'fdc (MHz)'</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax1</span><span class="p">)</span>

    <span class="n">c</span> <span class="o">=</span> <span class="n">ax2</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">inphaseOut</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">'I'</span><span class="p">)</span>
    <span class="c1">#ax2.set_xlabel('fsc (MHz)')</span>
    <span class="c1">#ax2.set_ylabel('fdc (MHz)')</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax2</span><span class="p">)</span>

    <span class="n">c</span> <span class="o">=</span> <span class="n">ax3</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">pow</span><span class="p">(</span><span class="n">quadratureOut</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="nb">pow</span><span class="p">(</span><span class="n">inphaseOut</span><span class="p">,</span><span class="mi">2</span><span class="p">)))</span>
    <span class="n">ax3</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">'P'</span><span class="p">)</span>
    <span class="n">ax3</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">'fsc (MHz)'</span><span class="p">)</span>
    <span class="n">ax3</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">'fdc (MHz)'</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax3</span><span class="p">)</span>

    <span class="n">c</span> <span class="o">=</span> <span class="n">ax4</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span> <span class="n">np</span><span class="o">.</span><span class="n">divide</span><span class="p">(</span><span class="n">quadratureOut</span><span class="p">,</span><span class="n">inphaseOut</span><span class="p">)))</span>
    <span class="n">ax4</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">'Phi'</span><span class="p">)</span>
    <span class="n">ax4</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">'fsc (MHz)'</span><span class="p">)</span>
    <span class="c1">#ax4.set_ylabel('fdc (MHz)')</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax4</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>      
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"version_major": 2, "version_minor": 0, "model_id": "05fe217d8c3441fabf81f534d5515318"}</script></div>
</div>
</section>
<section id="minimum-detectable-magnetic-field">
<h2>Minimum detectable magnetic field<a class="headerlink" href="#minimum-detectable-magnetic-field" title="Link to this heading">#</a></h2>
<p>[background in Ref. X, page Y [[add hyperlink]]</p>
<p>Here is the sensitivity analysis for cavity-coupled sensor. In the ideal case, the spin-projection-limit sensitivity is propotional to the inverse of the square root of the number of spins (N). However, the NV decoherence time and dephasing time will decrease during the increase of the NV number. Therefore, the sensivitity will decrease sharply in the large-N regime. The script below calculated the spin-projection-limit sensitivity and photon-shot-noise-limit with different number of spins.</p>
<p>The script below also include the cavity-coupled spin sensor. The scale of the sensitivity in the low-N regime is linear with the 1/N rather than 1/sqrt(N), which offers the possibility for this sensor to go below the spin-projection-limit sensitivity.</p>
<p>[[ choose here parameters that students can actually modify in the laboratory: i.e., microwave driving power, optical pump power; bias point of microwave readout signal [\omega_probe] ]]</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">Delta</span> <span class="o">=</span> <span class="mf">2e6</span><span class="p">;</span>
<span class="n">f</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">;</span>

<span class="n">Sphi</span> <span class="o">=</span> <span class="mf">1e-9</span><span class="p">;</span> <span class="c1"># phase noise</span>

<span class="n">Q</span> <span class="o">=</span> <span class="mf">3e4</span><span class="p">;</span>  <span class="c1"># Quality factor</span>

<span class="n">hbar</span> <span class="o">=</span> <span class="mf">1.05e-34</span><span class="p">;</span>  

<span class="n">gs</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span> 

<span class="n">muB</span> <span class="o">=</span> <span class="mf">9.27e-24</span><span class="p">;</span> 

<span class="n">rho</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">40</span><span class="p">)</span><span class="o">*</span><span class="mf">1e6</span><span class="p">;</span>

<span class="n">Tc</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="mf">3.3e-19</span><span class="o">/</span><span class="p">(</span><span class="n">rho</span><span class="o">*</span><span class="p">(</span><span class="mf">0.95</span><span class="o">/</span><span class="mf">0.05</span><span class="p">));</span>

<span class="n">T2c</span> <span class="o">=</span> <span class="mf">300e-6</span><span class="p">;</span>

<span class="n">T2</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">T2c</span><span class="o">+</span><span class="mi">1</span><span class="o">/</span><span class="n">Tc</span><span class="p">);</span>

<span class="n">mu0</span> <span class="o">=</span> <span class="mi">4</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="mf">1e-7</span><span class="p">;</span>

<span class="n">C</span> <span class="o">=</span> <span class="mf">0.015</span><span class="p">;</span>

<span class="n">etaB</span> <span class="o">=</span> <span class="mi">8</span> <span class="o">*</span> <span class="nb">pow</span><span class="p">((</span><span class="n">hbar</span><span class="o">/</span><span class="n">gs</span><span class="o">/</span><span class="n">muB</span><span class="p">),</span><span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="n">Delta</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="n">Q</span><span class="o">/</span><span class="n">T2</span> <span class="o">*</span> <span class="n">Sphi</span> <span class="o">*</span> <span class="mi">1</span><span class="o">/</span><span class="n">mu0</span><span class="o">/</span><span class="n">hbar</span><span class="o">/</span><span class="n">rho</span> <span class="o">*</span><span class="mi">1</span><span class="o">/</span><span class="n">f</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="nb">pow</span><span class="p">((</span><span class="n">T2</span><span class="o">/</span><span class="n">T2c</span><span class="p">),</span><span class="mi">3</span><span class="p">))</span><span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">T2</span><span class="o">/</span><span class="n">Tc</span><span class="p">)</span><span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="mf">1e-6</span><span class="o">/</span><span class="n">T2</span><span class="p">);</span>

<span class="n">eta</span> <span class="o">=</span> <span class="n">hbar</span><span class="o">/</span><span class="n">muB</span><span class="o">/</span><span class="n">gs</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="nb">pow</span><span class="p">((</span><span class="n">T2</span><span class="o">/</span><span class="n">T2c</span><span class="p">),</span><span class="mi">3</span><span class="p">))</span><span class="o">/</span><span class="n">C</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">rho</span><span class="o">*</span><span class="n">T2</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">T2</span><span class="o">/</span><span class="n">Tc</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="mf">1e-6</span><span class="o">/</span><span class="n">T2</span><span class="p">);</span>

<span class="n">eta_proj</span> <span class="o">=</span> <span class="n">hbar</span><span class="o">/</span><span class="n">muB</span><span class="o">/</span><span class="n">gs</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="nb">pow</span><span class="p">((</span><span class="n">T2</span><span class="o">/</span><span class="n">T2c</span><span class="p">),</span><span class="mi">3</span><span class="p">))</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">rho</span><span class="o">*</span><span class="n">T2</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">T2</span><span class="o">/</span><span class="n">Tc</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="mf">1e-6</span><span class="o">/</span><span class="n">T2</span><span class="p">);</span>

<span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>

<span class="n">ax</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">rho</span><span class="o">/</span><span class="mf">1e6</span><span class="p">,</span><span class="n">eta</span><span class="o">*</span><span class="mi">1</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">3e-3</span><span class="o">*</span><span class="mf">3e-3</span><span class="o">*</span><span class="mf">0.5e-3</span><span class="p">),</span><span class="n">label</span><span class="o">=</span><span class="s1">'Photon shot noise limit'</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">rho</span><span class="o">/</span><span class="mf">1e6</span><span class="p">,</span><span class="n">eta_proj</span><span class="o">*</span><span class="mi">1</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">3e-3</span><span class="o">*</span><span class="mf">3e-3</span><span class="o">*</span><span class="mf">0.5e-3</span><span class="p">),</span><span class="n">label</span><span class="o">=</span><span class="s1">'Spin projection limit'</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">rho</span><span class="o">/</span><span class="mf">1e6</span><span class="p">,</span><span class="n">etaB</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">'Cavity readout sensitivity'</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">'NV Density (cm^{-3})'</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">'Sensitivity (T/\sqrt(Hz))'</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0, 0.5, 'Sensitivity (T/\\sqrt(Hz))')
</pre></div>
</div>
<img alt="_images/ab204be0a9c0e98e494f7f23225be4f5b5a4afac6d9fbabbb01021111ffbfdb5.png" src="_images/ab204be0a9c0e98e494f7f23225be4f5b5a4afac6d9fbabbb01021111ffbfdb5.png"/>
</div>
</div>
</section>
<section id="lab-aims">
<h2>Lab aims<a class="headerlink" href="#lab-aims" title="Link to this heading">#</a></h2>
<p><strong>Aim 1: Characterizatin of the NV-cavity QED apparatus</strong></p>
<p><strong>A1.1: Test the cavity Q and frequency with digital twin</strong></p>
<p>Put numbers into Digital Twin based on <a class="reference external" href="https://www.nature.com/articles/s41467-021-21256-7">E. Eisenach et al, Cavity-enhanced microwave readout of a solid-state spin sensor</a>. Reproduce curves in the publication.</p>
<p><strong>A1.2: Cavity Experiment</strong></p>
<ol class="arabic simple">
<li><p>Find cavity resonance frequency. Connect vector network analyzer (VNA) to the cavity and detect S12 reflection signal. Move the position of the loop to critical couple the loop and the cavity. Get the cavity resonance frequency based on the VNA signal.</p></li>
<li><p>Analysis the cavity resonance signal. Disconnect the VNA and connect the signal generator (SG) to the circuit. Sweep the frequency near the cavity resonance frequency. Compare the experimental data and simulations from Digital Twin by setting N=0. Get the cavity linewidth κc with the model.</p></li>
<li><p>NV-cavity coupling. Turn on the laser and set the power to 8 W. Set the microwave power to -17 dBm and sweep the SG frequency and the voltage (current) in the Helmholtz coil. Use the Digital Twin to check your data and get the coupling strength g_{eff} and spin linewidth κs.</p></li>
</ol>
<p><strong>A1.3: Power dependence</strong></p>
<p>Set laser power to be 8 W, and microwave power to be P_opt=[-30,-25,-20,-15,-10,-5,0,5,10] dBm. Plot the refection signal for each microwave power. Compare your result with <a class="reference external" href="https://www.nature.com/articles/s41467-021-21256-7">E. Eisenach et al, Cavity-enhanced microwave readout of a solid-state spin sensor</a>.</p>
<p><strong>Aim 2: Magnetic field sensitivity</strong></p>
<p>Now think about how we can make use of the NV-cavity coupling system. A straightforward thing mentioned before is the magnetometry.</p>
<p><strong>A2.1 Sensitivity calculation</strong></p>
<p>Based on your understanding on the project, write codes to calculate the maximum senstivity you can achieve using the parameters you get from Digital Twin and experiments.</p>
<p><strong>A2.2 Power depedence</strong></p>
<p>Think about how this power dependence is related to the magnetic field sensitivity. Calculated it from the Digital Twin model and compare with the experiment data.</p>
<section id="sensitivity-model">
<h3>Sensitivity Model<a class="headerlink" href="#sensitivity-model" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">scipy.integrate</span> <span class="kn">import</span> <span class="n">quad</span>

<span class="k">def</span> <span class="nf">compute_geff</span><span class="p">(</span><span class="n">rho</span><span class="p">,</span> <span class="n">gammao</span><span class="p">,</span> <span class="n">V</span><span class="p">,</span> <span class="n">gs</span><span class="p">,</span> <span class="n">Vd</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""Compute geff using Vd."""</span>
    <span class="n">gamma_th</span> <span class="o">=</span> <span class="mi">90</span> <span class="c1"># thermal relxation rate</span>
    <span class="n">I</span> <span class="o">=</span> <span class="mf">1.225</span> <span class="o">*</span> <span class="n">gammao</span> <span class="o">-</span> <span class="mf">4.809</span> <span class="o">*</span> <span class="n">gamma_th</span> <span class="o">+</span> <span class="mf">3.085</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">0.1577</span> <span class="o">*</span> <span class="n">gammao</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="mf">0.5229</span> <span class="o">*</span> <span class="n">gammao</span> <span class="o">*</span> <span class="n">gamma_th</span> <span class="o">+</span> <span class="n">gamma_th</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">Polarization</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.29</span><span class="o">*</span><span class="n">I</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="n">gamma_th</span> <span class="o">+</span> <span class="mf">0.38</span><span class="o">*</span><span class="n">I</span><span class="p">)</span>
    <span class="n">N</span> <span class="o">=</span> <span class="p">(</span><span class="n">rho</span> <span class="o">*</span> <span class="mf">3.51</span> <span class="o">/</span> <span class="mf">12.01</span> <span class="o">*</span> <span class="mf">6.022e23</span><span class="p">)</span> <span class="o">*</span> <span class="n">Vd</span> <span class="o">*</span> <span class="nb">min</span><span class="p">(</span><span class="n">Vd</span><span class="p">,</span><span class="n">V</span><span class="p">)</span><span class="o">/</span><span class="n">Vd</span>
    <span class="n">geff</span> <span class="o">=</span> <span class="n">gs</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">N</span> <span class="o">*</span> <span class="n">Polarization</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.153</span>  <span class="c1"># Factor adjusted for matching 0.19MHz at current parameters</span>
    <span class="k">return</span> <span class="n">geff</span>

<span class="k">def</span> <span class="nf">compute_sens</span><span class="p">(</span><span class="n">rho</span><span class="p">,</span> <span class="n">gammao</span><span class="p">,</span> <span class="n">V</span><span class="p">,</span> <span class="n">Q</span><span class="p">,</span> <span class="n">PowerList</span><span class="p">,</span> <span class="n">vot</span><span class="p">,</span> <span class="n">energy</span><span class="p">,</span> <span class="n">gs</span><span class="p">,</span> <span class="n">kc</span><span class="p">,</span> <span class="n">kc1</span><span class="p">,</span> <span class="n">Vd</span><span class="p">):</span>
    <span class="n">Gamma</span> <span class="o">=</span> <span class="mf">330e3</span> <span class="o">/</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">rho</span>
    <span class="n">alpha2</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="n">PowerList</span> <span class="o">/</span> <span class="mi">10</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1e-3</span> <span class="o">/</span> <span class="p">(</span><span class="n">energy</span> <span class="o">*</span> <span class="n">kc1</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mf">0.53</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">beta2</span> <span class="o">=</span> <span class="n">alpha2</span> <span class="o">*</span> <span class="n">kc1</span>
    <span class="n">geff</span> <span class="o">=</span> <span class="n">compute_geff</span><span class="p">(</span><span class="n">rho</span><span class="p">,</span> <span class="n">gammao</span><span class="p">,</span> <span class="n">V</span><span class="p">,</span> <span class="n">gs</span><span class="p">,</span> <span class="n">Vd</span><span class="p">)</span>

    <span class="n">gamma1</span> <span class="o">=</span> <span class="n">gammao</span><span class="o">*</span><span class="mi">2</span><span class="o">/</span><span class="mf">0.46</span> <span class="o">+</span> <span class="mf">26.4e3</span><span class="o">*</span><span class="n">rho</span>
    <span class="n">xi1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">gs</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">alpha2</span> <span class="o">/</span> <span class="n">gammao</span> <span class="o">*</span> <span class="n">gamma1</span> <span class="o">+</span> <span class="n">gamma1</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">alpha2_v2</span> <span class="o">=</span> <span class="n">kc1</span> <span class="o">*</span> <span class="n">beta2</span> <span class="o">/</span> <span class="p">(</span><span class="n">kc</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">geff</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">gamma1</span> <span class="o">/</span> <span class="n">xi1</span> <span class="o">/</span> <span class="p">(</span><span class="n">Gamma</span> <span class="o">+</span> <span class="n">xi1</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span>
    <span class="n">xi3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">gs</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">alpha2_v2</span> <span class="o">/</span> <span class="n">gammao</span> <span class="o">*</span> <span class="n">gamma1</span> <span class="o">+</span> <span class="n">gamma1</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">dVdB</span> <span class="o">=</span> <span class="p">(</span><span class="n">geff</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="mi">4</span> <span class="o">/</span> <span class="p">(</span><span class="n">Gamma</span> <span class="o">+</span> <span class="n">xi3</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">kc1</span> <span class="o">/</span>
            <span class="p">(</span><span class="n">kc</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">geff</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">gamma1</span> <span class="o">/</span> <span class="n">xi3</span> <span class="o">/</span> <span class="p">(</span><span class="n">Gamma</span> <span class="o">+</span> <span class="n">xi3</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span>
            <span class="n">vot</span> <span class="o">*</span> <span class="mf">28e9</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1e-4</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">xi</span> <span class="o">=</span> <span class="n">xi1</span>
    <span class="n">xi2</span> <span class="o">=</span> <span class="n">gamma1</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">xi</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">gamma1</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">geff2</span> <span class="o">=</span> <span class="n">geff</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">xi2</span><span class="p">)</span>
    <span class="n">Gamma1</span> <span class="o">=</span> <span class="n">Gamma</span> <span class="o">+</span> <span class="n">gamma1</span> <span class="o">/</span> <span class="n">xi2</span>
    <span class="n">CC</span> <span class="o">=</span> <span class="p">(</span><span class="n">kc1</span> <span class="o">*</span> <span class="n">Gamma1</span> <span class="o">*</span> <span class="n">geff2</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span>
          <span class="p">(</span><span class="n">Gamma1</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">kc</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="mi">4</span> <span class="o">+</span> <span class="n">geff2</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">Gamma1</span> <span class="o">*</span> <span class="n">kc</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">geff2</span><span class="o">**</span><span class="mi">4</span><span class="p">))</span>
    <span class="n">noise</span> <span class="o">=</span> <span class="mf">0.45e-9</span> <span class="o">-</span> <span class="mf">0.1345e-9</span> <span class="o">*</span> <span class="n">CC</span>
    <span class="k">return</span> <span class="nb">min</span><span class="p">(</span><span class="n">noise</span> <span class="o">/</span> <span class="n">dVdB</span> <span class="o">/</span> <span class="mf">1e4</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="sensitivity-optimization-over-diamond-volume-and-nv-density">
<h3>Sensitivity Optimization Over Diamond Volume and NV Density<a class="headerlink" href="#sensitivity-optimization-over-diamond-volume-and-nv-density" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">matplotlib.colors</span> <span class="kn">import</span> <span class="n">LogNorm</span>


<span class="n">rho_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">GammaList</span> <span class="o">=</span> <span class="mf">330e3</span> <span class="o">*</span> <span class="n">rho_list</span>  <span class="c1"># inhomogeneous linewidth (Hz)</span>
<span class="n">gammaoList</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.3</span><span class="p">,</span><span class="mf">3.45</span><span class="p">,</span><span class="mi">51</span><span class="p">)</span><span class="o">*</span><span class="mf">1e3</span>

<span class="n">PowerList</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">55</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">51</span><span class="p">)</span>
<span class="n">vot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="n">PowerList</span> <span class="o">/</span> <span class="mi">10</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1e-3</span> <span class="o">*</span> <span class="mi">50</span><span class="p">)</span>

<span class="n">r1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="o">-</span><span class="mf">3.5</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">Vd</span> <span class="o">=</span> <span class="mf">3e-3</span> <span class="o">*</span> <span class="mf">3e-3</span> <span class="o">*</span> <span class="mf">0.9e-3</span>   <span class="c1"># diamond volume</span>
<span class="n">V0list</span> <span class="o">=</span> <span class="n">Vd</span> <span class="o">*</span> <span class="n">r1</span>   
<span class="n">mu0</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="mf">1e-7</span>
<span class="n">energy</span> <span class="o">=</span> <span class="mf">6.626e-34</span> <span class="o">*</span> <span class="mf">2.87e9</span>   <span class="c1"># h * f</span>
<span class="n">kc0</span> <span class="o">=</span> <span class="mf">130e3</span>   <span class="c1"># cavity linewidth</span>
<span class="n">kc1</span> <span class="o">=</span> <span class="mf">130e3</span>   <span class="c1"># cavity loop coupling</span>
<span class="n">Q</span> <span class="o">=</span> <span class="mf">2e4</span>  <span class="c1"># Quality factor</span>
<span class="n">kc</span> <span class="o">=</span> <span class="n">kc0</span> <span class="o">+</span> <span class="n">kc1</span>  <span class="c1"># cavity loss</span>
<span class="n">gs</span> <span class="o">=</span> <span class="mf">0.019</span>   <span class="c1"># single coupling strength  </span>

<span class="n">V</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">*</span> <span class="n">energy</span> <span class="o">/</span> <span class="mi">3</span> <span class="o">/</span> <span class="n">gs</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="mf">28e9</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">mu0</span>  <span class="c1"># 2/3 due to the geometry factor</span>

<span class="n">sens_Vd_rho</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">V0list</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">rho_list</span><span class="p">)))</span>

<span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">r1</span><span class="p">)):</span>
    <span class="n">V0</span> <span class="o">=</span> <span class="n">V0list</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span>   <span class="c1"># diamond volume</span>
    <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">rho_list</span><span class="p">)):</span>
        <span class="n">rho</span> <span class="o">=</span> <span class="n">rho_list</span><span class="p">[</span><span class="n">jj</span><span class="p">]</span>
        <span class="n">sens0</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="k">for</span> <span class="n">kk</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">gammaoList</span><span class="p">)):</span>
            <span class="n">gammao</span> <span class="o">=</span> <span class="n">gammaoList</span><span class="p">[</span><span class="n">kk</span><span class="p">]</span>     <span class="c1"># optical polarization rate</span>
            <span class="n">Gamma</span> <span class="o">=</span> <span class="n">GammaList</span><span class="p">[</span><span class="n">jj</span><span class="p">]</span>   <span class="c1"># inhomogeneous linewidth</span>
            <span class="n">sens1</span> <span class="o">=</span> <span class="n">compute_sens</span><span class="p">(</span><span class="n">rho</span><span class="p">,</span> <span class="n">gammao</span><span class="p">,</span> <span class="n">V</span><span class="p">,</span> <span class="n">Q</span><span class="p">,</span> <span class="n">PowerList</span><span class="p">,</span> <span class="n">vot</span><span class="p">,</span> <span class="n">energy</span><span class="p">,</span> <span class="n">gs</span><span class="p">,</span> <span class="n">kc</span><span class="p">,</span> <span class="n">kc1</span><span class="p">,</span> <span class="n">V0</span><span class="p">)</span>
            <span class="n">sens0</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sens1</span><span class="p">)</span>
        <span class="n">sens_Vd_rho</span><span class="p">[</span><span class="n">ii</span><span class="p">,</span> <span class="n">jj</span><span class="p">]</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">sens0</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create the figure</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>

<span class="c1"># Calculate rr2 and set the image plot</span>
<span class="n">rr2</span> <span class="o">=</span> <span class="n">rho_list</span> <span class="o">*</span> <span class="mi">4</span>
<span class="n">rr1</span> <span class="o">=</span> <span class="n">V0list</span> <span class="o">/</span> <span class="n">V</span>

<span class="c1"># Create a meshgrid for rr2 and rr1</span>
<span class="n">RR2</span><span class="p">,</span> <span class="n">RR1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">rr2</span><span class="p">,</span> <span class="n">rr1</span><span class="p">)</span>

<span class="c1"># Plot the data using pcolormesh</span>
<span class="n">plt</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">RR2</span><span class="p">,</span> <span class="n">RR1</span><span class="p">,</span> <span class="n">sens_Vd_rho</span><span class="p">,</span> <span class="n">shading</span><span class="o">=</span><span class="s1">'auto'</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">LogNorm</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="mf">1e-15</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mf">100e-12</span><span class="p">),</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">'hot'</span><span class="p">)</span>

<span class="c1"># Set scales to log</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xscale</span><span class="p">(</span><span class="s1">'log'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yscale</span><span class="p">(</span><span class="s1">'log'</span><span class="p">)</span>

<span class="c1"># Add color bar and label it</span>
<span class="n">cbar</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
<span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="sa">r</span><span class="s1">'$\eta$ (T/$\sqrt</span><span class="si">{Hz}</span><span class="s1">$)'</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">270</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">22</span><span class="p">)</span>
<span class="n">cbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>

<span class="c1"># Set axis labels and limits</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">'$\rho$(ppm)'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">22</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">'V$_</span><span class="si">{d}</span><span class="s1">$/V$_</span><span class="si">{0}</span><span class="s1">$'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">22</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="mf">1e-2</span><span class="p">,</span> <span class="mf">1e3</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="mf">2e-4</span><span class="p">,</span> <span class="mf">4.68</span><span class="p">])</span>

<span class="c1"># Set the line width and tick length</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">'top'</span><span class="p">]</span><span class="o">.</span><span class="n">set_linewidth</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">'right'</span><span class="p">]</span><span class="o">.</span><span class="n">set_linewidth</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">'bottom'</span><span class="p">]</span><span class="o">.</span><span class="n">set_linewidth</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">'left'</span><span class="p">]</span><span class="o">.</span><span class="n">set_linewidth</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>

<span class="c1"># Generate contour levels</span>
<span class="n">contour_levels</span> <span class="o">=</span> <span class="p">[</span><span class="mf">2e-15</span><span class="p">,</span> <span class="mf">1e-14</span><span class="p">,</span> <span class="mf">1e-13</span><span class="p">,</span> <span class="mf">1e-12</span><span class="p">]</span>
<span class="n">contour</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">RR2</span><span class="p">,</span> <span class="n">RR1</span><span class="p">,</span> <span class="n">sens_Vd_rho</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="n">contour_levels</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="s1">'w'</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">linestyles</span><span class="o">=</span><span class="s1">'--'</span><span class="p">)</span>
<span class="c1"># plt.clabel(contour, inline=True, fontsize=18, fmt='%.1e', colors='white')</span>

<span class="c1"># plt.text(2, 0.008, r'1 pT/$\sqrt{Hz}$', fontsize=18, color='white')</span>
<span class="c1"># plt.text(3, 0.15, r'100 fT/$\sqrt{Hz}$', fontsize=18, color='white')</span>
<span class="c1"># plt.text(8, 2, r'10 fT/$\sqrt{Hz}$', fontsize=18, color='white')</span>
<span class="c1"># plt.text(100, 0.2, r'2 fT/$\sqrt{Hz}$', fontsize=18, color='white')</span>

<span class="c1"># Calculate and plot additional lines</span>
<span class="n">h</span> <span class="o">=</span> <span class="mf">2e-26</span> <span class="o">/</span> <span class="mf">3.5e3</span> <span class="o">/</span> <span class="mf">3.1e-21</span> <span class="o">/</span> <span class="mf">4e-6</span> <span class="o">*</span> <span class="mf">3.4</span> <span class="o">*</span> <span class="mi">100</span>  <span class="c1"># cm</span>
<span class="n">S</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="mf">0.5</span><span class="o">**</span><span class="mi">2</span>
<span class="n">V2</span> <span class="o">=</span> <span class="n">h</span> <span class="o">*</span> <span class="n">S</span> <span class="o">/</span> <span class="mf">1.73</span>

<span class="n">xx</span> <span class="o">=</span> <span class="n">rr2</span>
<span class="n">yy</span> <span class="o">=</span> <span class="n">V2</span> <span class="o">*</span> <span class="mi">4</span> <span class="o">/</span> <span class="n">xx</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span> <span class="n">yy</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">'blue'</span><span class="p">)</span>  <span class="c1"># optiacl polarizatoin limit</span>

<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([</span><span class="mf">1e-2</span><span class="p">,</span> <span class="mf">1e0</span><span class="p">,</span> <span class="mf">1e2</span><span class="p">,</span> <span class="mf">1e3</span><span class="p">])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([</span><span class="mf">1e-3</span><span class="p">,</span> <span class="mf">1e-2</span><span class="p">,</span> <span class="mf">1e-1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>

<span class="c1"># plt.scatter(4,(3e-3*3e-3*0.9e-3/V), color='violet', zorder=5, s=50, label='Example')</span>

<span class="c1"># Show the plot</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/de3989a4284ce6d437bcaa558631b806d0d49c3433d88f4016146038513f3e4b.png" src="_images/de3989a4284ce6d437bcaa558631b806d0d49c3433d88f4016146038513f3e4b.png"/>
</div>
</div>
</section>
<section id="sensitivity-optimization-over-cavity-mode-volume-and-quality-factor">
<h3>Sensitivity Optimization over Cavity Mode Volume and Quality Factor<a class="headerlink" href="#sensitivity-optimization-over-cavity-mode-volume-and-quality-factor" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="kn">import</span> <span class="n">shgo</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="k">def</span> <span class="nf">sens_wrapper</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">V</span><span class="p">,</span> <span class="n">Q</span><span class="p">,</span> <span class="n">PowerList</span><span class="p">,</span> <span class="n">vot</span><span class="p">,</span> <span class="n">energy</span><span class="p">,</span> <span class="n">gs</span><span class="p">,</span> <span class="n">kc</span><span class="p">,</span> <span class="n">kc1</span><span class="p">,</span> <span class="n">Vd</span><span class="p">):</span>
    <span class="n">rho</span><span class="p">,</span> <span class="n">gammao</span> <span class="o">=</span> <span class="n">params</span>    <span class="c1"># optimize over NV density and optical polarization rate</span>
    <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.45</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">*</span> <span class="n">rho</span><span class="o">/</span><span class="mf">0.1</span>
    <span class="k">return</span> <span class="n">compute_sens</span><span class="p">(</span><span class="n">rho</span><span class="p">,</span> <span class="n">gammao</span><span class="p">,</span> <span class="n">V</span><span class="p">,</span> <span class="n">Q</span><span class="p">,</span> <span class="n">PowerList</span><span class="p">,</span> <span class="n">vot</span><span class="p">,</span> <span class="n">energy</span><span class="p">,</span> <span class="n">gs</span><span class="p">,</span> <span class="n">kc</span><span class="p">,</span> <span class="n">kc1</span><span class="p">,</span> <span class="n">Vd</span><span class="p">)</span>
    
<span class="n">Qlist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">101</span><span class="p">)</span>   <span class="c1">#quality factor</span>

<span class="n">PowerList</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">70</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">51</span><span class="p">)</span>
<span class="n">vot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="n">PowerList</span> <span class="o">/</span> <span class="mi">10</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1e-3</span> <span class="o">*</span> <span class="mi">50</span><span class="p">)</span>
<span class="n">Vd</span> <span class="o">=</span> <span class="mf">3e-3</span> <span class="o">*</span> <span class="mf">3e-3</span> <span class="o">*</span> <span class="mf">0.9e-3</span>   <span class="c1">#diamond volume</span>
<span class="n">Vlist</span> <span class="o">=</span> <span class="n">Vd</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">101</span><span class="p">)</span>   <span class="c1">#cavity mode volume</span>
<span class="n">mu0</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="mf">1e-7</span>   
<span class="n">energy</span> <span class="o">=</span> <span class="mf">6.626e-34</span> <span class="o">*</span> <span class="mf">2.87e9</span>   <span class="c1">#h*f</span>
<span class="n">rhomax</span> <span class="o">=</span> <span class="mf">0.1231</span> <span class="o">*</span> <span class="mi">4</span> <span class="o">*</span> <span class="mf">1e-6</span> <span class="o">/</span> <span class="n">Vd</span>

<span class="n">sens_V_Q</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">Vlist</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">Qlist</span><span class="p">)))</span>
<span class="n">opt_params_V_Q</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">Vlist</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">Qlist</span><span class="p">)),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)</span>

<span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Vlist</span><span class="p">)):</span>
    <span class="n">V</span> <span class="o">=</span> <span class="n">Vlist</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span>
    <span class="n">gs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">energy</span> <span class="o">*</span> <span class="p">(</span><span class="mf">28e9</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">mu0</span> <span class="o">/</span> <span class="mi">3</span> <span class="o">/</span> <span class="n">V</span><span class="p">)</span>   <span class="c1">#single coupling strength</span>

    <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Qlist</span><span class="p">)):</span>
        <span class="n">Q</span> <span class="o">=</span> <span class="n">Qlist</span><span class="p">[</span><span class="n">jj</span><span class="p">]</span>   <span class="c1"># Quality factor</span>
        <span class="n">kc0</span> <span class="o">=</span> <span class="mf">2.87e9</span> <span class="o">/</span> <span class="n">Q</span>   <span class="c1"># cavity linewidth</span>
        <span class="n">kc1</span> <span class="o">=</span> <span class="n">kc0</span>    <span class="c1"># cavity loop coupling</span>
        <span class="n">kc</span> <span class="o">=</span> <span class="n">kc0</span> <span class="o">+</span> <span class="n">kc1</span>   <span class="c1"># cavity loss</span>
        
        <span class="n">initial_guess</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mf">50e3</span><span class="p">)</span>
        <span class="n">bounds</span> <span class="o">=</span> <span class="p">((</span><span class="mf">1e-2</span><span class="p">,</span><span class="nb">min</span><span class="p">(</span><span class="n">rhomax</span><span class="p">,</span><span class="mf">1e2</span><span class="p">)),(</span><span class="mf">0.3e3</span><span class="p">,</span><span class="mf">3.45e3</span><span class="p">))</span>
        <span class="n">solution</span> <span class="o">=</span> <span class="n">shgo</span><span class="p">(</span><span class="n">sens_wrapper</span><span class="p">,</span> <span class="n">bounds</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">V</span><span class="p">,</span> <span class="n">Q</span><span class="p">,</span> <span class="n">PowerList</span><span class="p">,</span> <span class="n">vot</span><span class="p">,</span> <span class="n">energy</span><span class="p">,</span> <span class="n">gs</span><span class="p">,</span> <span class="n">kc</span><span class="p">,</span> <span class="n">kc1</span><span class="p">,</span> <span class="n">Vd</span><span class="p">))</span>
        <span class="n">sens_V_Q</span><span class="p">[</span><span class="n">ii</span><span class="p">,</span> <span class="n">jj</span><span class="p">]</span> <span class="o">=</span> <span class="n">solution</span><span class="o">.</span><span class="n">fun</span>
        <span class="n">opt_params_V_Q</span><span class="p">[</span><span class="n">ii</span><span class="p">,</span> <span class="n">jj</span><span class="p">]</span> <span class="o">=</span> <span class="n">solution</span><span class="o">.</span><span class="n">x</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">matplotlib.colors</span> <span class="kn">import</span> <span class="n">LogNorm</span>

<span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">Qlist</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">energy</span> <span class="o">*</span> <span class="p">(</span><span class="mf">28e9</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">mu0</span> <span class="o">/</span> <span class="mi">3</span> <span class="o">/</span> <span class="n">Vlist</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">Y</span><span class="p">,</span> <span class="n">sens_V_Q</span><span class="p">,</span> <span class="n">shading</span><span class="o">=</span><span class="s1">'auto'</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">LogNorm</span><span class="p">(),</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">'hot'</span><span class="p">)</span>

<span class="c1"># Add color bar and label it</span>
<span class="n">cbar</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
<span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="sa">r</span><span class="s1">'$\eta$ (T/$\sqrt</span><span class="si">{Hz}</span><span class="s1">$)'</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">270</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">22</span><span class="p">)</span>
<span class="n">cbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>

<span class="n">contour</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">Y</span><span class="p">,</span> <span class="n">sens_V_Q</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="p">[</span><span class="mf">1.3e-14</span><span class="p">,</span> <span class="mf">1e-13</span><span class="p">,</span> <span class="mf">1e-12</span><span class="p">,</span> <span class="mf">1e-11</span><span class="p">],</span> <span class="n">colors</span><span class="o">=</span><span class="s1">'w'</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xscale</span><span class="p">(</span><span class="s1">'log'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yscale</span><span class="p">(</span><span class="s1">'log'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="mf">1e2</span><span class="p">,</span> <span class="mf">8e5</span><span class="p">])</span>
<span class="c1"># plt.ylim([9e-3, 300])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="mf">1e-3</span><span class="p">,</span> <span class="mi">100</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">'$g_</span><span class="si">{s}</span><span class="s1">$(Hz)'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">22</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">'Q'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">22</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">fmt</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s1">'</span><span class="si">{</span><span class="n">x</span><span class="si">:</span><span class="s1">.1e</span><span class="si">}</span><span class="s1"> T/$\sqrt</span><span class="se">{{</span><span class="s1">Hz</span><span class="se">}}</span><span class="s1">$'</span>  <span class="c1"># Replace 'units' with your desired unit</span>
<span class="c1"># plt.clabel(contour, inline=True, fontsize=8, fmt=fmt)</span>

<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">'both'</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">'major'</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>  <span class="c1"># Major tick labels</span>

<span class="c1"># Compute sensitivity for some of the cavity designs from Choi &amp; Englund "Ultrastrong magnetic light-matter interaction with cavity mode engineering"</span>
<span class="n">double_reentrance</span> <span class="o">=</span> <span class="p">((</span><span class="mf">9e-7</span><span class="p">,</span> <span class="mf">2e3</span><span class="p">),</span> <span class="p">(</span><span class="mf">4e-6</span><span class="p">,</span> <span class="mf">4e3</span><span class="p">),</span> <span class="p">(</span><span class="mf">2e-5</span><span class="p">,</span> <span class="mf">1e4</span><span class="p">),</span> <span class="p">(</span><span class="mf">2e-4</span><span class="p">,</span> <span class="mf">4e4</span><span class="p">),</span> <span class="p">(</span><span class="mf">1e-3</span><span class="p">,</span> <span class="mf">8e4</span><span class="p">),</span> <span class="p">(</span><span class="mf">4e-3</span><span class="p">,</span> <span class="mf">1e5</span><span class="p">))</span>
<span class="n">dr_y_values</span><span class="p">,</span> <span class="n">dr_x_values</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">double_reentrance</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">dr_x_values</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">energy</span> <span class="o">*</span> <span class="p">(</span><span class="mf">28e9</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">mu0</span> <span class="o">/</span> <span class="mi">3</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">dr_y_values</span><span class="p">)</span><span class="o">*</span> <span class="p">(</span><span class="mf">3e8</span><span class="o">/</span><span class="mf">2.87e9</span><span class="p">)</span><span class="o">**</span><span class="mi">3</span><span class="p">)),</span> <span class="n">color</span><span class="o">=</span><span class="s1">'blue'</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">dr_x_values</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">energy</span> <span class="o">*</span> <span class="p">(</span><span class="mf">28e9</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">mu0</span> <span class="o">/</span> <span class="mi">3</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">dr_y_values</span><span class="p">)</span><span class="o">*</span> <span class="p">(</span><span class="mf">3e8</span><span class="o">/</span><span class="mf">2.87e9</span><span class="p">)</span><span class="o">**</span><span class="mi">3</span><span class="p">)),</span> <span class="n">color</span><span class="o">=</span><span class="s1">'blue'</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'Double Re-entrance'</span><span class="p">)</span>
<span class="c1"># long_squeeze = ((7e-4,2e3), (3e-3,1e4), (7e-3, 2e4), (1e-2,4e4), (4e-2,9e4), (7e-2,1e5), (1e-1,2e5))</span>
<span class="c1"># long_y_values, long_x_values = zip(*long_squeeze)</span>
<span class="c1"># plt.scatter(np.array(long_x_values), np.sqrt(energy * (28e9)**2 * mu0 / 3 / (np.array(long_y_values)* (3e8/2.87e9))), color='white', s=50, zorder=5, label='Longitudinally Squeezed')</span>
<span class="n">tapered</span> <span class="o">=</span> <span class="p">((</span><span class="mf">1e-7</span><span class="p">,</span> <span class="mf">2e3</span><span class="p">),</span> <span class="p">(</span><span class="mf">7e-7</span><span class="p">,</span><span class="mf">7e3</span><span class="p">),</span> <span class="p">(</span><span class="mf">2e-6</span><span class="p">,</span> <span class="mf">1e4</span><span class="p">),(</span><span class="mf">5e-5</span><span class="p">,</span><span class="mf">5e4</span><span class="p">))</span>
<span class="n">tapered_y_values</span><span class="p">,</span> <span class="n">tapered_x_values</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">tapered</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">tapered_x_values</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">energy</span> <span class="o">*</span> <span class="p">(</span><span class="mf">28e9</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">mu0</span> <span class="o">/</span> <span class="mi">3</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">tapered_y_values</span><span class="p">)</span><span class="o">*</span> <span class="p">(</span><span class="mf">3e8</span><span class="o">/</span><span class="mf">2.87e9</span><span class="p">)</span><span class="o">**</span><span class="mi">3</span><span class="p">)),</span> <span class="n">color</span><span class="o">=</span><span class="s1">'green'</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">tapered_x_values</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">energy</span> <span class="o">*</span> <span class="p">(</span><span class="mf">28e9</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">mu0</span> <span class="o">/</span> <span class="mi">3</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">tapered_y_values</span><span class="p">)</span><span class="o">*</span> <span class="p">(</span><span class="mf">3e8</span><span class="o">/</span><span class="mf">2.87e9</span><span class="p">)</span><span class="o">**</span><span class="mi">3</span><span class="p">)),</span> <span class="n">color</span><span class="o">=</span><span class="s1">'green'</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'Tapered Double Re-entrance'</span><span class="p">)</span>

<span class="n">V_comsol</span> <span class="o">=</span> <span class="mf">1.128e-16</span><span class="o">/</span><span class="p">((</span><span class="mf">1.8026e-5</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="n">Q_comsol</span> <span class="o">=</span> <span class="mf">3.1972e9</span> <span class="o">*</span> <span class="n">mu0</span> <span class="o">*</span><span class="mf">1.128e-16</span> <span class="o">/</span><span class="mf">2.2154e-14</span><span class="o">/</span><span class="mf">1e-3</span>
<span class="c1"># plt.scatter(Q_comsol,np.sqrt(6.626e-34 * 3.1972e9 * (28e9)**2 * mu0 / 3 / V_comsol), color='violet', zorder=5, s=50, label='COMSOL Model')</span>

<span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">energy</span> <span class="o">*</span> <span class="p">(</span><span class="mf">28e9</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">mu0</span> <span class="o">/</span> <span class="mi">3</span> <span class="o">/</span> <span class="n">Vd</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/bdc8bca427deb4b433ed727630d6137ac2830687f421181576b9297940f77310.png" src="_images/bdc8bca427deb4b433ed727630d6137ac2830687f421181576b9297940f77310.png"/>
</div>
</div>
<p>COMSOL simulation of double re-entrance cavity in Choi &amp; Englund “Ultrastrong magnetic light-matter interaction with cavity mode engineering”
<img alt="Double_reentrance_B_Field2.png" src="attachment:Double_reentrance_B_Field2.png"/></p>
<p>Through simulation, we determine a quality factor of <span class="math notranslate nohighlight">\(2x10^{4}\)</span> and mode volume of <span class="math notranslate nohighlight">\(3.47x10^{-7}m^{3}\)</span>.</p>
</section>
<section id="power-scaling">
<h3>Power Scaling<a class="headerlink" href="#power-scaling" title="Link to this heading">#</a></h3>
<section id="linear-scaling">
<h4>Linear Scaling<a class="headerlink" href="#linear-scaling" title="Link to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">matplotlib.colors</span> <span class="kn">import</span> <span class="n">LogNorm</span>

<span class="n">P_per_NV</span> <span class="o">=</span> <span class="mi">8</span><span class="o">/</span><span class="p">(</span><span class="mf">3e-3</span><span class="o">*</span><span class="mf">3e-3</span><span class="o">*</span><span class="mf">0.9e-3</span><span class="o">*</span><span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="mf">3.51</span> <span class="o">/</span> <span class="mf">12.01</span> <span class="o">*</span> <span class="mf">6.022e23</span><span class="p">))</span>

<span class="n">rho_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">r1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="o">-</span><span class="mf">3.5</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">Vd</span> <span class="o">=</span> <span class="mf">3e-3</span> <span class="o">*</span> <span class="mf">3e-3</span> <span class="o">*</span> <span class="mf">0.9e-3</span>   <span class="c1"># diamond volume</span>
<span class="n">V0list</span> <span class="o">=</span> <span class="n">Vd</span> <span class="o">*</span> <span class="n">r1</span>  
<span class="n">powers_lin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">V0list</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">rho_list</span><span class="p">)))</span>

<span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">r1</span><span class="p">)):</span>
    <span class="n">V0</span> <span class="o">=</span> <span class="n">V0list</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span>   <span class="c1"># diamond volume</span>
    <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">rho_list</span><span class="p">)):</span>
        <span class="n">rho</span> <span class="o">=</span> <span class="n">rho_list</span><span class="p">[</span><span class="n">jj</span><span class="p">]</span>
        <span class="n">power</span> <span class="o">=</span> <span class="n">P_per_NV</span> <span class="o">*</span> <span class="n">V0</span> <span class="o">*</span> <span class="p">(</span><span class="n">rho</span> <span class="o">*</span> <span class="mf">3.51</span> <span class="o">/</span> <span class="mf">12.01</span> <span class="o">*</span> <span class="mf">6.022e23</span><span class="p">)</span>
        <span class="n">powers_lin</span><span class="p">[</span><span class="n">ii</span><span class="p">,</span> <span class="n">jj</span><span class="p">]</span> <span class="o">=</span> <span class="n">power</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># This cell relies on running the Sensitivity Optimization over Diamond Volume and NV Density code</span>
<span class="c1"># This shows how power scales linearly with the number of NVs, assuming a standard of 8W for our current </span>
<span class="c1"># experimental setup</span>

<span class="c1"># Create the figure</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>

<span class="c1"># Calculate rr2 and set the image plot</span>
<span class="n">rr2</span> <span class="o">=</span> <span class="n">rho_list</span> <span class="o">*</span> <span class="mi">4</span>
<span class="n">mu0</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="mf">1e-7</span>
<span class="n">energy</span> <span class="o">=</span> <span class="mf">6.626e-34</span> <span class="o">*</span> <span class="mf">2.87e9</span>   <span class="c1"># h * f</span>
<span class="n">gs</span> <span class="o">=</span> <span class="mf">0.019</span>   <span class="c1"># single coupling strength  </span>
<span class="n">V</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">*</span> <span class="n">energy</span> <span class="o">/</span> <span class="mi">3</span> <span class="o">/</span> <span class="n">gs</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="mf">28e9</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">mu0</span>  <span class="c1"># 2/3 due to the geometry factor</span>
<span class="n">rr1</span> <span class="o">=</span> <span class="n">V0list</span> <span class="o">/</span> <span class="n">V</span>

<span class="c1"># Create a meshgrid for rr2 and rr1</span>
<span class="n">RR2</span><span class="p">,</span> <span class="n">RR1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">rr2</span><span class="p">,</span> <span class="n">rr1</span><span class="p">)</span>

<span class="c1"># Plot the data using pcolormesh</span>
<span class="n">plt</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">RR2</span><span class="p">,</span> <span class="n">RR1</span><span class="p">,</span> <span class="n">powers_lin</span><span class="p">,</span> <span class="n">shading</span><span class="o">=</span><span class="s1">'auto'</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">LogNorm</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">powers_lin</span><span class="p">),</span> <span class="n">vmax</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">powers_lin</span><span class="p">)),</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">'hot'</span><span class="p">)</span>

<span class="c1"># Set scales to log</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xscale</span><span class="p">(</span><span class="s1">'log'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yscale</span><span class="p">(</span><span class="s1">'log'</span><span class="p">)</span>

<span class="c1"># Add color bar and label it</span>
<span class="n">cbar</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
<span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">'Power (W)'</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">270</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>

<span class="c1"># Set axis labels and limits</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">'$\rho$(ppm)'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">'V$_</span><span class="si">{d}</span><span class="s1">$/V$_</span><span class="si">{0}</span><span class="s1">$'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="mf">1e-2</span><span class="p">,</span> <span class="mf">1e3</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="mf">2e-4</span><span class="p">,</span> <span class="mf">4.68</span><span class="p">])</span>

<span class="c1"># Generate contour levels</span>
<span class="n">contour_levels</span> <span class="o">=</span> <span class="p">[</span><span class="mf">2e-15</span><span class="p">,</span> <span class="mf">1e-14</span><span class="p">,</span> <span class="mf">1e-13</span><span class="p">,</span> <span class="mf">1e-12</span><span class="p">]</span>
<span class="n">contour</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">RR2</span><span class="p">,</span> <span class="n">RR1</span><span class="p">,</span> <span class="n">sens_Vd_rho</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="n">contour_levels</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="s1">'black'</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">linestyles</span><span class="o">=</span><span class="s1">'--'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">clabel</span><span class="p">(</span><span class="n">contour</span><span class="p">,</span> <span class="n">inline</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">'</span><span class="si">%.1e</span><span class="s1">'</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="s1">'black'</span><span class="p">)</span>

<span class="c1"># Generate contour levels</span>
<span class="n">contour_levels</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1e-2</span><span class="p">,</span> <span class="mf">1e0</span><span class="p">,</span> <span class="mf">1e2</span><span class="p">]</span>
<span class="n">contour</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">RR2</span><span class="p">,</span> <span class="n">RR1</span><span class="p">,</span> <span class="n">powers_lin</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="n">contour_levels</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="s1">'white'</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">linestyles</span><span class="o">=</span><span class="s1">'--'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">clabel</span><span class="p">(</span><span class="n">contour</span><span class="p">,</span> <span class="n">inline</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="sa">f</span><span class="s1">'</span><span class="si">{</span><span class="n">x</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1"> W'</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="s1">'white'</span><span class="p">)</span>

<span class="c1"># plt.text(1, 0.0004, r'1 pT/$\sqrt{Hz}$', fontsize=18, color='black')</span>
<span class="c1"># plt.text(60, 0.0035, r'100 fT/$\sqrt{Hz}$', fontsize=18, color='black')</span>
<span class="c1"># plt.text(80, 0.035, r'10 fT/$\sqrt{Hz}$', fontsize=18, color='black')</span>
<span class="c1"># plt.text(100, 0.2, r'2 fT/$\sqrt{Hz}$', fontsize=18, color='black')</span>


<span class="c1"># Show the plot</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/c551ccd51926524a1dd951fd5c050764eb4c42e3075bb45ef75749eb01a6de6a.png" src="_images/c551ccd51926524a1dd951fd5c050764eb4c42e3075bb45ef75749eb01a6de6a.png"/>
</div>
</div>
<p>This shows how power scales with sensitivity in the current setup we have with our dielectric resonator.</p>
</section>
</section>
<section id="power-optimization">
<h3>Power Optimization<a class="headerlink" href="#power-optimization" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">min_power_linear</span><span class="p">(</span><span class="n">max_sens</span><span class="p">,</span> <span class="n">V</span><span class="p">,</span> <span class="n">Q</span><span class="p">,</span> <span class="n">gammao</span><span class="p">,</span> <span class="n">PowerList</span><span class="p">,</span> <span class="n">vot</span><span class="p">,</span> <span class="n">energy</span><span class="p">,</span> <span class="n">gs</span><span class="p">,</span> <span class="n">kc</span><span class="p">,</span> <span class="n">kc1</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    Locate the minimum power that can achieve some sensitivity value max_sense or better based on linear scaling</span>
<span class="sd">    of optical power with number of NVs. This is based on our current setup which uses 8W with a 3x3x0.9mm diamond </span>
<span class="sd">    and 4ppm NV density. Diamond volume and NV density are the parameters optimized over.</span>
<span class="sd">    """</span>
    
    <span class="c1"># Our current setup has 8W with a 3x3x0.9mm diamond and 4ppm NV density</span>
    <span class="n">P_per_NV</span> <span class="o">=</span> <span class="mi">8</span><span class="o">/</span><span class="p">(</span><span class="mf">3e-3</span><span class="o">*</span><span class="mf">3e-3</span><span class="o">*</span><span class="mf">0.9e-3</span><span class="o">*</span><span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="mf">3.51</span> <span class="o">/</span> <span class="mf">12.01</span> <span class="o">*</span> <span class="mf">6.022e23</span><span class="p">))</span> 
    <span class="n">rholist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">50</span><span class="p">)</span>
    <span class="n">Vdlist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">50</span><span class="p">)</span> <span class="o">*</span> <span class="mf">3e-3</span><span class="o">*</span><span class="mf">3e-3</span><span class="o">*</span><span class="mf">0.9e-3</span>
    <span class="n">powers</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">Vds</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">rhos</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Vdlist</span><span class="p">)):</span>
        <span class="n">Vd</span><span class="o">=</span><span class="n">Vdlist</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">rholist</span><span class="p">)):</span>
            <span class="n">rho</span><span class="o">=</span><span class="n">rholist</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
            <span class="n">rhomax</span> <span class="o">=</span> <span class="mf">0.1231</span> <span class="o">*</span> <span class="mi">4</span> <span class="o">*</span> <span class="mf">1e-6</span> <span class="o">/</span> <span class="n">Vd</span>
            <span class="k">if</span> <span class="n">rho</span><span class="o">&gt;</span><span class="n">rhomax</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">sensi</span> <span class="o">=</span> <span class="n">compute_sens</span><span class="p">(</span><span class="n">rho</span><span class="p">,</span> <span class="n">gammao</span><span class="p">,</span> <span class="n">V</span><span class="p">,</span> <span class="n">Q</span><span class="p">,</span> <span class="n">PowerList</span><span class="p">,</span> <span class="n">vot</span><span class="p">,</span> <span class="n">energy</span><span class="p">,</span> <span class="n">gs</span><span class="p">,</span> <span class="n">kc</span><span class="p">,</span> <span class="n">kc1</span><span class="p">,</span> <span class="n">Vd</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">sensi</span> <span class="o">&lt;</span> <span class="n">max_sens</span><span class="p">:</span>
                <span class="n">power</span> <span class="o">=</span> <span class="n">P_per_NV</span> <span class="o">*</span> <span class="n">Vd</span> <span class="o">*</span> <span class="p">(</span><span class="n">rho</span> <span class="o">*</span> <span class="mf">3.51</span> <span class="o">/</span> <span class="mf">12.01</span> <span class="o">*</span> <span class="mf">6.022e23</span><span class="p">)</span> 
                <span class="n">powers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">power</span><span class="p">)</span>
                <span class="n">Vds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Vd</span><span class="p">)</span>
                <span class="n">rhos</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rho</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">powers</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>
    <span class="n">min_index</span> <span class="o">=</span> <span class="n">powers</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">powers</span><span class="p">))</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">powers</span><span class="p">[</span><span class="n">min_index</span><span class="p">],</span> <span class="n">Vds</span><span class="p">[</span><span class="n">min_index</span><span class="p">],</span> <span class="n">rhos</span><span class="p">[</span><span class="n">min_index</span><span class="p">]]</span>
            
    
</pre></div>
</div>
</div>
</div>
<section id="current-experimental-setup">
<h4>Current Experimental Setup<a class="headerlink" href="#current-experimental-setup" title="Link to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="c1"># Compute sensitivity and power with our current experimental setup's parameters</span>

<span class="n">P_per_NV</span> <span class="o">=</span> <span class="mi">8</span><span class="o">/</span><span class="p">(</span><span class="mf">3e-3</span><span class="o">*</span><span class="mf">3e-3</span><span class="o">*</span><span class="mf">0.9e-3</span><span class="o">*</span><span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="mf">3.51</span> <span class="o">/</span> <span class="mf">12.01</span> <span class="o">*</span> <span class="mf">6.022e23</span><span class="p">))</span>
<span class="n">Q</span> <span class="o">=</span> <span class="mf">2.2e4</span>
<span class="n">V</span> <span class="o">=</span> <span class="mf">1.7</span> <span class="o">/</span> <span class="p">(</span><span class="mi">100</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span>
<span class="n">omega</span> <span class="o">=</span> <span class="mf">2.87e9</span>
<span class="n">w</span> <span class="o">=</span> <span class="mf">3e-3</span>
<span class="n">L</span> <span class="o">=</span> <span class="mf">9e-4</span>
<span class="n">Vd</span> <span class="o">=</span> <span class="n">w</span><span class="o">*</span><span class="n">w</span><span class="o">*</span><span class="n">L</span>
<span class="n">rho</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.45</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">*</span><span class="n">rho</span><span class="o">/</span><span class="mf">0.1</span>
<span class="n">I</span><span class="o">=</span><span class="mi">18800</span>
<span class="n">gammao</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="mi">270</span><span class="o">+</span><span class="mf">0.38</span><span class="o">*</span><span class="n">I</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">90</span><span class="o">+</span><span class="mf">0.58</span><span class="o">*</span><span class="n">I</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">270</span><span class="o">+</span><span class="mf">1.08</span><span class="o">*</span><span class="n">I</span><span class="p">)</span>
<span class="n">PowerList</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">70</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">51</span><span class="p">)</span>
<span class="n">vot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="n">PowerList</span> <span class="o">/</span> <span class="mi">10</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1e-3</span> <span class="o">*</span> <span class="mi">50</span><span class="p">)</span>
<span class="n">mu0</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="mf">1e-7</span>   
<span class="n">energy</span> <span class="o">=</span> <span class="mf">6.626e-34</span> <span class="o">*</span> <span class="n">omega</span>   <span class="c1">#h*omega</span>
<span class="n">gs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">energy</span> <span class="o">*</span> <span class="p">(</span><span class="mf">28e9</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">mu0</span> <span class="o">/</span> <span class="mi">3</span> <span class="o">/</span> <span class="n">V</span><span class="p">)</span>   <span class="c1">#single coupling strength</span>
<span class="n">Gamma</span> <span class="o">=</span> <span class="mf">330e3</span><span class="o">/</span><span class="mi">4</span> <span class="o">*</span><span class="n">rho</span>
<span class="n">kc0</span> <span class="o">=</span> <span class="mf">130e3</span>   <span class="c1"># cavity linewidth</span>
<span class="n">kc1</span> <span class="o">=</span> <span class="mf">130e3</span>   <span class="c1"># cavity loop coupling</span>
<span class="n">kc</span> <span class="o">=</span> <span class="n">kc0</span> <span class="o">+</span> <span class="n">kc1</span>   <span class="c1"># cavity loss</span>

<span class="n">rhomax</span> <span class="o">=</span> <span class="mf">0.1231</span> <span class="o">*</span> <span class="mi">4</span> <span class="o">*</span> <span class="mf">1e-6</span> <span class="o">/</span> <span class="n">Vd</span>
<span class="k">if</span> <span class="n">rho</span><span class="o">&gt;</span><span class="n">rhomax</span><span class="p">:</span>
    <span class="n">rho</span><span class="o">=</span><span class="n">rhomax</span>

<span class="n">current_sensitivity</span> <span class="o">=</span> <span class="n">compute_sens</span><span class="p">(</span><span class="n">rho</span><span class="p">,</span> <span class="n">gammao</span><span class="p">,</span> <span class="n">V</span><span class="p">,</span> <span class="n">Q</span><span class="p">,</span> <span class="n">PowerList</span><span class="p">,</span> <span class="n">vot</span><span class="p">,</span> <span class="n">energy</span><span class="p">,</span> <span class="n">gs</span><span class="p">,</span> <span class="n">kc</span><span class="p">,</span> <span class="n">kc1</span><span class="p">,</span> <span class="n">Vd</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">'Sensitivity with current experimental setup: </span><span class="si">{</span><span class="n">current_sensitivity</span><span class="si">:</span><span class="s1">.2e</span><span class="si">}</span><span class="s1">'</span><span class="p">)</span>
<span class="n">current_power</span> <span class="o">=</span> <span class="n">P_per_NV</span> <span class="o">*</span> <span class="p">(</span><span class="n">Vd</span><span class="o">*</span><span class="p">(</span><span class="n">rho</span> <span class="o">*</span> <span class="mf">3.51</span> <span class="o">/</span> <span class="mf">12.01</span> <span class="o">*</span> <span class="mf">6.022e23</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">'Power used with current experimental setup: </span><span class="si">{</span><span class="n">current_power</span><span class="si">:</span><span class="s1">.2e</span><span class="si">}</span><span class="s1"> W'</span><span class="p">)</span>
<span class="n">power_100fT</span><span class="p">,</span> <span class="n">Vd_100fT</span><span class="p">,</span> <span class="n">rho_100fT</span> <span class="o">=</span> <span class="n">min_power_linear</span><span class="p">(</span><span class="mf">100e-15</span><span class="p">,</span> <span class="n">V</span><span class="p">,</span> <span class="n">Q</span><span class="p">,</span> <span class="n">gammao</span><span class="p">,</span> <span class="n">PowerList</span><span class="p">,</span> <span class="n">vot</span><span class="p">,</span> <span class="n">energy</span><span class="p">,</span> <span class="n">gs</span><span class="p">,</span> <span class="n">kc</span><span class="p">,</span> <span class="n">kc1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">'Power needed to reach 100fT sensitivity with current experimental setup: </span><span class="si">{</span><span class="n">power_100fT</span><span class="si">:</span><span class="s1">.2e</span><span class="si">}</span><span class="s1"> W'</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">'At this optimal point: Diamond Volume: </span><span class="si">{</span><span class="n">Vd_100fT</span><span class="si">:</span><span class="s1">.2e</span><span class="si">}</span><span class="s1"> m^3   NV Density: </span><span class="si">{</span><span class="n">rho_100fT</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1"> ppm'</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Sensitivity with current experimental setup: 2.80e-13
Power used with current experimental setup: 8.00e+00 W
Power needed to reach 100fT sensitivity with current experimental setup: 8.19e-01 W
At this optimal point: Diamond Volume: 1.56e-07 m^3   NV Density: 0.021 ppm
</pre></div>
</div>
</div>
</div>
</section>
<section id="id1">
<h4>Power Optimization<a class="headerlink" href="#id1" title="Link to this heading">#</a></h4>
</section>
<section id="note-this-next-three-cells-are-commented-out-because-this-process-takes-a-long-time-to-run">
<h4>NOTE: This next three cells are commented out because this process takes a long time to run<a class="headerlink" href="#note-this-next-three-cells-are-commented-out-because-this-process-takes-a-long-time-to-run" title="Link to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># See what the minimum power is to reach some sensitivity value or better (100fT/sqrt(Hz) in this case)</span>
<span class="c1"># for different combinations of mode volume and quality factor</span>

<span class="c1"># Qlist = np.logspace(2, 6, 101)   #quality factor</span>
<span class="c1"># PowerList = np.linspace(-70, 20, 51)</span>
<span class="c1"># vot = np.sqrt(10**(PowerList / 10) * 1e-3 * 50)</span>
<span class="c1"># Vd_ref = 3e-3 * 3e-3 * 0.9e-3   #diamond volume for reference</span>
<span class="c1"># Vlist = Vd_ref * np.logspace(-6, 4, 101)   #cavity mode volume</span>
<span class="c1"># mu0 = 4 * np.pi * 1e-7   </span>
<span class="c1"># omega = 2.87e9</span>
<span class="c1"># energy = 6.626e-34 * omega   #h*omega</span>
<span class="c1"># I=18800</span>
<span class="c1"># gammao = 2*(270+0.38*I)*(90+0.58*I)/(270+1.08*I)</span>

<span class="c1"># max_sens = 100e-15</span>

<span class="c1"># sens_args = np.zeros((len(Vlist), len(Qlist)), dtype=object)</span>
<span class="c1"># opt_power_lin = np.zeros((len(Vlist), len(Qlist)))</span>
<span class="c1"># for i in range(len(Vlist)):</span>
<span class="c1">#     V=Vlist[i]</span>
<span class="c1">#     gs = np.sqrt(energy * (28e9)**2 * mu0 / 3 / V)   #single coupling strength</span>
<span class="c1">#     for j in range(len(Qlist)):</span>
<span class="c1">#         Q=Qlist[j]</span>
<span class="c1">#         kc0 = omega / Q   # cavity linewidth</span>
<span class="c1">#         kc1 = kc0    # cavity loop coupling</span>
<span class="c1">#         kc = kc0 + kc1   # cavity loss</span>
<span class="c1">#         power, Vd, rho =  min_power_linear(max_sens, V, Q, gammao, PowerList, vot, energy, gs, kc, kc1)</span>
<span class="c1">#         opt_power_lin[i,j] = power</span>
<span class="c1">#         sens_args[i,j] = np.array([Vd,rho])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># %store opt_power_lin sens_args</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># import matplotlib.pyplot as plt</span>
<span class="c1"># from matplotlib.colors import LogNorm</span>

<span class="c1"># X, Y = np.meshgrid(Qlist, np.sqrt(energy * (28e9)**2 * mu0 / 3 / Vlist))</span>
<span class="c1"># plt.figure(figsize=(10, 8))</span>
<span class="c1"># plt.pcolormesh(X,Y, opt_power_lin, shading='auto', norm=LogNorm(), cmap='hot')</span>

<span class="c1"># # Add color bar and label it</span>
<span class="c1"># cbar = plt.colorbar()</span>
<span class="c1"># cbar.set_label('Power (W)', rotation=270, labelpad=20, fontsize=16)</span>

<span class="c1"># # contour = plt.contour(X,Y, sensitivity, levels=[1.3e-14, 1e-13, 1e-12, 1e-11], colors='w', linewidths=2)</span>

<span class="c1"># plt.xscale('log')</span>
<span class="c1"># plt.yscale('log')</span>
<span class="c1"># plt.xlim([1e2, 8e5])</span>
<span class="c1"># plt.ylim([9e-3, 300])</span>
<span class="c1"># plt.title(f'Minimum power at {max_sens} T/$\sqrt{{Hz}}$ Sensitivity', fontsize=16)</span>
<span class="c1"># plt.ylabel(r'$g_{s}$(Hz)', fontsize=16)</span>
<span class="c1"># plt.xlabel('Q', fontsize=16)</span>

<span class="c1"># plt.show()</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="a-more-rigorous-method">
<h4>A more rigorous method<a class="headerlink" href="#a-more-rigorous-method" title="Link to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="kn">import</span> <span class="n">minimize</span><span class="p">,</span> <span class="n">shgo</span><span class="p">,</span> <span class="n">differential_evolution</span><span class="p">,</span> <span class="n">dual_annealing</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="k">def</span> <span class="nf">minimize_power_single</span><span class="p">(</span><span class="n">max_sens</span><span class="p">,</span> <span class="n">omega</span><span class="p">,</span> <span class="n">V</span><span class="p">,</span> <span class="n">Q</span><span class="p">,</span> <span class="n">kc0</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">kc1</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">w_bound</span><span class="o">=</span><span class="mf">1e-1</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">L</span><span class="o">=</span><span class="mf">0.9e-3</span><span class="p">):</span>
<span class="w">    </span><span class="sd">"""</span>
<span class="sd">    This is a more rigorous model of minimizing optical power to achieve some sensitivity max_sens. We</span>
<span class="sd">    fix diamond length and optimize over dimaond area, NV density, and effective optical polarization rate</span>
<span class="sd">    gammao, which is related to excitation rate and optical intensity.</span>
<span class="sd">    """</span>

    <span class="c1"># Constants and parameters</span>
    <span class="n">mu0</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="mf">1e-7</span>
    <span class="n">energy</span> <span class="o">=</span> <span class="mf">6.626e-34</span> <span class="o">*</span> <span class="n">omega</span>
    <span class="n">absorp_cs</span> <span class="o">=</span> <span class="mf">8e-17</span> <span class="o">/</span> <span class="p">(</span><span class="mi">100</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>  <span class="c1"># NV absorption cross section</span>
    <span class="n">gs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">energy</span> <span class="o">*</span> <span class="p">(</span><span class="mf">28e9</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">mu0</span> <span class="o">/</span> <span class="mi">3</span> <span class="o">/</span> <span class="n">V</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">kc0</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">kc0</span> <span class="o">=</span> <span class="n">omega</span> <span class="o">/</span> <span class="n">Q</span>
    <span class="k">if</span> <span class="n">kc1</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">kc1</span> <span class="o">=</span> <span class="n">kc0</span>
    <span class="n">kc</span> <span class="o">=</span> <span class="n">kc0</span> <span class="o">+</span> <span class="n">kc1</span>
    <span class="n">L</span> <span class="o">=</span> <span class="n">L</span> <span class="c1">#diamond length</span>
    <span class="n">PowerList</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">70</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">51</span><span class="p">)</span>
    <span class="n">vot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="n">PowerList</span> <span class="o">/</span> <span class="mi">10</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1e-3</span> <span class="o">*</span> <span class="mi">50</span><span class="p">)</span>

    <span class="c1"># Bounds for variables</span>
    <span class="n">gammao_bounds</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.3e3</span><span class="p">,</span> <span class="mf">10e3</span><span class="p">)</span>   <span class="c1"># Optical polarization rate bounds</span>
    <span class="n">w_bounds</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1e-4</span><span class="p">,</span> <span class="n">w_bound</span><span class="p">)</span>         <span class="c1"># Diamond width bounds</span>
    <span class="n">rho_bounds</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1e-2</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>           <span class="c1"># NV density bounds</span>

    <span class="n">bounds</span> <span class="o">=</span> <span class="p">[</span><span class="n">gammao_bounds</span><span class="p">,</span> <span class="n">w_bounds</span><span class="p">,</span> <span class="n">rho_bounds</span><span class="p">]</span>

    <span class="c1"># Objective function</span>
    <span class="k">def</span> <span class="nf">objective</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
        <span class="n">gammao</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">rho</span> <span class="o">=</span> <span class="n">x</span>
        <span class="n">gamma_th</span> <span class="o">=</span> <span class="mi">90</span> <span class="c1"># thermal relxation rate</span>
        <span class="n">I</span> <span class="o">=</span> <span class="mf">1.225</span> <span class="o">*</span> <span class="n">gammao</span> <span class="o">-</span> <span class="mf">4.809</span> <span class="o">*</span> <span class="n">gamma_th</span> <span class="o">+</span> <span class="mf">3.085</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">0.1577</span> <span class="o">*</span> <span class="n">gammao</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="mf">0.5229</span> <span class="o">*</span> <span class="n">gammao</span> <span class="o">*</span> <span class="n">gamma_th</span> <span class="o">+</span> <span class="n">gamma_th</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">power</span> <span class="o">=</span> <span class="n">w</span> <span class="o">*</span> <span class="n">w</span> <span class="o">*</span> <span class="p">(</span><span class="mf">6.626e-34</span><span class="o">*</span><span class="p">(</span><span class="mf">3e8</span><span class="o">/</span><span class="mf">532e-9</span><span class="p">))</span> <span class="o">*</span> <span class="n">I</span> <span class="o">/</span> <span class="n">absorp_cs</span> 
        <span class="k">return</span> <span class="n">power</span>

    <span class="c1"># Constraint: Sensitivity must be less than or equal to max_sens</span>
    <span class="k">def</span> <span class="nf">constraint_sens</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
        <span class="n">gammao</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">rho</span> <span class="o">=</span> <span class="n">x</span>
        <span class="n">Vd</span> <span class="o">=</span> <span class="n">w</span><span class="o">*</span><span class="n">w</span><span class="o">*</span><span class="n">L</span> 
        <span class="n">sens</span> <span class="o">=</span> <span class="n">compute_sens</span><span class="p">(</span><span class="n">rho</span><span class="p">,</span> <span class="n">gammao</span><span class="p">,</span> <span class="n">V</span><span class="p">,</span> <span class="n">Q</span><span class="p">,</span> <span class="n">PowerList</span><span class="p">,</span> <span class="n">vot</span><span class="p">,</span> <span class="n">energy</span><span class="p">,</span> <span class="n">gs</span><span class="p">,</span> <span class="n">kc</span><span class="p">,</span> <span class="n">kc1</span><span class="p">,</span> <span class="n">Vd</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">max_sens</span> <span class="o">-</span> <span class="n">sens</span>  <span class="c1"># Ensure sens &lt;= max_sens</span>

    <span class="n">constraints</span> <span class="o">=</span> <span class="p">[{</span><span class="s1">'type'</span><span class="p">:</span> <span class="s1">'ineq'</span><span class="p">,</span> <span class="s1">'fun'</span><span class="p">:</span> <span class="n">constraint_sens</span><span class="p">}]</span>

    <span class="c1"># Use a global optimizer to find the minimum power</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">shgo</span><span class="p">(</span><span class="n">objective</span><span class="p">,</span> <span class="n">bounds</span><span class="p">,</span> <span class="n">constraints</span><span class="o">=</span><span class="n">constraints</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">res</span><span class="o">.</span><span class="n">success</span><span class="p">:</span>
        <span class="n">min_power</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">fun</span>
        <span class="n">min_params</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">x</span>
        <span class="k">return</span> <span class="n">min_power</span><span class="p">,</span> <span class="n">min_params</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">minimize_power_VQ</span><span class="p">(</span><span class="n">max_sens</span><span class="p">,</span> <span class="n">omega</span><span class="p">,</span> <span class="n">Vlist</span><span class="p">,</span> <span class="n">Qlist</span><span class="p">):</span>
    <span class="c1"># Find the minimum power over a range of Vs and Qs</span>
    <span class="n">opt_power</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">Vlist</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">Qlist</span><span class="p">)))</span>
    <span class="n">sens_args</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">Vlist</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">Qlist</span><span class="p">)),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">ii</span><span class="p">,</span> <span class="n">V</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">Vlist</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">jj</span><span class="p">,</span> <span class="n">Q</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">Qlist</span><span class="p">):</span>
            <span class="n">min_power</span><span class="p">,</span> <span class="n">min_params</span> <span class="o">=</span> <span class="n">minimize_power_single</span><span class="p">(</span><span class="n">max_sens</span><span class="p">,</span> <span class="n">omega</span><span class="p">,</span> <span class="n">V</span><span class="p">,</span> <span class="n">Q</span><span class="p">)</span>
            <span class="n">opt_power</span><span class="p">[</span><span class="n">ii</span><span class="p">,</span> <span class="n">jj</span><span class="p">]</span> <span class="o">=</span> <span class="n">min_power</span>
            <span class="n">sens_args</span><span class="p">[</span><span class="n">ii</span><span class="p">,</span> <span class="n">jj</span><span class="p">]</span> <span class="o">=</span> <span class="n">min_params</span>

    <span class="k">return</span> <span class="n">opt_power</span><span class="p">,</span> <span class="n">sens_args</span>
</pre></div>
</div>
</div>
</div>
<section id="id2">
<h5>Current Experimental Setup<a class="headerlink" href="#id2" title="Link to this heading">#</a></h5>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="c1"># Compute sensitivity and power with our current experimental setup's parameters</span>

<span class="n">Q</span> <span class="o">=</span> <span class="mf">2.2e4</span>
<span class="n">V</span> <span class="o">=</span> <span class="mf">1.7</span> <span class="o">/</span> <span class="p">(</span><span class="mi">100</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span>
<span class="n">omega</span> <span class="o">=</span> <span class="mf">2.87e9</span>
<span class="n">absorp_cs</span> <span class="o">=</span> <span class="mf">8e-17</span> <span class="o">/</span> <span class="p">(</span><span class="mi">100</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="n">w</span> <span class="o">=</span> <span class="mf">3e-3</span>
<span class="n">L</span> <span class="o">=</span> <span class="mf">9e-4</span>
<span class="n">Vd</span> <span class="o">=</span> <span class="n">w</span><span class="o">*</span><span class="n">w</span><span class="o">*</span><span class="n">L</span>
<span class="n">rho</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.45</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">*</span> <span class="p">(</span><span class="n">rho</span><span class="o">/</span><span class="mf">0.1</span><span class="p">)</span>
<span class="n">PowerList</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">70</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">51</span><span class="p">)</span>
<span class="n">vot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="n">PowerList</span> <span class="o">/</span> <span class="mi">10</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1e-3</span> <span class="o">*</span> <span class="mi">50</span><span class="p">)</span>
<span class="n">mu0</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="mf">1e-7</span>   
<span class="n">energy</span> <span class="o">=</span> <span class="mf">6.626e-34</span> <span class="o">*</span> <span class="n">omega</span>   <span class="c1">#h*omega</span>
<span class="n">gs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">energy</span> <span class="o">*</span> <span class="p">(</span><span class="mf">28e9</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">mu0</span> <span class="o">/</span> <span class="mi">3</span> <span class="o">/</span> <span class="n">V</span><span class="p">)</span>   <span class="c1">#single coupling strength</span>
<span class="n">Gamma</span> <span class="o">=</span> <span class="mf">330e3</span><span class="o">/</span><span class="mi">4</span> <span class="o">*</span><span class="n">rho</span>
<span class="n">kc0</span> <span class="o">=</span> <span class="mf">130e3</span>   <span class="c1"># cavity linewidth</span>
<span class="n">kc1</span> <span class="o">=</span> <span class="mf">130e3</span>   <span class="c1"># cavity loop coupling</span>
<span class="n">kc</span> <span class="o">=</span> <span class="n">kc0</span> <span class="o">+</span> <span class="n">kc1</span>   <span class="c1"># cavity loss</span>
<span class="n">gamma_th</span> <span class="o">=</span> <span class="mi">90</span> <span class="c1"># thermal relxation rate</span>
<span class="n">I</span><span class="o">=</span><span class="mi">18800</span>
<span class="n">gammao</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="mi">270</span><span class="o">+</span><span class="mf">0.38</span><span class="o">*</span><span class="n">I</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">90</span><span class="o">+</span><span class="mf">0.58</span><span class="o">*</span><span class="n">I</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">270</span><span class="o">+</span><span class="mf">1.08</span><span class="o">*</span><span class="n">I</span><span class="p">)</span>

<span class="n">rhomax</span> <span class="o">=</span> <span class="mf">0.1231</span> <span class="o">*</span> <span class="mi">4</span> <span class="o">*</span> <span class="mf">1e-6</span> <span class="o">/</span> <span class="n">Vd</span>
<span class="k">if</span> <span class="n">rho</span><span class="o">&gt;</span><span class="n">rhomax</span><span class="p">:</span>
    <span class="n">rho</span><span class="o">=</span><span class="n">rhomax</span>

<span class="n">current_sensitivity</span> <span class="o">=</span> <span class="n">compute_sens</span><span class="p">(</span><span class="n">rho</span><span class="p">,</span> <span class="n">gammao</span><span class="p">,</span> <span class="n">V</span><span class="p">,</span> <span class="n">Q</span><span class="p">,</span> <span class="n">PowerList</span><span class="p">,</span> <span class="n">vot</span><span class="p">,</span> <span class="n">energy</span><span class="p">,</span> <span class="n">gs</span><span class="p">,</span> <span class="n">kc</span><span class="p">,</span> <span class="n">kc1</span><span class="p">,</span> <span class="n">Vd</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">'Sensitivity with current experimental setup: </span><span class="si">{</span><span class="n">current_sensitivity</span><span class="si">:</span><span class="s1">.2e</span><span class="si">}</span><span class="s1">'</span><span class="p">)</span>
<span class="n">current_power</span> <span class="o">=</span> <span class="n">w</span> <span class="o">*</span> <span class="n">w</span> <span class="o">*</span> <span class="p">(</span><span class="mf">6.626e-34</span><span class="o">*</span><span class="p">(</span><span class="mf">3e8</span><span class="o">/</span><span class="mf">532e-9</span><span class="p">))</span> <span class="o">*</span> <span class="n">I</span> <span class="o">/</span> <span class="n">absorp_cs</span> 
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">'Power used with current experimental setup: </span><span class="si">{</span><span class="n">current_power</span><span class="si">:</span><span class="s1">.2e</span><span class="si">}</span><span class="s1"> W'</span><span class="p">)</span>
<span class="n">current_power_100fT</span><span class="p">,</span> <span class="n">sens_args_current_100fT</span> <span class="o">=</span> <span class="n">minimize_power_single</span><span class="p">(</span><span class="mf">100e-15</span><span class="p">,</span> <span class="n">omega</span><span class="p">,</span> <span class="n">V</span><span class="p">,</span> <span class="n">Q</span><span class="p">,</span> <span class="n">kc0</span><span class="o">=</span><span class="n">kc0</span><span class="p">,</span> <span class="n">kc1</span><span class="o">=</span><span class="n">kc1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">'Power needed to reach 100fT sensitivity with current experimental setup: </span><span class="si">{</span><span class="n">current_power_100fT</span><span class="si">:</span><span class="s1">.2e</span><span class="si">}</span><span class="s1">'</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">'At this optimal point: Diamond Volume: </span><span class="si">{</span><span class="p">(</span><span class="n">L</span><span class="o">*</span><span class="n">sens_args_current_100fT</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="si">:</span><span class="s1">.2e</span><span class="si">}</span><span class="s1"> m^3  '</span>
      <span class="sa">f</span><span class="s1">'NV Density: </span><span class="si">{</span><span class="n">sens_args_current_100fT</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1"> ppm  '</span>
      <span class="sa">f</span><span class="s1">'Optical Excitation Rate: </span><span class="si">{</span><span class="n">sens_args_current_100fT</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1"> Hz'</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Sensitivity with current experimental setup: 2.80e-13
Power used with current experimental setup: 7.90e+00 W
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Power needed to reach 100fT sensitivity with current experimental setup: 9.40e-01
At this optimal point: Diamond Volume: 8.48e-08 m^3  NV Density: 0.031 ppm  Optical Excitation Rate: 300.000 Hz
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/Users/johnrich/anaconda3/lib/python3.11/site-packages/scipy/optimize/_optimize.py:404: RuntimeWarning: Values in x were outside bounds during a minimize step, clipping to bounds
  warnings.warn("Values in x were outside bounds during a "
</pre></div>
</div>
</div>
</div>
</section>
<section id="id3">
<h5>Power Optimization<a class="headerlink" href="#id3" title="Link to this heading">#</a></h5>
</section>
</section>
<section id="id4">
<h4>NOTE: This next three cells are commented out because this process takes a long time to run<a class="headerlink" href="#id4" title="Link to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># import numpy as np</span>
<span class="c1"># import time</span>
<span class="c1"># # Find minimum power to reach 100fT/sqrt(Hz) for different V and Q values</span>
<span class="c1"># # NOTE: This cell takes a long time to run, consider saving data that it produces</span>
<span class="c1"># Qlist = np.logspace(2, 6, 101)   #quality factor</span>
<span class="c1"># Vd_ref = 3e-3 * 3e-3 * 0.9e-3   #diamond volume for reference</span>
<span class="c1"># Vlist = Vd_ref * np.logspace(-6, 4, 101)   #cavity mode volume</span>
<span class="c1"># omega = 2.87e9</span>
<span class="c1"># max_sens = 1e-13</span>
<span class="c1"># power_100fT,sens_args_100fT = minimize_power_VQ(max_sens, omega, Vlist, Qlist)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># %store power_100fT sens_args_100fT</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># import matplotlib.pyplot as plt</span>
<span class="c1"># from matplotlib.colors import LogNorm</span>

<span class="c1"># Qlist = np.logspace(2, 6, 101)   #quality factor</span>
<span class="c1"># omega = 2.87e9</span>
<span class="c1"># Vd_ref = 3e-3 * 3e-3 * 0.9e-3   #diamond volume for reference</span>
<span class="c1"># Vlist = Vd_ref * np.logspace(-6, 4, 101)   #cavity mode volume</span>
<span class="c1"># mu0 = 4 * np.pi * 1e-7   </span>
<span class="c1"># energy = 6.626e-34 * omega   #h*omega</span>

<span class="c1"># X, Y = np.meshgrid(Qlist, np.sqrt(energy * (28e9)**2 * mu0 / 3 / Vlist))</span>
<span class="c1"># plt.figure(figsize=(10, 8))</span>
<span class="c1"># plt.pcolormesh(X,Y, power_100fT, shading='auto', norm=LogNorm(), cmap='hot')</span>

<span class="c1"># # Add color bar and label it</span>
<span class="c1"># cbar = plt.colorbar()</span>
<span class="c1"># cbar.set_label('Power (W)', rotation=270, labelpad=20, fontsize=16)</span>

<span class="c1"># # contour = plt.contour(X,Y, sensitivity, levels=[1.3e-14, 1e-13, 1e-12, 1e-11], colors='w', linewidths=2)</span>

<span class="c1"># plt.xscale('log')</span>
<span class="c1"># plt.yscale('log')</span>
<span class="c1"># plt.xlim([1e2, 8e5])</span>
<span class="c1"># plt.ylim([9e-3, 300])</span>
<span class="c1"># plt.title(f'Minimum power at {max_sens} T/$\sqrt{{Hz}}$ Sensitivity', fontsize=16)</span>
<span class="c1"># plt.ylabel(r'$g_{s}$(Hz)', fontsize=16)</span>
<span class="c1"># plt.xlabel('Q', fontsize=16)</span>

<span class="c1"># plt.show()</span>
</pre></div>
</div>
</div>
</div>
<p>Intuition gathered from this plot is that as mode volume decreases, and thus single coupling strength increases, we can adjust diamond dimensions to make the diamond smaller while still getting near a near unity fill factor. This means there are fewer spins and a smaller diamond to illuminate, resulting in lower optical power requirements. This particular model assumes that diamond length is held constant while diamond cross section is variable. The effective optical polarization rate is also variable, which relates to the intensity of laser used and thus power.</p>
</section>
<section id="power-optimized-over-diamond-parameters-with-current-resonator">
<h4>Power Optimized over Diamond Parameters with Current Resonator<a class="headerlink" href="#power-optimized-over-diamond-parameters-with-current-resonator" title="Link to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rho_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">Vdlist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">50</span><span class="p">)</span> <span class="o">*</span> <span class="mf">3e-3</span><span class="o">*</span><span class="mf">3e-3</span><span class="o">*</span><span class="mf">0.9e-3</span>
<span class="n">P_per_NV</span> <span class="o">=</span> <span class="mi">8</span><span class="o">/</span><span class="p">(</span><span class="mf">3e-3</span><span class="o">*</span><span class="mf">3e-3</span><span class="o">*</span><span class="mf">0.9e-3</span><span class="o">*</span><span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="mf">3.51</span> <span class="o">/</span> <span class="mf">12.01</span> <span class="o">*</span> <span class="mf">6.022e23</span><span class="p">))</span>
<span class="n">Q</span> <span class="o">=</span> <span class="mf">2.2e4</span>
<span class="n">V</span> <span class="o">=</span> <span class="mf">1.7</span> <span class="o">/</span> <span class="p">(</span><span class="mi">100</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span>
<span class="n">omega</span> <span class="o">=</span> <span class="mf">2.87e9</span>
<span class="n">I</span><span class="o">=</span><span class="mi">18800</span>
<span class="n">gammao</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="mi">270</span><span class="o">+</span><span class="mf">0.38</span><span class="o">*</span><span class="n">I</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">90</span><span class="o">+</span><span class="mf">0.58</span><span class="o">*</span><span class="n">I</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">270</span><span class="o">+</span><span class="mf">1.08</span><span class="o">*</span><span class="n">I</span><span class="p">)</span>
<span class="n">PowerList</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">70</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">51</span><span class="p">)</span>
<span class="n">vot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="n">PowerList</span> <span class="o">/</span> <span class="mi">10</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1e-3</span> <span class="o">*</span> <span class="mi">50</span><span class="p">)</span>
<span class="n">mu0</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="mf">1e-7</span>   
<span class="n">energy</span> <span class="o">=</span> <span class="mf">6.626e-34</span> <span class="o">*</span> <span class="n">omega</span>   <span class="c1">#h*omega</span>
<span class="n">gs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">energy</span> <span class="o">*</span> <span class="p">(</span><span class="mf">28e9</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">mu0</span> <span class="o">/</span> <span class="mi">3</span> <span class="o">/</span> <span class="n">V</span><span class="p">)</span>   <span class="c1">#single coupling strength</span>
<span class="n">kc0</span> <span class="o">=</span> <span class="mf">130e3</span>   <span class="c1"># cavity linewidth</span>
<span class="n">kc1</span> <span class="o">=</span> <span class="mf">130e3</span>   <span class="c1"># cavity loop coupling</span>
<span class="n">kc</span> <span class="o">=</span> <span class="n">kc0</span> <span class="o">+</span> <span class="n">kc1</span>   <span class="c1"># cavity loss</span>

<span class="n">strings</span><span class="o">=</span> <span class="p">[</span><span class="s1">'50'</span><span class="p">,</span><span class="s1">'100'</span><span class="p">,</span><span class="s1">'500'</span><span class="p">]</span>
<span class="n">max_sens_values</span> <span class="o">=</span> <span class="p">[</span><span class="mf">50e-15</span><span class="p">,</span><span class="mf">100e-15</span><span class="p">,</span> <span class="mf">500e-15</span><span class="p">]</span>
<span class="n">p50</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">rho_list</span><span class="p">))</span>
<span class="n">p100</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">rho_list</span><span class="p">))</span>
<span class="n">p500</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">rho_list</span><span class="p">))</span>
<span class="n">powers</span> <span class="o">=</span> <span class="p">{</span><span class="s1">'50'</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">rho_list</span><span class="p">)),</span> <span class="s1">'100'</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">rho_list</span><span class="p">)),</span><span class="s1">'500'</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">rho_list</span><span class="p">)),}</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
    <span class="n">max_sens</span><span class="o">=</span><span class="n">max_sens_values</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">string</span> <span class="o">=</span> <span class="n">strings</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">rho_list</span><span class="p">)):</span>
        <span class="n">rho</span><span class="o">=</span><span class="n">rho_list</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
        <span class="n">powers_j</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Vdlist</span><span class="p">)):</span>
            <span class="n">Vd</span><span class="o">=</span><span class="n">Vdlist</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="n">rhomax</span> <span class="o">=</span> <span class="mf">0.1231</span> <span class="o">*</span> <span class="mi">4</span> <span class="o">*</span> <span class="mf">1e-6</span> <span class="o">/</span> <span class="n">Vd</span>
            <span class="k">if</span> <span class="n">rho</span><span class="o">&gt;</span><span class="n">rhomax</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">sensi</span> <span class="o">=</span> <span class="n">compute_sens</span><span class="p">(</span><span class="n">rho</span><span class="p">,</span> <span class="n">gammao</span><span class="p">,</span> <span class="n">V</span><span class="p">,</span> <span class="n">Q</span><span class="p">,</span> <span class="n">PowerList</span><span class="p">,</span> <span class="n">vot</span><span class="p">,</span> <span class="n">energy</span><span class="p">,</span> <span class="n">gs</span><span class="p">,</span> <span class="n">kc</span><span class="p">,</span> <span class="n">kc1</span><span class="p">,</span> <span class="n">Vd</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">sensi</span> <span class="o">&lt;</span> <span class="n">max_sens</span><span class="p">:</span>
                <span class="n">power</span> <span class="o">=</span> <span class="n">P_per_NV</span> <span class="o">*</span> <span class="n">Vd</span> <span class="o">*</span> <span class="p">(</span><span class="n">rho</span> <span class="o">*</span> <span class="mf">3.51</span> <span class="o">/</span> <span class="mf">12.01</span> <span class="o">*</span> <span class="mf">6.022e23</span><span class="p">)</span> 
                <span class="n">powers_j</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">power</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">powers_j</span><span class="p">:</span>
            <span class="n">powers</span><span class="p">[</span><span class="n">string</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">powers</span><span class="p">[</span><span class="n">string</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">powers_j</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">scipy.interpolate</span> <span class="kn">import</span> <span class="n">UnivariateSpline</span>

<span class="c1"># Assuming rho_list is already defined</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

<span class="c1"># Function to filter non-zero values</span>
<span class="k">def</span> <span class="nf">filter_non_zero</span><span class="p">(</span><span class="n">rho_list</span><span class="p">,</span> <span class="n">power_values</span><span class="p">):</span>
    <span class="n">filtered_rho</span> <span class="o">=</span> <span class="p">[</span><span class="n">rho</span> <span class="k">for</span> <span class="n">rho</span><span class="p">,</span> <span class="n">power</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">rho_list</span><span class="p">,</span> <span class="n">power_values</span><span class="p">)</span> <span class="k">if</span> <span class="n">power</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>
    <span class="n">filtered_power</span> <span class="o">=</span> <span class="p">[</span><span class="n">power</span> <span class="k">for</span> <span class="n">power</span> <span class="ow">in</span> <span class="n">power_values</span> <span class="k">if</span> <span class="n">power</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">filtered_rho</span><span class="p">,</span> <span class="n">filtered_power</span>

<span class="c1"># Plot each of the power arrays with non-zero values and smooth curves</span>
<span class="k">for</span> <span class="n">string</span><span class="p">,</span> <span class="n">color</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">([</span><span class="s1">'50'</span><span class="p">,</span> <span class="s1">'100'</span><span class="p">,</span> <span class="s1">'500'</span><span class="p">],</span> <span class="p">[</span><span class="s1">'blue'</span><span class="p">,</span> <span class="s1">'green'</span><span class="p">,</span> <span class="s1">'red'</span><span class="p">]):</span>
    <span class="n">filtered_rho</span><span class="p">,</span> <span class="n">filtered_power</span> <span class="o">=</span> <span class="n">filter_non_zero</span><span class="p">(</span><span class="n">rho_list</span><span class="p">,</span> <span class="n">powers</span><span class="p">[</span><span class="n">string</span><span class="p">])</span>
    
    <span class="c1"># Fit a smoother curve using UnivariateSpline with a higher smoothing factor</span>
    <span class="n">spline</span> <span class="o">=</span> <span class="n">UnivariateSpline</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">filtered_rho</span><span class="p">),</span> <span class="n">filtered_power</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>  <span class="c1"># Increased s for smoother curve</span>
    <span class="n">smooth_rho</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">filtered_rho</span><span class="p">)),</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">filtered_rho</span><span class="p">)),</span> <span class="mi">500</span><span class="p">)</span>
    <span class="n">smooth_power</span> <span class="o">=</span> <span class="n">spline</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">smooth_rho</span><span class="p">))</span>
    
    <span class="c1"># Plot the smooth curve with increased line weight</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">smooth_rho</span><span class="p">,</span> <span class="n">smooth_power</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">'</span><span class="si">{</span><span class="n">string</span><span class="si">}</span><span class="s1"> fT'</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">2.5</span><span class="p">)</span>  <span class="c1"># Increased linewidth</span>

<span class="c1"># Set axes to log scale</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xscale</span><span class="p">(</span><span class="s1">'log'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yscale</span><span class="p">(</span><span class="s1">'log'</span><span class="p">)</span>

<span class="c1"># Add labels and legend with increased font size</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">'$\rho$(ppm)'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">'Power (W)'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">'Power vs NV Density for Different Sensitivity Values'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>

<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">'both'</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">'major'</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>  <span class="c1"># Major tick labels</span>

<span class="c1"># Configure grid to show only at major ticks</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s2">"major"</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">"--"</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>

<span class="c1"># Display the plot</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/61a9a748a4206aa19221b82905ac96dbe082717db3df7575a62f31ec2f71433c.png" src="_images/61a9a748a4206aa19221b82905ac96dbe082717db3df7575a62f31ec2f71433c.png"/>
</div>
</div>
</section>
<section id="power-optimized-over-cavity-design-and-diamond-parameters">
<h4>Power Optimized over Cavity Design and Diamond Parameters<a class="headerlink" href="#power-optimized-over-cavity-design-and-diamond-parameters" title="Link to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="c1"># Define the quality factors and cavity mode volumes</span>
<span class="n">Qlist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>   <span class="c1"># Quality factor ranging from 1e3 to 1e6</span>
<span class="n">omega</span> <span class="o">=</span> <span class="mf">2.87e9</span>                   <span class="c1"># Angular frequency in rad/s</span>
<span class="n">Vd_ref</span> <span class="o">=</span> <span class="mf">3e-3</span> <span class="o">*</span> <span class="mf">3e-3</span> <span class="o">*</span> <span class="mf">0.9e-3</span>   <span class="c1"># Reference diamond volume in m^3</span>
<span class="n">Vlist</span> <span class="o">=</span> <span class="n">Vd_ref</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="o">-</span><span class="mi">6</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>   <span class="c1"># Cavity mode volume ranging from Vd_ref*1e-6 to Vd_ref*1e4</span>

<span class="c1"># Physical constants</span>
<span class="n">mu0</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="mf">1e-7</span>   
<span class="n">energy</span> <span class="o">=</span> <span class="mf">6.626e-34</span> <span class="o">*</span> <span class="n">omega</span>   <span class="c1"># h*omega</span>

<span class="c1"># other parameters</span>
<span class="n">PowerList</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">70</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">51</span><span class="p">)</span>
<span class="n">vot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="n">PowerList</span> <span class="o">/</span> <span class="mi">10</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1e-3</span> <span class="o">*</span> <span class="mi">50</span><span class="p">)</span>
<span class="n">kc0</span> <span class="o">=</span> <span class="mf">130e3</span>   <span class="c1"># Cavity linewidth in Hz</span>
<span class="n">kc1</span> <span class="o">=</span> <span class="mf">130e3</span>   <span class="c1"># Cavity loop coupling in Hz</span>
<span class="n">kc</span> <span class="o">=</span> <span class="n">kc0</span> <span class="o">+</span> <span class="n">kc1</span> <span class="c1"># Total cavity loss in Hz</span>
<span class="n">L</span><span class="o">=</span><span class="mf">0.9e-3</span>

<span class="c1"># Initialize dictionaries to store minimum powers and associated parameters</span>
<span class="n">strings</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'50'</span><span class="p">,</span> <span class="s1">'100'</span><span class="p">]</span>
<span class="n">max_sens_values</span> <span class="o">=</span> <span class="p">[</span><span class="mf">50e-15</span><span class="p">,</span> <span class="mf">100e-15</span><span class="p">]</span>
<span class="n">powers</span> <span class="o">=</span> <span class="p">{</span><span class="s1">'50'</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Qlist</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">),</span> <span class="s1">'100'</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Qlist</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)}</span>
<span class="n">params_powers</span> <span class="o">=</span> <span class="p">{</span><span class="s1">'50'</span><span class="p">:</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">Qlist</span><span class="p">),</span> <span class="s1">'100'</span><span class="p">:</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">Qlist</span><span class="p">)}</span>
<span class="n">V_powers</span> <span class="o">=</span> <span class="p">{</span><span class="s1">'50'</span><span class="p">:</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">Qlist</span><span class="p">),</span> <span class="s1">'100'</span><span class="p">:</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">Qlist</span><span class="p">)}</span>  <span class="c1"># To store mode volumes</span>

<span class="c1"># Loop over each sensitivity level</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">):</span>
    <span class="n">max_sens</span> <span class="o">=</span> <span class="n">max_sens_values</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">string</span> <span class="o">=</span> <span class="n">strings</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

    <span class="c1"># Loop over each quality factor</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Qlist</span><span class="p">)):</span>
        <span class="n">Q</span> <span class="o">=</span> <span class="n">Qlist</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
        <span class="n">powers_j</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">params_j</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">V_j</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="c1"># Loop over each cavity mode volume</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Vlist</span><span class="p">)):</span>
            <span class="n">V</span> <span class="o">=</span> <span class="n">Vlist</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
            <span class="n">power</span><span class="p">,</span> <span class="n">params</span> <span class="o">=</span> <span class="n">minimize_power_single</span><span class="p">(</span><span class="n">max_sens</span><span class="p">,</span> <span class="n">omega</span><span class="p">,</span> <span class="n">V</span><span class="p">,</span> <span class="n">Q</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">L</span><span class="o">=</span><span class="n">L</span><span class="p">)</span>
            
            <span class="c1"># Check if the computed power is finite</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">power</span><span class="p">):</span>
                <span class="n">powers_j</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">power</span><span class="p">)</span>
                <span class="n">params_j</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
                <span class="n">V_j</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">V</span><span class="p">)</span>
        
        <span class="c1"># Determine the minimum power and store it along with associated params</span>
        <span class="k">if</span> <span class="n">powers_j</span><span class="p">:</span>
            <span class="n">min_power</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">powers_j</span><span class="p">)</span>
            <span class="n">min_index</span> <span class="o">=</span> <span class="n">powers_j</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">min_power</span><span class="p">)</span>
            <span class="n">powers</span><span class="p">[</span><span class="n">string</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">min_power</span>
            <span class="n">params_powers</span><span class="p">[</span><span class="n">string</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">params_j</span><span class="p">[</span><span class="n">min_index</span><span class="p">]</span>
            <span class="n">V_powers</span><span class="p">[</span><span class="n">string</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">V_j</span><span class="p">[</span><span class="n">min_index</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># If no finite power was found, keep the default value (np.inf) and params as None</span>
            <span class="n">powers</span><span class="p">[</span><span class="n">string</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
            <span class="n">params_powers</span><span class="p">[</span><span class="n">string</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">V_powers</span><span class="p">[</span><span class="n">string</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

<span class="c1"># Optional: Convert np.inf to 0 for powers where no finite power was found</span>
<span class="k">for</span> <span class="n">string</span> <span class="ow">in</span> <span class="n">strings</span><span class="p">:</span>
    <span class="n">powers</span><span class="p">[</span><span class="n">string</span><span class="p">][</span><span class="n">powers</span><span class="p">[</span><span class="n">string</span><span class="p">]</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">display</span><span class="p">,</span> <span class="n">Latex</span>

<span class="c1"># Desired Q value</span>
<span class="n">target_Q</span> <span class="o">=</span> <span class="mi">7650</span>

<span class="c1"># Function to find the index of the closest Q value</span>
<span class="k">def</span> <span class="nf">find_closest_Q</span><span class="p">(</span><span class="n">Qlist</span><span class="p">,</span> <span class="n">target</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">Qlist</span> <span class="o">-</span> <span class="n">target</span><span class="p">))</span>

<span class="c1"># Find the index of Q closest to 7650</span>
<span class="n">closest_index</span> <span class="o">=</span> <span class="n">find_closest_Q</span><span class="p">(</span><span class="n">Qlist</span><span class="p">,</span> <span class="n">target_Q</span><span class="p">)</span>
<span class="n">closest_Q</span> <span class="o">=</span> <span class="n">Qlist</span><span class="p">[</span><span class="n">closest_index</span><span class="p">]</span>

<span class="c1"># Iterate over each sensitivity to retrieve and display the information</span>
<span class="n">string</span> <span class="o">=</span> <span class="s1">'100'</span>
<span class="n">power</span> <span class="o">=</span> <span class="n">powers</span><span class="p">[</span><span class="n">string</span><span class="p">][</span><span class="n">closest_index</span><span class="p">]</span>
<span class="n">params</span> <span class="o">=</span> <span class="n">params_powers</span><span class="p">[</span><span class="n">string</span><span class="p">][</span><span class="n">closest_index</span><span class="p">]</span>
<span class="n">V</span> <span class="o">=</span> <span class="n">V_powers</span><span class="p">[</span><span class="n">string</span><span class="p">][</span><span class="n">closest_index</span><span class="p">]</span>

<span class="c1"># Check if a valid power and params were found</span>
<span class="k">if</span> <span class="n">power</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">params</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">gammao</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">w</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> 
    <span class="n">rho</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">Vd</span> <span class="o">=</span> <span class="n">w</span> <span class="o">*</span> <span class="n">w</span> <span class="o">*</span> <span class="n">L</span>

    <span class="c1"># Prepare LaTeX-formatted display</span>
    <span class="n">display</span><span class="p">(</span><span class="n">Latex</span><span class="p">(</span><span class="sa">f</span><span class="s2">"The following parameters are roughly optimal for a target Q of </span><span class="si">{</span><span class="n">target_Q</span><span class="si">}</span><span class="s2">"</span><span class="p">))</span>
    <span class="n">display</span><span class="p">(</span><span class="n">Latex</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Sensitivity: </span><span class="si">{</span><span class="n">string</span><span class="si">}</span><span class="s2"> $fT/\sqrt(Hz)$ "</span><span class="p">))</span>
    <span class="n">display</span><span class="p">(</span><span class="n">Latex</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Mode Volume (V): </span><span class="si">{</span><span class="n">V</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2"> m$^3$ "</span><span class="p">))</span>
    <span class="n">display</span><span class="p">(</span><span class="n">Latex</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Diamond Volume (Vd): </span><span class="si">{</span><span class="n">Vd</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2"> m$^3$"</span><span class="p">))</span>
    <span class="n">display</span><span class="p">(</span><span class="n">Latex</span><span class="p">(</span><span class="sa">f</span><span class="s2">"NV Density: </span><span class="si">{</span><span class="n">rho</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2"> ppm "</span><span class="p">))</span>
    <span class="n">display</span><span class="p">(</span><span class="n">Latex</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Minimum Power: </span><span class="si">{</span><span class="n">power</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">1e3</span><span class="si">:</span><span class="s2">.0f</span><span class="si">}</span><span class="s2"> mW"</span><span class="p">))</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">display</span><span class="p">(</span><span class="n">Latex</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">"Sensitivity </span><span class="si">{</span><span class="n">string</span><span class="si">}</span><span class="s2"> fT $</span><span class="se">\n</span><span class="s2">ewline$"</span>
        <span class="sa">f</span><span class="s2">"No valid power and parameters found for Q = </span><span class="si">{</span><span class="n">closest_Q</span><span class="si">:</span><span class="s2">.0f</span><span class="si">}</span><span class="s2">."</span>
    <span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_latex math notranslate nohighlight">
\[The following parameters are roughly optimal for a target Q of 7650\]</div>
<div class="output text_latex math notranslate nohighlight">
\[Sensitivity: 100 $fT/\sqrt(Hz)$\]</div>
<div class="output text_latex math notranslate nohighlight">
\[Mode Volume (V): 2.89e-08 m$^3$\]</div>
<div class="output text_latex math notranslate nohighlight">
\[Diamond Volume (Vd): 2.89e-08 m$^3$\]</div>
<div class="output text_latex math notranslate nohighlight">
\[NV Density: 0.057 ppm\]</div>
<div class="output text_latex math notranslate nohighlight">
\[Minimum Power: 509 mW\]</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">scipy.interpolate</span> <span class="kn">import</span> <span class="n">UnivariateSpline</span>

<span class="c1"># Assuming Qlist and other variables are already defined</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

<span class="c1"># Function to filter non-zero values</span>
<span class="k">def</span> <span class="nf">filter_non_zero</span><span class="p">(</span><span class="n">Qlist</span><span class="p">,</span> <span class="n">power_values</span><span class="p">):</span>
    <span class="n">filtered_Q</span> <span class="o">=</span> <span class="p">[</span><span class="n">Q</span> <span class="k">for</span> <span class="n">Q</span><span class="p">,</span> <span class="n">power</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">Qlist</span><span class="p">,</span> <span class="n">power_values</span><span class="p">)</span> <span class="k">if</span> <span class="n">power</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>
    <span class="n">filtered_power</span> <span class="o">=</span> <span class="p">[</span><span class="n">power</span> <span class="k">for</span> <span class="n">power</span> <span class="ow">in</span> <span class="n">power_values</span> <span class="k">if</span> <span class="n">power</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">filtered_Q</span><span class="p">,</span> <span class="n">filtered_power</span>

<span class="c1"># Plot only the power arrays for 50 fT and 100 fT</span>
<span class="k">for</span> <span class="n">string</span><span class="p">,</span> <span class="n">color</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">([</span><span class="s1">'50'</span><span class="p">,</span> <span class="s1">'100'</span><span class="p">],</span> <span class="p">[</span><span class="s1">'blue'</span><span class="p">,</span> <span class="s1">'green'</span><span class="p">]):</span>
    <span class="n">filtered_Q</span><span class="p">,</span> <span class="n">filtered_power</span> <span class="o">=</span> <span class="n">filter_non_zero</span><span class="p">(</span><span class="n">Qlist</span><span class="p">,</span> <span class="n">powers</span><span class="p">[</span><span class="n">string</span><span class="p">])</span>
    
    <span class="c1"># Plot the original data</span>
<span class="c1">#     plt.scatter(filtered_Q, filtered_power, label=f'{string} fT (Original)', color=color, alpha=0.5)</span>
    <span class="k">if</span> <span class="n">color</span> <span class="o">==</span><span class="s1">'blue'</span><span class="p">:</span>
        <span class="n">smooth_f</span> <span class="o">=</span> <span class="mi">10</span> 
    <span class="k">else</span><span class="p">:</span>
        <span class="n">smooth_f</span> <span class="o">=</span> <span class="mi">1</span>
    
    <span class="c1"># Fit a smoother curve using UnivariateSpline</span>
    <span class="n">spline</span> <span class="o">=</span> <span class="n">UnivariateSpline</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">filtered_Q</span><span class="p">),</span> <span class="n">filtered_power</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="n">smooth_f</span><span class="p">)</span>
    <span class="n">smooth_Q</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">filtered_Q</span><span class="p">)),</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">filtered_Q</span><span class="p">)),</span> <span class="mi">500</span><span class="p">)</span>
    <span class="n">smooth_power</span> <span class="o">=</span> <span class="n">spline</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">smooth_Q</span><span class="p">))</span>
    
    <span class="c1"># Plot the smooth curve with increased line weight</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">smooth_Q</span><span class="p">,</span> <span class="n">smooth_power</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">'</span><span class="si">{</span><span class="n">string</span><span class="si">}</span><span class="s1"> fT'</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">2.5</span><span class="p">)</span>

<span class="c1"># Set axes to log scale</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xscale</span><span class="p">(</span><span class="s1">'log'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yscale</span><span class="p">(</span><span class="s1">'log'</span><span class="p">)</span>

<span class="c1"># Add labels and legend with increased font size</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">'Quality Factor (Q)'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">'Min Power'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">'Min Power vs Q for Different Sensitivity Values'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>

<span class="c1"># Configure grid to show only at major ticks</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s2">"major"</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">"--"</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>

<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">'both'</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">'major'</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>  <span class="c1"># Major tick labels</span>

<span class="c1"># Display the plot</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/e8d2968c82f0052cd4578d97542359a773389cc8931f3d592e07ac1e5bdf785c.png" src="_images/e8d2968c82f0052cd4578d97542359a773389cc8931f3d592e07ac1e5bdf785c.png"/>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="c1"># Define constants and parameters</span>
<span class="n">Q</span> <span class="o">=</span> <span class="mi">7650</span>  <span class="c1"># Fixed Quality factor</span>
<span class="n">omega</span> <span class="o">=</span> <span class="mf">2.87e9</span>
<span class="n">Vd_ref</span> <span class="o">=</span> <span class="mf">3e-3</span> <span class="o">*</span> <span class="mf">3e-3</span> <span class="o">*</span> <span class="mf">0.9e-3</span>   <span class="c1"># Reference diamond volume in m^3</span>
<span class="n">Vlist</span> <span class="o">=</span> <span class="n">Vd_ref</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="o">-</span><span class="mi">6</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>   <span class="c1"># Cavity mode volume ranging from Vd_ref*1e-6 to Vd_ref*1e4</span>
<span class="n">mu0</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="mf">1e-7</span>   
<span class="n">energy</span> <span class="o">=</span> <span class="mf">6.626e-34</span> <span class="o">*</span> <span class="n">omega</span>   <span class="c1"># h*omega</span>
<span class="n">I</span> <span class="o">=</span> <span class="mi">18800</span>
<span class="n">gammao</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="mi">270</span> <span class="o">+</span> <span class="mf">0.38</span><span class="o">*</span><span class="n">I</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">90</span> <span class="o">+</span> <span class="mf">0.58</span><span class="o">*</span><span class="n">I</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">270</span> <span class="o">+</span> <span class="mf">1.08</span><span class="o">*</span><span class="n">I</span><span class="p">)</span>
<span class="n">PowerList</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">70</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">51</span><span class="p">)</span>
<span class="n">vot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="n">PowerList</span> <span class="o">/</span> <span class="mi">10</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1e-3</span> <span class="o">*</span> <span class="mi">50</span><span class="p">)</span>
<span class="n">kc0</span> <span class="o">=</span> <span class="mf">130e3</span>   <span class="c1"># Cavity linewidth in Hz</span>
<span class="n">kc1</span> <span class="o">=</span> <span class="mf">130e3</span>   <span class="c1"># Cavity loop coupling in Hz</span>
<span class="n">kc</span> <span class="o">=</span> <span class="n">kc0</span> <span class="o">+</span> <span class="n">kc1</span>   <span class="c1"># Total cavity loss in Hz</span>

<span class="c1"># Define sensitivities and corresponding string labels</span>
<span class="n">strings</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'50'</span><span class="p">,</span> <span class="s1">'100'</span><span class="p">,</span> <span class="s1">'500'</span><span class="p">]</span>
<span class="n">max_sens_values</span> <span class="o">=</span> <span class="p">[</span><span class="mf">50e-15</span><span class="p">,</span> <span class="mf">100e-15</span><span class="p">,</span> <span class="mf">500e-15</span><span class="p">]</span>

<span class="c1"># Initialize dictionaries to store minimum powers and associated parameters</span>
<span class="n">powers</span> <span class="o">=</span> <span class="p">{</span><span class="s1">'50'</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Vlist</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">),</span><span class="s1">'100'</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Vlist</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">),</span><span class="s1">'500'</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Vlist</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)}</span>
<span class="n">Vd_powers</span> <span class="o">=</span> <span class="p">{</span><span class="s1">'50'</span><span class="p">:</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">Vlist</span><span class="p">),</span><span class="s1">'100'</span><span class="p">:</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">Vlist</span><span class="p">),</span><span class="s1">'500'</span><span class="p">:</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">Vlist</span><span class="p">)}</span>
<span class="n">rho_powers</span> <span class="o">=</span> <span class="p">{</span><span class="s1">'50'</span><span class="p">:</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">Vlist</span><span class="p">),</span><span class="s1">'100'</span><span class="p">:</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">Vlist</span><span class="p">),</span><span class="s1">'500'</span><span class="p">:</span> <span class="p">[</span><span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">Vlist</span><span class="p">)}</span>

<span class="c1"># Loop over each sensitivity level</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">strings</span><span class="p">)):</span>
    <span class="n">max_sens</span> <span class="o">=</span> <span class="n">max_sens_values</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">string</span> <span class="o">=</span> <span class="n">strings</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    
    <span class="c1"># Loop over each cavity mode volume</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Vlist</span><span class="p">)):</span>
        <span class="n">V</span> <span class="o">=</span> <span class="n">Vlist</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
        <span class="n">gs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">energy</span> <span class="o">*</span> <span class="p">(</span><span class="mf">28e9</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">mu0</span> <span class="o">/</span> <span class="mi">3</span> <span class="o">/</span> <span class="n">V</span><span class="p">)</span>   <span class="c1"># Single coupling strength</span>
        
        <span class="c1"># Call the power minimization function</span>
        <span class="n">p_opt</span><span class="p">,</span> <span class="n">Vd_opt</span><span class="p">,</span> <span class="n">rho_opt</span> <span class="o">=</span> <span class="n">min_power_linear</span><span class="p">(</span>
            <span class="n">max_sens</span><span class="p">,</span> <span class="n">V</span><span class="p">,</span> <span class="n">Q</span><span class="p">,</span> <span class="n">gammao</span><span class="p">,</span> <span class="n">PowerList</span><span class="p">,</span> <span class="n">vot</span><span class="p">,</span> <span class="n">energy</span><span class="p">,</span> <span class="n">gs</span><span class="p">,</span> <span class="n">kc</span><span class="p">,</span> <span class="n">kc1</span>
        <span class="p">)</span>
        
        <span class="c1"># Check if a valid power was returned</span>
        <span class="k">if</span> <span class="n">p_opt</span><span class="p">:</span>
            <span class="n">powers</span><span class="p">[</span><span class="n">string</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">p_opt</span>
            <span class="n">Vd_powers</span><span class="p">[</span><span class="n">string</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">Vd_opt</span>
            <span class="n">rho_powers</span><span class="p">[</span><span class="n">string</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">rho_opt</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># If no valid power was found, set power to 0 and params to None</span>
            <span class="n">powers</span><span class="p">[</span><span class="n">string</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">Vd_powers</span><span class="p">[</span><span class="n">string</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">rho_powers</span><span class="p">[</span><span class="n">string</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">display</span><span class="p">,</span> <span class="n">Latex</span>

<span class="c1"># Fixed Quality factor</span>
<span class="n">target_Q</span> <span class="o">=</span> <span class="mi">7650</span>
<span class="n">string</span> <span class="o">=</span> <span class="s1">'100'</span>

<span class="c1"># Retrieve the array </span>
<span class="n">power_array</span> <span class="o">=</span> <span class="n">powers</span><span class="p">[</span><span class="n">string</span><span class="p">]</span>
<span class="n">Vd_array</span> <span class="o">=</span> <span class="n">Vd_powers</span><span class="p">[</span><span class="n">string</span><span class="p">]</span>
<span class="n">rho_array</span> <span class="o">=</span> <span class="n">rho_powers</span><span class="p">[</span><span class="n">string</span><span class="p">]</span>

<span class="c1"># Function to find the index of the minimum power (excluding zeros)</span>
<span class="k">def</span> <span class="nf">find_min_power_index</span><span class="p">(</span><span class="n">powers_array</span><span class="p">):</span>
    <span class="c1"># Consider only powers greater than 0 to exclude invalid entries</span>
    <span class="n">valid_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">powers_array</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">valid_indices</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>  <span class="c1"># No valid power found</span>
    <span class="n">min_power_idx</span> <span class="o">=</span> <span class="n">valid_indices</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">powers_array</span><span class="p">[</span><span class="n">valid_indices</span><span class="p">])]</span>
    <span class="k">return</span> <span class="n">min_power_idx</span>

<span class="c1"># Find the index of the minimum power for sensitivity '100'</span>
<span class="n">min_idx</span> <span class="o">=</span> <span class="n">find_min_power_index</span><span class="p">(</span><span class="n">power_array</span><span class="p">)</span>

<span class="k">if</span> <span class="n">min_idx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">min_power</span> <span class="o">=</span> <span class="n">power_array</span><span class="p">[</span><span class="n">min_idx</span><span class="p">]</span>
    <span class="n">Vd_opt</span> <span class="o">=</span> <span class="n">Vd_array</span><span class="p">[</span><span class="n">min_idx</span><span class="p">]</span>
    <span class="n">rho_opt</span> <span class="o">=</span> <span class="n">rho_array</span><span class="p">[</span><span class="n">min_idx</span><span class="p">]</span>
    <span class="n">V_opt</span> <span class="o">=</span> <span class="n">Vlist</span><span class="p">[</span><span class="n">min_idx</span><span class="p">]</span>
    
    <span class="c1"># Prepare LaTeX-formatted display</span>
    <span class="n">display</span><span class="p">(</span><span class="n">Latex</span><span class="p">(</span><span class="sa">f</span><span class="s2">"The following parameters are roughly optimal for a target Q of </span><span class="si">{</span><span class="n">target_Q</span><span class="si">}</span><span class="s2">:"</span><span class="p">))</span>
    <span class="n">display</span><span class="p">(</span><span class="n">Latex</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Sensitivity: </span><span class="si">{</span><span class="n">string</span><span class="si">}</span><span class="s2"> $fT/</span><span class="se">\\</span><span class="s2">sqrt</span><span class="se">{{</span><span class="s2">Hz</span><span class="se">}}</span><span class="s2">$"</span><span class="p">))</span>
    <span class="n">display</span><span class="p">(</span><span class="n">Latex</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Mode Volume (V): </span><span class="si">{</span><span class="n">V_opt</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2"> m$^3$"</span><span class="p">))</span>
    <span class="n">display</span><span class="p">(</span><span class="n">Latex</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Diamond Volume (Vd): </span><span class="si">{</span><span class="n">Vd_opt</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2"> m$^3$"</span><span class="p">))</span>
    <span class="n">display</span><span class="p">(</span><span class="n">Latex</span><span class="p">(</span><span class="sa">f</span><span class="s2">"NV Density: </span><span class="si">{</span><span class="n">rho_opt</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2"> ppm"</span><span class="p">))</span>
    <span class="n">display</span><span class="p">(</span><span class="n">Latex</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Minimum Power: </span><span class="si">{</span><span class="n">min_power</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">1e3</span><span class="si">:</span><span class="s2">.0f</span><span class="si">}</span><span class="s2"> mW"</span><span class="p">))</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">display</span><span class="p">(</span><span class="n">Latex</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">"Sensitivity </span><span class="si">{</span><span class="n">string</span><span class="si">}</span><span class="s2"> fT </span><span class="se">\\</span><span class="s2">newline "</span>
        <span class="sa">f</span><span class="s2">"No valid power and parameters found for Q = </span><span class="si">{</span><span class="n">Q</span><span class="si">}</span><span class="s2">."</span>
    <span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_latex math notranslate nohighlight">
\[The following parameters are roughly optimal for a target Q of 7650:\]</div>
<div class="output text_latex math notranslate nohighlight">
\[Sensitivity: 100 $fT/\sqrt{Hz}$\]</div>
<div class="output text_latex math notranslate nohighlight">
\[Mode Volume (V): 3.12e-07 m$^3$\]</div>
<div class="output text_latex math notranslate nohighlight">
\[Diamond Volume (Vd): 2.07e-07 m$^3$\]</div>
<div class="output text_latex math notranslate nohighlight">
\[NV Density: 0.012 ppm\]</div>
<div class="output text_latex math notranslate nohighlight">
\[Minimum Power: 618 mW\]</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="c1"># Assuming Vlist, powers, and other variables are already defined</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

<span class="c1"># Function to filter non-zero values</span>
<span class="k">def</span> <span class="nf">filter_non_zero</span><span class="p">(</span><span class="n">Vlist</span><span class="p">,</span> <span class="n">power_values</span><span class="p">):</span>
    <span class="n">filtered_V</span> <span class="o">=</span> <span class="p">[</span><span class="n">V</span> <span class="k">for</span> <span class="n">V</span><span class="p">,</span> <span class="n">power</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">Vlist</span><span class="p">,</span> <span class="n">power_values</span><span class="p">)</span> <span class="k">if</span> <span class="n">power</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>
<span class="c1">#     print(filtered_V)</span>
    <span class="n">filtered_power</span> <span class="o">=</span> <span class="p">[</span><span class="n">power</span> <span class="k">for</span> <span class="n">power</span> <span class="ow">in</span> <span class="n">power_values</span> <span class="k">if</span> <span class="n">power</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">filtered_V</span><span class="p">,</span> <span class="n">filtered_power</span>

<span class="c1"># Define the colors for the three sensitivity values: 50 (blue), 100 (green), and 500 (red)</span>
<span class="n">colors</span> <span class="o">=</span> <span class="p">{</span><span class="s1">'50'</span><span class="p">:</span> <span class="s1">'blue'</span><span class="p">,</span> <span class="s1">'100'</span><span class="p">:</span> <span class="s1">'green'</span><span class="p">,</span> <span class="s1">'500'</span><span class="p">:</span> <span class="s1">'red'</span><span class="p">}</span>

<span class="c1"># Plot for all three sensitivity values without smoothing</span>
<span class="k">for</span> <span class="n">string</span><span class="p">,</span> <span class="n">color</span> <span class="ow">in</span> <span class="n">colors</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">filtered_V</span><span class="p">,</span> <span class="n">filtered_power</span> <span class="o">=</span> <span class="n">filter_non_zero</span><span class="p">(</span><span class="n">Vlist</span><span class="p">,</span> <span class="n">powers</span><span class="p">[</span><span class="n">string</span><span class="p">])</span>
    
    <span class="c1"># Plot the raw data points without smoothing</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">filtered_V</span><span class="p">,</span> <span class="n">filtered_power</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">'</span><span class="si">{</span><span class="n">string</span><span class="si">}</span><span class="s1"> fT'</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">2.5</span><span class="p">)</span>

<span class="c1"># Set axes to log scale</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xscale</span><span class="p">(</span><span class="s1">'log'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yscale</span><span class="p">(</span><span class="s1">'log'</span><span class="p">)</span>

<span class="c1"># Add labels and legend with increased font size</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">'V'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">'Power (W)'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">'Power vs Mode Volume V for Different Sensitivity Values'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>

<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">'both'</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">'major'</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>  <span class="c1"># Major tick labels</span>

<span class="c1"># Configure grid to show only at major ticks</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s2">"major"</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">"--"</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>

<span class="c1"># Display the plot</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/69137913d49806b83e345c09eeff7e26448186cea1b24dfa36ba1e96db4a0290.png" src="_images/69137913d49806b83e345c09eeff7e26448186cea1b24dfa36ba1e96db4a0290.png"/>
</div>
</div>
<section id="parameter-selection">
<h5>Parameter Selection<a class="headerlink" href="#parameter-selection" title="Link to this heading">#</a></h5>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">ipywidgets</span> <span class="k">as</span> <span class="nn">widgets</span>
<span class="kn">from</span> <span class="nn">ipywidgets</span> <span class="kn">import</span> <span class="n">HBox</span><span class="p">,</span> <span class="n">VBox</span>
<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">display</span><span class="p">,</span> <span class="n">Latex</span>
<span class="o">%</span><span class="k">matplotlib</span> inline
<span class="k">def</span> <span class="nf">max_L</span><span class="p">(</span><span class="n">gammao</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">absorp_cs</span><span class="p">,</span> <span class="n">I_min</span><span class="p">):</span>
    <span class="n">I_in</span> <span class="o">=</span> <span class="p">(</span><span class="mf">6.626e-34</span><span class="o">*</span><span class="p">(</span><span class="mf">3e8</span><span class="o">/</span><span class="mf">532e-9</span><span class="p">))</span><span class="o">*</span><span class="n">gammao</span><span class="o">/</span><span class="n">absorp_cs</span>
    <span class="k">return</span> <span class="o">-</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">alpha</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">I_min</span><span class="o">/</span><span class="n">I_in</span><span class="p">)</span>

<span class="n">cavity_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">'Dielectric'</span><span class="p">:</span> <span class="p">[</span><span class="mf">1.7</span> <span class="o">/</span> <span class="p">(</span><span class="mi">100</span><span class="o">**</span><span class="mi">3</span><span class="p">),</span> <span class="mf">2.2e4</span><span class="p">],</span>
              <span class="s1">'Double Reentrance'</span><span class="p">:</span> <span class="p">[</span><span class="mf">3.47e-7</span><span class="p">,</span> <span class="mf">2e4</span><span class="p">],</span>
              <span class="s1">'Tapered Double Reentrance'</span><span class="p">:</span> <span class="p">[</span><span class="mf">5.717e-8</span><span class="p">,</span> <span class="mi">7650</span><span class="p">]}</span>
<span class="n">style</span> <span class="o">=</span> <span class="p">{</span><span class="s1">'description_width'</span><span class="p">:</span> <span class="s1">'initial'</span><span class="p">}</span>
<span class="n">rho_slider</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">FloatLogSlider</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span><span class="n">base</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="mf">1e-2</span><span class="p">),</span> <span class="nb">max</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="mf">1e2</span><span class="p">),</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span><span class="n">description</span><span class="o">=</span><span class="sa">r</span><span class="s1">'NV density $\rho$ (ppm):'</span><span class="p">,</span> <span class="n">layout</span><span class="o">=</span><span class="n">widgets</span><span class="o">.</span><span class="n">Layout</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="s1">'500px'</span><span class="p">),</span><span class="n">style</span><span class="o">=</span><span class="n">style</span><span class="p">)</span>
<span class="n">w_slider</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">FloatLogSlider</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">base</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="mf">1e-2</span><span class="p">),</span> <span class="nb">max</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="mf">1e2</span><span class="p">),</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s1">'Diamond Cross Section Width (mm):'</span><span class="p">,</span> <span class="n">layout</span><span class="o">=</span><span class="n">widgets</span><span class="o">.</span><span class="n">Layout</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="s1">'500px'</span><span class="p">),</span> <span class="n">style</span><span class="o">=</span><span class="n">style</span><span class="p">)</span>
<span class="n">gammao_slider</span> <span class="o">=</span> <span class="n">widgets</span><span class="o">.</span><span class="n">FloatSlider</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="mf">7.9</span><span class="p">,</span><span class="nb">min</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span><span class="nb">max</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="n">step</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span><span class="n">description</span><span class="o">=</span><span class="sa">r</span><span class="s1">'Optical Polarization Rate $\gamma_</span><span class="si">{0}</span><span class="s1">$ (kHz):'</span><span class="p">,</span> <span class="n">layout</span><span class="o">=</span><span class="n">widgets</span><span class="o">.</span><span class="n">Layout</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="s1">'500px'</span><span class="p">),</span><span class="n">style</span><span class="o">=</span><span class="n">style</span><span class="p">)</span>

<span class="nd">@widgets</span><span class="o">.</span><span class="n">interact_manual</span><span class="p">(</span>
    <span class="n">cavity</span><span class="o">=</span><span class="p">[</span><span class="s1">'Dielectric'</span><span class="p">,</span> <span class="s1">'Double Reentrance'</span><span class="p">,</span> <span class="s1">'Tapered Double Reentrance'</span><span class="p">],</span>
    <span class="n">rho_slider</span><span class="o">=</span><span class="n">rho_slider</span><span class="p">,</span><span class="n">w_slider</span><span class="o">=</span><span class="n">w_slider</span><span class="p">,</span><span class="n">gammao_slider</span><span class="o">=</span><span class="n">gammao_slider</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">interactive</span><span class="p">(</span><span class="n">cavity</span><span class="o">=</span><span class="s1">'Dielectric'</span><span class="p">,</span> <span class="n">rho_slider</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">w_slider</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">gammao_slider</span> <span class="o">=</span> <span class="mf">7.924e3</span><span class="p">):</span>
    <span class="n">V</span><span class="p">,</span> <span class="n">Q</span> <span class="o">=</span> <span class="n">cavity_dict</span><span class="p">[</span><span class="n">cavity</span><span class="p">]</span>
    <span class="n">gammao</span> <span class="o">=</span> <span class="n">gammao_slider</span><span class="o">*</span><span class="mf">1e3</span>
    <span class="n">w</span> <span class="o">=</span> <span class="n">w_slider</span><span class="o">*</span><span class="mf">1e-3</span>
    <span class="n">L</span> <span class="o">=</span> <span class="mf">0.9e-3</span>
    <span class="n">PowerList</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">70</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">51</span><span class="p">)</span>
    <span class="n">vot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="n">PowerList</span> <span class="o">/</span> <span class="mi">10</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1e-3</span> <span class="o">*</span> <span class="mi">50</span><span class="p">)</span>
    <span class="n">Vd</span> <span class="o">=</span> <span class="n">w</span><span class="o">*</span><span class="n">w</span><span class="o">*</span><span class="n">L</span>
    <span class="n">rhomax</span> <span class="o">=</span> <span class="mf">0.1231</span> <span class="o">*</span> <span class="mi">4</span> <span class="o">*</span> <span class="mf">1e-6</span> <span class="o">/</span> <span class="n">Vd</span>
    <span class="k">if</span> <span class="n">rhomax</span><span class="o">&lt;</span><span class="n">rho_slider</span><span class="p">:</span>
        <span class="n">rho</span><span class="o">=</span><span class="n">rhomax</span>
        <span class="n">display</span><span class="p">(</span><span class="n">Latex</span><span class="p">(</span><span class="sa">f</span><span class="s1">'Due to the optical polarization constraint ($</span><span class="se">\\</span><span class="s1">rho_</span><span class="se">{{\\</span><span class="s1">text</span><span class="se">{{</span><span class="s1">max</span><span class="se">}}}}</span><span class="s1">V_d=0.49 </span><span class="se">\\</span><span class="s1">text</span><span class="se">{{</span><span class="s1"> cm</span><span class="se">}}</span><span class="s1">^3 </span><span class="se">\\</span><span class="s1">text</span><span class="se">{{</span><span class="s1"> ppm</span><span class="se">}}</span><span class="s1">$), $</span><span class="se">\\</span><span class="s1">rho$ has been reduced to $</span><span class="si">{</span><span class="n">rho</span><span class="si">:</span><span class="s1">.2e</span><span class="si">}</span><span class="s1">$ ppm'</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">rho</span><span class="o">=</span><span class="n">rho_slider</span>
    <span class="n">mu0</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="mf">1e-7</span> 
    <span class="n">omega</span> <span class="o">=</span> <span class="mf">2.87e9</span>
    <span class="n">energy</span> <span class="o">=</span> <span class="mf">6.626e-34</span> <span class="o">*</span> <span class="n">omega</span>   <span class="c1">#h*omega</span>
    <span class="n">gs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">6.626e-34</span> <span class="o">*</span> <span class="n">omega</span> <span class="o">*</span> <span class="p">(</span><span class="mf">28e9</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">mu0</span> <span class="o">/</span> <span class="mi">3</span> <span class="o">/</span> <span class="n">V</span><span class="p">)</span>   <span class="c1">#single coupling strength</span>
    <span class="n">kc0</span> <span class="o">=</span> <span class="n">omega</span> <span class="o">/</span> <span class="n">Q</span>   <span class="c1"># cavity linewidth</span>
    <span class="n">kc1</span> <span class="o">=</span> <span class="n">kc0</span>    <span class="c1"># cavity loop coupling</span>
    <span class="n">kc</span> <span class="o">=</span> <span class="n">kc0</span> <span class="o">+</span> <span class="n">kc1</span>   <span class="c1"># cavity loss</span>
    <span class="n">Gamma</span> <span class="o">=</span> <span class="mf">330e3</span> <span class="o">/</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">rho</span>
    <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.45</span> <span class="o">*</span> <span class="mi">100</span>  <span class="o">*</span><span class="n">rho</span><span class="o">/</span><span class="mf">0.1</span>
    
    <span class="n">sens_interact</span> <span class="o">=</span> <span class="n">compute_sens</span><span class="p">(</span><span class="n">rho</span><span class="p">,</span> <span class="n">gammao</span><span class="p">,</span> <span class="n">V</span><span class="p">,</span> <span class="n">Q</span><span class="p">,</span> <span class="n">PowerList</span><span class="p">,</span> <span class="n">vot</span><span class="p">,</span> <span class="n">energy</span><span class="p">,</span> <span class="n">gs</span><span class="p">,</span> <span class="n">kc</span><span class="p">,</span> <span class="n">kc1</span><span class="p">,</span> <span class="n">Vd</span><span class="p">)</span>

    <span class="n">absorp_cs</span> <span class="o">=</span> <span class="mf">8e-17</span> <span class="o">/</span> <span class="p">(</span><span class="mi">100</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">gamma_th</span> <span class="o">=</span> <span class="mi">90</span> <span class="c1"># thermal relxation rate</span>
    <span class="n">I</span> <span class="o">=</span> <span class="mf">1.225</span> <span class="o">*</span> <span class="n">gammao</span> <span class="o">-</span> <span class="mf">4.809</span> <span class="o">*</span> <span class="n">gamma_th</span> <span class="o">+</span> <span class="mf">3.085</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">0.1577</span> <span class="o">*</span> <span class="n">gammao</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="mf">0.5229</span> <span class="o">*</span> <span class="n">gammao</span> <span class="o">*</span> <span class="n">gamma_th</span> <span class="o">+</span> <span class="n">gamma_th</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">power</span> <span class="o">=</span> <span class="n">w</span> <span class="o">*</span> <span class="n">w</span> <span class="o">*</span> <span class="p">(</span><span class="mf">6.626e-34</span><span class="o">*</span><span class="p">(</span><span class="mf">3e8</span><span class="o">/</span><span class="mf">532e-9</span><span class="p">))</span><span class="o">*</span><span class="n">I</span><span class="o">/</span><span class="n">absorp_cs</span>

    <span class="n">display</span><span class="p">(</span><span class="n">Latex</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Cavity Mode Volume: </span><span class="si">{</span><span class="n">V</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2"> m$^3$, Diamond Volume: </span><span class="si">{</span><span class="n">Vd</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2"> m$^3$"</span><span class="p">))</span>
    <span class="n">display</span><span class="p">(</span><span class="n">Latex</span><span class="p">(</span><span class="sa">f</span><span class="s1">'$</span><span class="se">\\</span><span class="s1">textbf</span><span class="se">{{</span><span class="s1">Sensitivity</span><span class="se">}}</span><span class="s1">$: $</span><span class="si">{</span><span class="n">sens_interact</span><span class="si">:</span><span class="s1">.2e</span><span class="si">}</span><span class="s1">$'</span><span class="p">))</span>
    <span class="n">display</span><span class="p">(</span><span class="n">Latex</span><span class="p">(</span><span class="sa">f</span><span class="s1">'$</span><span class="se">\\</span><span class="s1">textbf</span><span class="se">{{</span><span class="s1">Power</span><span class="se">}}</span><span class="s1">$: $</span><span class="si">{</span><span class="n">power</span><span class="si">:</span><span class="s1">.2e</span><span class="si">}</span><span class="s1">$ W'</span><span class="p">))</span>
    
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"version_major": 2, "version_minor": 0, "model_id": "864b43c338734521bb8597443291e8bc"}</script></div>
</div>
</section>
</section>
</section>
<section id="high-frequency">
<h3>High Frequency<a class="headerlink" href="#high-frequency" title="Link to this heading">#</a></h3>
<section id="sensitivity-improvements-at-high-frequency">
<h4>Sensitivity Improvements at High Frequency<a class="headerlink" href="#sensitivity-improvements-at-high-frequency" title="Link to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">w</span> <span class="o">=</span> <span class="mf">3e-3</span>
<span class="n">L</span> <span class="o">=</span> <span class="mf">0.9e-3</span>
<span class="n">Vd</span> <span class="o">=</span> <span class="n">w</span><span class="o">*</span><span class="n">w</span><span class="o">*</span><span class="n">L</span>
<span class="n">V</span> <span class="o">=</span> <span class="mf">1.7</span><span class="o">/</span><span class="p">(</span><span class="mi">100</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span>
<span class="n">Q</span> <span class="o">=</span> <span class="mf">2.2e4</span>
<span class="n">omega_s0</span> <span class="o">=</span> <span class="mf">2.87e9</span>
<span class="n">B_bias</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span>
<span class="n">omega_s</span> <span class="o">=</span> <span class="n">omega_s0</span> <span class="o">+</span> <span class="mf">28e9</span><span class="o">*</span><span class="n">B_bias</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="n">scale_factor</span> <span class="o">=</span> <span class="n">omega_s0</span><span class="o">/</span><span class="n">omega_s</span>
<span class="n">V_scaled</span> <span class="o">=</span> <span class="n">V</span> <span class="o">*</span> <span class="p">(</span><span class="n">scale_factor</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span>

<span class="n">PowerList</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">70</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">51</span><span class="p">)</span>
<span class="n">vot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="n">PowerList</span> <span class="o">/</span> <span class="mi">10</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1e-3</span> <span class="o">*</span> <span class="mi">50</span><span class="p">)</span>
<span class="n">rho</span> <span class="o">=</span> <span class="mi">10</span>  <span class="c1"># NV density in ppm</span>
<span class="n">mu0</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="mf">1e-7</span>   
<span class="n">energies</span> <span class="o">=</span> <span class="mf">6.626e-34</span> <span class="o">*</span> <span class="n">omega_s</span>   <span class="c1">#h*omega</span>
<span class="n">I</span><span class="o">=</span><span class="mi">18800</span>
<span class="n">gammao</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="mi">270</span><span class="o">+</span><span class="mf">0.38</span><span class="o">*</span><span class="n">I</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">90</span><span class="o">+</span><span class="mf">0.58</span><span class="o">*</span><span class="n">I</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mi">270</span><span class="o">+</span><span class="mf">1.08</span><span class="o">*</span><span class="n">I</span><span class="p">)</span>
<span class="n">gss</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">6.626e-34</span> <span class="o">*</span> <span class="n">omega_s</span> <span class="o">*</span> <span class="p">(</span><span class="mf">28e9</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">mu0</span> <span class="o">/</span> <span class="mi">3</span> <span class="o">/</span> <span class="n">V_scaled</span><span class="p">)</span>   <span class="c1">#single coupling strength</span>
<span class="n">kc0s</span> <span class="o">=</span> <span class="n">omega_s</span> <span class="o">/</span> <span class="n">Q</span>   <span class="c1"># cavity linewidth</span>
<span class="n">kc1s</span> <span class="o">=</span> <span class="n">kc0s</span>    <span class="c1"># cavity loop coupling</span>

<span class="n">sens_freq</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">omega_s</span><span class="p">)):</span>
    <span class="n">omega</span> <span class="o">=</span> <span class="n">omega_s</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">energy</span> <span class="o">=</span> <span class="n">energies</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">V</span> <span class="o">=</span> <span class="n">V_scaled</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">kc0</span> <span class="o">=</span> <span class="n">kc0s</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">kc1</span> <span class="o">=</span> <span class="n">kc1s</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">kc</span> <span class="o">=</span> <span class="n">kc0</span> <span class="o">+</span> <span class="n">kc1</span>
    <span class="n">gs</span> <span class="o">=</span> <span class="n">gss</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">sens_freq</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">compute_sens</span><span class="p">(</span><span class="n">rho</span><span class="p">,</span> <span class="n">gammao</span><span class="p">,</span> <span class="n">V</span><span class="p">,</span> <span class="n">Q</span><span class="p">,</span> <span class="n">PowerList</span><span class="p">,</span> <span class="n">vot</span><span class="p">,</span> <span class="n">energy</span><span class="p">,</span> <span class="n">gs</span><span class="p">,</span> <span class="n">kc</span><span class="p">,</span> <span class="n">kc1</span><span class="p">,</span> <span class="n">Vd</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">()</span> 
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">omega_s</span><span class="o">/</span><span class="mf">1e9</span><span class="p">,</span> <span class="n">sens_freq</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">'Frequency (GHz)'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">'Sensitivity fT/$\sqrt</span><span class="si">{Hz}</span><span class="s1">$'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">'Sensitivity vs Frequency'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xscale</span><span class="p">(</span><span class="s1">'log'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yscale</span><span class="p">(</span><span class="s1">'log'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/4bf1d05e8a4c5b6e866c4878b0a103706859c9b6cebf4a08e3a0c29e05326906.png" src="_images/4bf1d05e8a4c5b6e866c4878b0a103706859c9b6cebf4a08e3a0c29e05326906.png"/>
</div>
</div>
</section>
<section id="power-reduction-at-high-frequency">
<h4>Power Reduction at High Frequency<a class="headerlink" href="#power-reduction-at-high-frequency" title="Link to this heading">#</a></h4>
</section>
<section id="first-power-model">
<h4>First Power Model<a class="headerlink" href="#first-power-model" title="Link to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Computed with the first of the two models for computing and minimizing power (linear scaling model)</span>
<span class="n">V</span> <span class="o">=</span> <span class="mf">1.7</span><span class="o">/</span><span class="p">(</span><span class="mi">100</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span>
<span class="n">Q</span> <span class="o">=</span> <span class="mf">2.2e4</span>
<span class="n">omega_s0</span> <span class="o">=</span> <span class="mf">2.87e9</span>
<span class="n">omega_s</span> <span class="o">=</span> <span class="n">omega_s0</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mf">1.5</span><span class="p">,</span><span class="mi">50</span><span class="p">)</span><span class="o">*</span><span class="mf">1e9</span>
<span class="n">scale_factor</span> <span class="o">=</span> <span class="n">omega_s0</span><span class="o">/</span><span class="n">omega_s</span>
<span class="n">V_scaled</span> <span class="o">=</span> <span class="n">V</span> <span class="o">*</span> <span class="p">(</span><span class="n">scale_factor</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span>

<span class="n">PowerList</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">70</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">51</span><span class="p">)</span>
<span class="n">vot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="n">PowerList</span> <span class="o">/</span> <span class="mi">10</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1e-3</span> <span class="o">*</span> <span class="mi">50</span><span class="p">)</span>
<span class="n">mu0</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="mf">1e-7</span>   
<span class="n">energies</span> <span class="o">=</span> <span class="mf">6.626e-34</span> <span class="o">*</span> <span class="n">omega_s</span>   <span class="c1">#h*omega</span>
<span class="n">gammao</span> <span class="o">=</span> <span class="mf">10e3</span>  
<span class="n">gss</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">6.626e-34</span> <span class="o">*</span> <span class="n">omega_s</span> <span class="o">*</span> <span class="p">(</span><span class="mf">28e9</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">mu0</span> <span class="o">/</span> <span class="mi">3</span> <span class="o">/</span> <span class="n">V_scaled</span><span class="p">)</span>   <span class="c1">#single coupling strength</span>
<span class="n">kc0s</span> <span class="o">=</span> <span class="n">omega_s</span> <span class="o">/</span> <span class="n">Q</span>   <span class="c1"># cavity linewidth</span>
<span class="n">kc1s</span> <span class="o">=</span> <span class="n">kc0s</span>    <span class="c1"># cavity loop coupling</span>

<span class="n">opt_powers_model1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">omega_s</span><span class="p">))</span>
<span class="n">args_model1</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">omega_s</span><span class="p">)):</span>
    <span class="n">omega</span> <span class="o">=</span> <span class="n">omega_s</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">V</span> <span class="o">=</span> <span class="n">V_scaled</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">energy</span> <span class="o">=</span> <span class="n">energies</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">gs</span> <span class="o">=</span> <span class="n">gss</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">kc1</span> <span class="o">=</span> <span class="n">kc1s</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">kc</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">kc1</span>
    <span class="n">opt_power</span><span class="p">,</span> <span class="n">Vd</span><span class="p">,</span> <span class="n">rho</span> <span class="o">=</span> <span class="n">min_power_linear</span><span class="p">(</span><span class="mf">100e-15</span><span class="p">,</span> <span class="n">V</span><span class="p">,</span> <span class="n">Q</span><span class="p">,</span> <span class="n">gammao</span><span class="p">,</span> <span class="n">PowerList</span><span class="p">,</span> <span class="n">vot</span><span class="p">,</span> <span class="n">energy</span><span class="p">,</span> <span class="n">gs</span><span class="p">,</span> <span class="n">kc</span><span class="p">,</span> <span class="n">kc1</span><span class="p">)</span>
    <span class="n">opt_powers_model1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">opt_power</span>
    <span class="n">args_model1</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">omega</span><span class="o">/</span><span class="mf">1e9</span><span class="p">,</span><span class="n">opt_power</span><span class="p">,</span><span class="n">V</span><span class="p">,</span><span class="n">Vd</span><span class="p">,</span><span class="n">rho</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">display</span><span class="p">,</span> <span class="n">Latex</span>

<span class="c1"># Define target Q and sensitivity</span>
<span class="n">target_Q</span> <span class="o">=</span> <span class="n">Q</span>  <span class="c1"># Q is already defined as 2.2e4 in the previous code</span>
<span class="n">string</span> <span class="o">=</span> <span class="s1">'100'</span>  <span class="c1"># Sensitivity in fT</span>

<span class="c1"># Extract frequencies from argss and find index closest to target</span>
<span class="n">frequencies</span> <span class="o">=</span> <span class="p">[</span><span class="n">entry</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">args_model1</span><span class="p">]</span>  <span class="c1"># Frequencies in GHz</span>
<span class="k">def</span> <span class="nf">find_closest_freq</span><span class="p">(</span><span class="n">frequencies</span><span class="p">,</span> <span class="n">target</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">frequencies</span><span class="p">)</span> <span class="o">-</span> <span class="n">target</span><span class="p">))</span>

<span class="c1"># Function to find the index of the minimum power</span>
<span class="k">def</span> <span class="nf">find_min_power</span><span class="p">(</span><span class="n">powers</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">powers</span><span class="p">)</span>

<span class="c1"># Find index closest to 10 GHz</span>
<span class="n">target_freq</span> <span class="o">=</span> <span class="mi">10</span>  <span class="c1"># GHz</span>
<span class="n">idx_10ghz</span> <span class="o">=</span> <span class="n">find_closest_freq</span><span class="p">(</span><span class="n">frequencies</span><span class="p">,</span> <span class="n">target_freq</span><span class="p">)</span>
<span class="n">freq_10ghz</span> <span class="o">=</span> <span class="n">frequencies</span><span class="p">[</span><span class="n">idx_10ghz</span><span class="p">]</span>

<span class="c1"># Extract parameters for 10 GHz</span>
<span class="n">power_10ghz</span> <span class="o">=</span> <span class="n">args_model1</span><span class="p">[</span><span class="n">idx_10ghz</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
<span class="n">V_10ghz</span> <span class="o">=</span> <span class="n">args_model1</span><span class="p">[</span><span class="n">idx_10ghz</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
<span class="n">Vd_10ghz</span> <span class="o">=</span> <span class="n">args_model1</span><span class="p">[</span><span class="n">idx_10ghz</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span>
<span class="n">rho_10ghz</span> <span class="o">=</span> <span class="n">args_model1</span><span class="p">[</span><span class="n">idx_10ghz</span><span class="p">][</span><span class="mi">4</span><span class="p">]</span>

<span class="c1"># Find index with minimum power</span>
<span class="n">powers</span> <span class="o">=</span> <span class="p">[</span><span class="n">entry</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">args_model1</span><span class="p">]</span>
<span class="n">idx_min_power</span> <span class="o">=</span> <span class="n">find_min_power</span><span class="p">(</span><span class="n">powers</span><span class="p">)</span>
<span class="n">power_min</span> <span class="o">=</span> <span class="n">powers</span><span class="p">[</span><span class="n">idx_min_power</span><span class="p">]</span>
<span class="n">V_min</span> <span class="o">=</span> <span class="n">args_model1</span><span class="p">[</span><span class="n">idx_min_power</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
<span class="n">Vd_min</span> <span class="o">=</span> <span class="n">args_model1</span><span class="p">[</span><span class="n">idx_min_power</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span>
<span class="n">rho_min</span> <span class="o">=</span> <span class="n">args_model1</span><span class="p">[</span><span class="n">idx_min_power</span><span class="p">][</span><span class="mi">4</span><span class="p">]</span>
<span class="n">freq_min_power</span> <span class="o">=</span> <span class="n">frequencies</span><span class="p">[</span><span class="n">idx_min_power</span><span class="p">]</span>

<span class="c1"># Display parameters for 10 GHz</span>
<span class="n">display</span><span class="p">(</span><span class="n">Latex</span><span class="p">(</span><span class="sa">f</span><span class="s2">"The following parameters are roughly optimal for 10GHz and a Q of </span><span class="si">{</span><span class="n">target_Q</span><span class="si">:</span><span class="s2">.0f</span><span class="si">}</span><span class="s2">:"</span><span class="p">))</span>
<span class="n">display</span><span class="p">(</span><span class="n">Latex</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Sensitivity: </span><span class="si">{</span><span class="n">string</span><span class="si">}</span><span class="s2"> $fT/</span><span class="se">\\</span><span class="s2">sqrt</span><span class="se">{{</span><span class="s2">Hz</span><span class="se">}}</span><span class="s2">$"</span><span class="p">))</span>
<span class="n">display</span><span class="p">(</span><span class="n">Latex</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Mode Volume (V): </span><span class="si">{</span><span class="n">V_10ghz</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2"> m$^3$"</span><span class="p">))</span>
<span class="n">display</span><span class="p">(</span><span class="n">Latex</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Diamond Volume (Vd): </span><span class="si">{</span><span class="n">Vd_10ghz</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2"> m$^3$"</span><span class="p">))</span>
<span class="n">display</span><span class="p">(</span><span class="n">Latex</span><span class="p">(</span><span class="sa">f</span><span class="s2">"NV Density: </span><span class="si">{</span><span class="n">rho_10ghz</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2"> ppm"</span><span class="p">))</span>
<span class="n">display</span><span class="p">(</span><span class="n">Latex</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Minimum Power: </span><span class="si">{</span><span class="n">power_10ghz</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">1e3</span><span class="si">:</span><span class="s2">.0f</span><span class="si">}</span><span class="s2"> mW"</span><span class="p">))</span>

<span class="c1"># Display parameters for the frequency that minimizes power</span>
<span class="n">display</span><span class="p">(</span><span class="n">Latex</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\n</span><span class="s2">The following parameters are roughly optimal for a Q of </span><span class="si">{</span><span class="n">target_Q</span><span class="si">:</span><span class="s2">.0f</span><span class="si">}</span><span class="s2"> at the frequency that minimizes power:"</span><span class="p">))</span>
<span class="n">display</span><span class="p">(</span><span class="n">Latex</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Sensitivity: </span><span class="si">{</span><span class="n">string</span><span class="si">}</span><span class="s2"> $fT/</span><span class="se">\\</span><span class="s2">sqrt</span><span class="se">{{</span><span class="s2">Hz</span><span class="se">}}</span><span class="s2">$"</span><span class="p">))</span>
<span class="n">display</span><span class="p">(</span><span class="n">Latex</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Frequency: </span><span class="si">{</span><span class="n">freq_min_power</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> GHz"</span><span class="p">))</span>
<span class="n">display</span><span class="p">(</span><span class="n">Latex</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Mode Volume (V): </span><span class="si">{</span><span class="n">V_min</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2"> m$^3$"</span><span class="p">))</span>
<span class="n">display</span><span class="p">(</span><span class="n">Latex</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Diamond Volume (Vd): </span><span class="si">{</span><span class="n">Vd_min</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2"> m$^3$"</span><span class="p">))</span>
<span class="n">display</span><span class="p">(</span><span class="n">Latex</span><span class="p">(</span><span class="sa">f</span><span class="s2">"NV Density: </span><span class="si">{</span><span class="n">rho_min</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2"> ppm"</span><span class="p">))</span>
<span class="n">display</span><span class="p">(</span><span class="n">Latex</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Minimum Power: </span><span class="si">{</span><span class="n">power_min</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">1e3</span><span class="si">:</span><span class="s2">.0f</span><span class="si">}</span><span class="s2"> mW"</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_latex math notranslate nohighlight">
\[The following parameters are roughly optimal for 10GHz and a Q of 22000:\]</div>
<div class="output text_latex math notranslate nohighlight">
\[Sensitivity: 100 $fT/\sqrt{Hz}$\]</div>
<div class="output text_latex math notranslate nohighlight">
\[Mode Volume (V): 3.94e-08 m$^3$\]</div>
<div class="output text_latex math notranslate nohighlight">
\[Diamond Volume (Vd): 2.88e-08 m$^3$\]</div>
<div class="output text_latex math notranslate nohighlight">
\[NV Density: 0.031 ppm\]</div>
<div class="output text_latex math notranslate nohighlight">
\[Minimum Power: 220 mW\]</div>
<div class="output text_latex math notranslate nohighlight">
\[The following parameters are roughly optimal for a Q of 22000 at the frequency that minimizes power:\]</div>
<div class="output text_latex math notranslate nohighlight">
\[Sensitivity: 100 $fT/\sqrt{Hz}$\]</div>
<div class="output text_latex math notranslate nohighlight">
\[Frequency: 34.49 GHz\]</div>
<div class="output text_latex math notranslate nohighlight">
\[Mode Volume (V): 9.79e-10 m$^3$\]</div>
<div class="output text_latex math notranslate nohighlight">
\[Diamond Volume (Vd): 9.78e-10 m$^3$\]</div>
<div class="output text_latex math notranslate nohighlight">
\[NV Density: 0.429 ppm\]</div>
<div class="output text_latex math notranslate nohighlight">
\[Minimum Power: 104 mW\]</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">scipy.ndimage</span> <span class="kn">import</span> <span class="n">gaussian_filter1d</span>

<span class="c1"># Apply Gaussian smoothing to the power models</span>
<span class="n">smoothed_opt_powers_model1</span> <span class="o">=</span> <span class="n">gaussian_filter1d</span><span class="p">(</span><span class="n">opt_powers_model1</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="c1"># Plotting</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">omega_s</span> <span class="o">/</span> <span class="mf">1e9</span><span class="p">,</span> <span class="n">smoothed_opt_powers_model1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">'Frequency (GHz)'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">'Power (W)'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">r</span><span class="s1">'Minimum Power to reach 100 fT/$\sqrt</span><span class="si">{Hz}</span><span class="s1">$'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yscale</span><span class="p">(</span><span class="s1">'log'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xscale</span><span class="p">(</span><span class="s1">'log'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>

<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">'both'</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">'major'</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>  <span class="c1"># Major tick labels</span>

<span class="c1"># plt.legend( fontsize=16)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/0d728f01e3f89777ce6d7118581a723d311ceeb81377b7ab0f8b72a48bbb1d0b.png" src="_images/0d728f01e3f89777ce6d7118581a723d311ceeb81377b7ab0f8b72a48bbb1d0b.png"/>
</div>
</div>
</section>
<section id="second-power-model">
<h4>Second Power Model<a class="headerlink" href="#second-power-model" title="Link to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Computed with the latter of the two models for computing and minimizing power</span>
<span class="n">V</span> <span class="o">=</span> <span class="mf">1.7</span><span class="o">/</span><span class="p">(</span><span class="mi">100</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span>
<span class="n">Q</span> <span class="o">=</span> <span class="mf">2.2e4</span>
<span class="n">omega_s0</span> <span class="o">=</span> <span class="mf">2.87e9</span>
<span class="n">omega_s</span> <span class="o">=</span> <span class="n">omega_s0</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mf">1.5</span><span class="p">,</span><span class="mi">50</span><span class="p">)</span><span class="o">*</span><span class="mf">1e9</span>
<span class="n">scale_factor</span> <span class="o">=</span> <span class="n">omega_s0</span><span class="o">/</span><span class="n">omega_s</span>
<span class="n">V_scaled</span> <span class="o">=</span> <span class="n">V</span> <span class="o">*</span> <span class="p">(</span><span class="n">scale_factor</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span>

<span class="n">PowerList</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">70</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">51</span><span class="p">)</span>
<span class="n">vot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="n">PowerList</span> <span class="o">/</span> <span class="mi">10</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1e-3</span> <span class="o">*</span> <span class="mi">50</span><span class="p">)</span>
<span class="n">mu0</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="mf">1e-7</span>   
<span class="n">gss</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">6.626e-34</span> <span class="o">*</span> <span class="n">omega_s</span> <span class="o">*</span> <span class="p">(</span><span class="mf">28e9</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">mu0</span> <span class="o">/</span> <span class="mi">3</span> <span class="o">/</span> <span class="n">V_scaled</span><span class="p">)</span>   <span class="c1">#single coupling strength</span>
<span class="n">kc0s</span> <span class="o">=</span> <span class="n">omega_s</span> <span class="o">/</span> <span class="n">Q</span>   <span class="c1"># cavity linewidth</span>
<span class="n">kc1s</span> <span class="o">=</span> <span class="n">kc0s</span>    <span class="c1"># cavity loop coupling</span>

<span class="n">opt_powers_model2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">omega_s</span><span class="p">))</span>
<span class="n">args_model_2</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">omega_s</span><span class="p">)):</span>
    <span class="n">omega</span> <span class="o">=</span> <span class="n">omega_s</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">V</span> <span class="o">=</span> <span class="n">V_scaled</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">kc0</span> <span class="o">=</span> <span class="n">kc0s</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">kc1</span> <span class="o">=</span> <span class="n">kc1s</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">opt_power</span><span class="p">,</span> <span class="n">args</span> <span class="o">=</span> <span class="n">minimize_power_single</span><span class="p">(</span><span class="mf">100e-15</span><span class="p">,</span> <span class="n">omega</span><span class="p">,</span> <span class="n">V</span><span class="p">,</span> <span class="n">Q</span><span class="p">,</span> <span class="n">kc0</span><span class="o">=</span><span class="n">kc0</span><span class="p">,</span> <span class="n">kc1</span><span class="o">=</span><span class="n">kc1</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
    <span class="n">opt_powers_model2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">opt_power</span>
    <span class="n">args_model_2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
    
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">display</span><span class="p">,</span> <span class="n">Latex</span>

<span class="c1"># Define target Q and sensitivity</span>
<span class="n">target_Q</span> <span class="o">=</span> <span class="n">Q</span>  <span class="c1"># Q is already defined as 2.2e4</span>
<span class="n">string</span> <span class="o">=</span> <span class="s1">'100'</span>  <span class="c1"># Sensitivity in fT</span>

<span class="c1"># Extract frequencies from omega_s and convert to GHz and find closest to target</span>
<span class="n">frequencies</span> <span class="o">=</span> <span class="p">[</span><span class="n">omega</span> <span class="o">/</span> <span class="mf">1e9</span> <span class="k">for</span> <span class="n">omega</span> <span class="ow">in</span> <span class="n">omega_s</span><span class="p">]</span>  <span class="c1"># Frequencies in GHz</span>
<span class="k">def</span> <span class="nf">find_closest_freq</span><span class="p">(</span><span class="n">frequencies</span><span class="p">,</span> <span class="n">target</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">frequencies</span><span class="p">)</span> <span class="o">-</span> <span class="n">target</span><span class="p">))</span>

<span class="c1"># Function to find the index of the minimum power</span>
<span class="k">def</span> <span class="nf">find_min_power</span><span class="p">(</span><span class="n">powers</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">powers</span><span class="p">)</span>

<span class="c1"># Find index closest to 10 GHz</span>
<span class="n">target_freq</span> <span class="o">=</span> <span class="mi">10</span>  <span class="c1"># GHz</span>
<span class="n">idx_10ghz</span> <span class="o">=</span> <span class="n">find_closest_freq</span><span class="p">(</span><span class="n">frequencies</span><span class="p">,</span> <span class="n">target_freq</span><span class="p">)</span>
<span class="n">freq_10ghz</span> <span class="o">=</span> <span class="n">frequencies</span><span class="p">[</span><span class="n">idx_10ghz</span><span class="p">]</span>

<span class="c1"># Extract parameters for 10 GHz</span>
<span class="n">power_10ghz</span> <span class="o">=</span> <span class="n">opt_powers_model2</span><span class="p">[</span><span class="n">idx_10ghz</span><span class="p">]</span>
<span class="n">V_10ghz</span> <span class="o">=</span> <span class="n">V_scaled</span><span class="p">[</span><span class="n">idx_10ghz</span><span class="p">]</span>
<span class="n">w_10ghz</span> <span class="o">=</span> <span class="n">args_model_2</span><span class="p">[</span><span class="n">idx_10ghz</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>    <span class="c1"># args[1] = w</span>
<span class="n">rho_10ghz</span> <span class="o">=</span> <span class="n">args_model_2</span><span class="p">[</span><span class="n">idx_10ghz</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>  <span class="c1"># args[2] = rho</span>
<span class="n">Vd_10ghz</span> <span class="o">=</span> <span class="n">w_10ghz</span> <span class="o">*</span> <span class="n">w_10ghz</span> <span class="o">*</span> <span class="mf">0.9e-3</span>  <span class="c1"># Compute Diamond Volume</span>

<span class="c1"># Find index with minimum power</span>
<span class="n">idx_min_power</span> <span class="o">=</span> <span class="n">find_min_power</span><span class="p">(</span><span class="n">opt_powers_model2</span><span class="p">)</span>
<span class="n">power_min</span> <span class="o">=</span> <span class="n">opt_powers_model2</span><span class="p">[</span><span class="n">idx_min_power</span><span class="p">]</span>
<span class="n">V_min</span> <span class="o">=</span> <span class="n">V_scaled</span><span class="p">[</span><span class="n">idx_min_power</span><span class="p">]</span>
<span class="n">w_min</span> <span class="o">=</span> <span class="n">args_model_2</span><span class="p">[</span><span class="n">idx_min_power</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>    <span class="c1"># args[1] = w</span>
<span class="n">rho_min</span> <span class="o">=</span> <span class="n">args_model_2</span><span class="p">[</span><span class="n">idx_min_power</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>  <span class="c1"># args[2] = rho</span>
<span class="n">Vd_min</span> <span class="o">=</span> <span class="n">w_min</span> <span class="o">*</span> <span class="n">w_min</span> <span class="o">*</span> <span class="n">L</span>          <span class="c1"># Compute Diamond Volume</span>
<span class="n">freq_min_power</span> <span class="o">=</span> <span class="n">frequencies</span><span class="p">[</span><span class="n">idx_min_power</span><span class="p">]</span>

<span class="c1"># Display parameters for 10 GHz</span>
<span class="n">display</span><span class="p">(</span><span class="n">Latex</span><span class="p">(</span><span class="sa">f</span><span class="s2">"The following parameters are roughly optimal for 10 GHz and a Q of </span><span class="si">{</span><span class="n">target_Q</span><span class="si">:</span><span class="s2">.0f</span><span class="si">}</span><span class="s2">:"</span><span class="p">))</span>
<span class="n">display</span><span class="p">(</span><span class="n">Latex</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Sensitivity: </span><span class="si">{</span><span class="n">string</span><span class="si">}</span><span class="s2"> $fT/</span><span class="se">\\</span><span class="s2">sqrt</span><span class="se">{{</span><span class="s2">Hz</span><span class="se">}}</span><span class="s2">$"</span><span class="p">))</span>
<span class="n">display</span><span class="p">(</span><span class="n">Latex</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Mode Volume (V): </span><span class="si">{</span><span class="n">V_10ghz</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2"> m$^3$"</span><span class="p">))</span>
<span class="n">display</span><span class="p">(</span><span class="n">Latex</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Diamond Volume (Vd): </span><span class="si">{</span><span class="n">Vd_10ghz</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2"> m$^3$"</span><span class="p">))</span>
<span class="n">display</span><span class="p">(</span><span class="n">Latex</span><span class="p">(</span><span class="sa">f</span><span class="s2">"NV Density: </span><span class="si">{</span><span class="n">rho_10ghz</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2"> ppm"</span><span class="p">))</span>
<span class="n">display</span><span class="p">(</span><span class="n">Latex</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Minimum Power: </span><span class="si">{</span><span class="n">power_10ghz</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">1e3</span><span class="si">:</span><span class="s2">.0f</span><span class="si">}</span><span class="s2"> mW"</span><span class="p">))</span>
<span class="n">display</span><span class="p">(</span><span class="n">Latex</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Quality Factor (Q): </span><span class="si">{</span><span class="n">target_Q</span><span class="si">:</span><span class="s2">.0f</span><span class="si">}</span><span class="s2">"</span><span class="p">))</span>

<span class="c1"># Display parameters for the frequency that minimizes power</span>
<span class="n">display</span><span class="p">(</span><span class="n">Latex</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\n</span><span class="s2">The following parameters are roughly optimal for a Q of </span><span class="si">{</span><span class="n">target_Q</span><span class="si">:</span><span class="s2">.0f</span><span class="si">}</span><span class="s2"> at the frequency that minimizes power:"</span><span class="p">))</span>
<span class="n">display</span><span class="p">(</span><span class="n">Latex</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Sensitivity: </span><span class="si">{</span><span class="n">string</span><span class="si">}</span><span class="s2"> $fT/</span><span class="se">\\</span><span class="s2">sqrt</span><span class="se">{{</span><span class="s2">Hz</span><span class="se">}}</span><span class="s2">$"</span><span class="p">))</span>
<span class="n">display</span><span class="p">(</span><span class="n">Latex</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Frequency: </span><span class="si">{</span><span class="n">freq_min_power</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> GHz"</span><span class="p">))</span>
<span class="n">display</span><span class="p">(</span><span class="n">Latex</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Mode Volume (V): </span><span class="si">{</span><span class="n">V_min</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2"> m$^3$"</span><span class="p">))</span>
<span class="n">display</span><span class="p">(</span><span class="n">Latex</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Diamond Volume (Vd): </span><span class="si">{</span><span class="n">Vd_min</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2"> m$^3$"</span><span class="p">))</span>
<span class="n">display</span><span class="p">(</span><span class="n">Latex</span><span class="p">(</span><span class="sa">f</span><span class="s2">"NV Density: </span><span class="si">{</span><span class="n">rho_min</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2"> ppm"</span><span class="p">))</span>
<span class="n">display</span><span class="p">(</span><span class="n">Latex</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Minimum Power: </span><span class="si">{</span><span class="n">power_min</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">1e3</span><span class="si">:</span><span class="s2">.0f</span><span class="si">}</span><span class="s2"> mW"</span><span class="p">))</span>
<span class="n">display</span><span class="p">(</span><span class="n">Latex</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Quality Factor (Q): </span><span class="si">{</span><span class="n">target_Q</span><span class="si">:</span><span class="s2">.0f</span><span class="si">}</span><span class="s2">"</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_latex math notranslate nohighlight">
\[The following parameters are roughly optimal for 10 GHz and a Q of 22000:\]</div>
<div class="output text_latex math notranslate nohighlight">
\[Sensitivity: 100 $fT/\sqrt{Hz}$\]</div>
<div class="output text_latex math notranslate nohighlight">
\[Mode Volume (V): 3.94e-08 m$^3$\]</div>
<div class="output text_latex math notranslate nohighlight">
\[Diamond Volume (Vd): 1.27e-08 m$^3$\]</div>
<div class="output text_latex math notranslate nohighlight">
\[NV Density: 0.041 ppm\]</div>
<div class="output text_latex math notranslate nohighlight">
\[Minimum Power: 141 mW\]</div>
<div class="output text_latex math notranslate nohighlight">
\[Quality Factor (Q): 22000\]</div>
<div class="output text_latex math notranslate nohighlight">
\[The following parameters are roughly optimal for a Q of 22000 at the frequency that minimizes power:\]</div>
<div class="output text_latex math notranslate nohighlight">
\[Sensitivity: 100 $fT/\sqrt{Hz}$\]</div>
<div class="output text_latex math notranslate nohighlight">
\[Frequency: 25.63 GHz\]</div>
<div class="output text_latex math notranslate nohighlight">
\[Mode Volume (V): 2.39e-09 m$^3$\]</div>
<div class="output text_latex math notranslate nohighlight">
\[Diamond Volume (Vd): 2.39e-09 m$^3$\]</div>
<div class="output text_latex math notranslate nohighlight">
\[NV Density: 0.063 ppm\]</div>
<div class="output text_latex math notranslate nohighlight">
\[Minimum Power: 53 mW\]</div>
<div class="output text_latex math notranslate nohighlight">
\[Quality Factor (Q): 22000\]</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">scipy.ndimage</span> <span class="kn">import</span> <span class="n">gaussian_filter1d</span>

<span class="c1"># Apply Gaussian smoothing to the power models</span>
<span class="n">smoothed_opt_powers_model2</span> <span class="o">=</span> <span class="n">gaussian_filter1d</span><span class="p">(</span><span class="n">opt_powers_model2</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">()</span> 
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">omega_s</span><span class="o">/</span><span class="mf">1e9</span><span class="p">,</span> <span class="n">smoothed_opt_powers_model2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">'Frequency (GHz)'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">'Power (W)'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">r</span><span class="s1">'Minimum Power to reach 100 fT/$\sqrt</span><span class="si">{Hz}</span><span class="s1">$'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yscale</span><span class="p">(</span><span class="s1">'log'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xscale</span><span class="p">(</span><span class="s1">'log'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>

<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">'both'</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">'major'</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>  <span class="c1"># Major tick labels</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/cae583e4bdbb89abc5d82b299359388256b602a6fc8f6b63c843be779caa3331.png" src="_images/cae583e4bdbb89abc5d82b299359388256b602a6fc8f6b63c843be779caa3331.png"/>
</div>
</div>
</section>
</section>
<section id="stealth-magnet">
<h3>Stealth Magnet<a class="headerlink" href="#stealth-magnet" title="Link to this heading">#</a></h3>
<section id="permanent-magnets">
<h4>Permanent Magnets<a class="headerlink" href="#permanent-magnets" title="Link to this heading">#</a></h4>
<p>We can make use of the skin effect to disguise permanent magnets in the cavity. The magnets will be coated by a thin layer of metallic material. This allows the permanent magnets to provide a DC field that penetrates through the metal of the cavity to create the bias field for large Zeeman splitting of the NV system at the location of the diamond. The metal coating over the magnets ensures the cavity mode is not disrupted by the magnets. This large Zeeman effect creates a high spin transition frequency that facilitates higher frequency operation of the magnetometer.</p>
<p><img alt="11_7_Bfield_close.png" src="attachment:11_7_Bfield_close.png"/></p>
<p>A COMSOL simulation was used to investigate the stealth magnet concept. The double re-entrance cavity from Choi &amp; Englund “Ultrastrong magnetic light-matter interaction with cavity mode engineering” was used and altered slightly to be smaller, with proportionally larger re-entrances to acheive higher cavity frequency and ample space for magnets.</p>
<p>Cavity frequency was computed in COMSOL simulatin, and cavity mode volume and quality factor were computed with the assistance of COMSOL and the equations in Choi &amp; Englund.</p>
<p>Cavity Mode Frequency: <span class="math notranslate nohighlight">\(6.3112\)</span> GHz <span class="math notranslate nohighlight">\(\newline\)</span>
Mode Volume: <span class="math notranslate nohighlight">\(8.154e-8\)</span> <span class="math notranslate nohighlight">\(m^{3}\)</span> <span class="math notranslate nohighlight">\(\newline\)</span>
Quality Factor: <span class="math notranslate nohighlight">\(13789\)</span></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Find the optimal parameters for minimizing power given these cavity specifics</span>
<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">display</span><span class="p">,</span> <span class="n">Latex</span>
<span class="n">omega_c</span> <span class="o">=</span> <span class="mf">6.3112e9</span>
<span class="n">V</span> <span class="o">=</span> <span class="mf">8.154e-8</span>
<span class="n">Q</span> <span class="o">=</span> <span class="mi">13789</span>
<span class="n">kc0</span> <span class="o">=</span> <span class="n">omega_c</span> <span class="o">/</span> <span class="n">Q</span>   <span class="c1"># cavity linewidth</span>
<span class="n">kc1</span> <span class="o">=</span> <span class="n">kc0</span>    <span class="c1"># cavity loop coupling</span>
<span class="n">kc</span> <span class="o">=</span> <span class="n">kc0</span> <span class="o">+</span> <span class="n">kc1</span>   <span class="c1"># cavity loss</span>
<span class="n">max_sens</span> <span class="o">=</span> <span class="mf">120e-15</span>
<span class="n">L</span><span class="o">=</span><span class="mf">2e-3</span>
<span class="n">power_100fT_6GHz</span><span class="p">,</span> <span class="n">sens_args_100fT_6GHz</span> <span class="o">=</span> <span class="n">minimize_power_single</span><span class="p">(</span><span class="n">max_sens</span><span class="p">,</span> <span class="n">omega_c</span><span class="p">,</span> <span class="n">V</span><span class="p">,</span> <span class="n">Q</span><span class="p">,</span> <span class="n">kc0</span><span class="o">=</span><span class="n">kc0</span><span class="p">,</span> <span class="n">kc1</span><span class="o">=</span><span class="n">kc1</span><span class="p">,</span> <span class="n">w_bound</span><span class="o">=</span><span class="mf">2e-3</span><span class="p">,</span> <span class="n">L</span><span class="o">=</span><span class="n">L</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">Latex</span><span class="p">(</span>
    <span class="sa">f</span><span class="s2">"With this stealth magnet cavity at </span><span class="si">{</span><span class="n">omega_c</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="mf">1e9</span><span class="p">)</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> GHz, we can achieve </span><span class="si">{</span><span class="n">max_sens</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2"> $T/</span><span class="se">\\</span><span class="s2">sqrt</span><span class="se">{{</span><span class="s2">Hz</span><span class="se">}}</span><span class="s2">$ "</span>
    <span class="sa">f</span><span class="s2">"at </span><span class="si">{</span><span class="n">power_100fT_6GHz</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">1e3</span><span class="si">:</span><span class="s2">.0f</span><span class="si">}</span><span class="s2"> mW of power. "</span>
    <span class="sa">f</span><span class="s2">"The mode volume is </span><span class="si">{</span><span class="n">V</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2"> m$^3$, diamond volume is </span><span class="si">{</span><span class="p">(</span><span class="n">sens_args_100fT_6GHz</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">L</span><span class="p">)</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2"> m$^3$, "</span>
    <span class="sa">f</span><span class="s2">"and NV density is </span><span class="si">{</span><span class="n">sens_args_100fT_6GHz</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2"> ppm."</span>
<span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_latex math notranslate nohighlight">
\[With this stealth magnet cavity at 6.31 GHz, we can achieve 1.20e-13 $T/\sqrt{Hz}$ at 141 mW of power. The mode volume is 8.15e-08 m$^3$, diamond volume is 8.00e-09 m$^3$, and NV density is 0.061 ppm.\]</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Lets confirm we can realize the results stated above</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">display</span><span class="p">,</span> <span class="n">Latex</span>

<span class="n">PowerList</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">70</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">51</span><span class="p">)</span>
<span class="n">vot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="n">PowerList</span> <span class="o">/</span> <span class="mi">10</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1e-3</span> <span class="o">*</span> <span class="mi">50</span><span class="p">)</span>
<span class="n">omega_c</span> <span class="o">=</span> <span class="mf">6.3112e9</span>
<span class="n">V</span> <span class="o">=</span> <span class="mf">8.154e-8</span>
<span class="n">Q</span> <span class="o">=</span> <span class="mi">13789</span>
<span class="n">kc0</span> <span class="o">=</span> <span class="n">omega_c</span> <span class="o">/</span> <span class="n">Q</span>   <span class="c1"># cavity linewidth</span>
<span class="n">kc1</span> <span class="o">=</span> <span class="n">kc0</span>    <span class="c1"># cavity loop coupling</span>
<span class="n">kc</span> <span class="o">=</span> <span class="n">kc0</span> <span class="o">+</span> <span class="n">kc1</span>   <span class="c1"># cavity loss</span>
<span class="n">w</span> <span class="o">=</span> <span class="mf">2e-3</span>
<span class="n">L</span> <span class="o">=</span> <span class="mf">2e-3</span>
<span class="n">Vd</span> <span class="o">=</span> <span class="n">w</span><span class="o">*</span><span class="n">w</span><span class="o">*</span><span class="n">L</span>
<span class="n">rho</span> <span class="o">=</span> <span class="mf">0.061</span>  <span class="c1"># NV density in ppm</span>
<span class="n">mu0</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="mf">1e-7</span>   
<span class="n">energy</span> <span class="o">=</span> <span class="mf">6.626e-34</span> <span class="o">*</span> <span class="n">omega_c</span>   <span class="c1">#h*omega</span>
<span class="n">gammao</span> <span class="o">=</span> <span class="mi">540</span>
<span class="n">gs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">6.626e-34</span> <span class="o">*</span> <span class="n">omega_c</span> <span class="o">*</span> <span class="p">(</span><span class="mf">28e9</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">mu0</span> <span class="o">/</span> <span class="mi">3</span> <span class="o">/</span> <span class="n">V</span><span class="p">)</span>   <span class="c1">#single coupling strength</span>
<span class="n">Gamma</span> <span class="o">=</span> <span class="mf">330e3</span> <span class="o">/</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">rho</span>
<span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.45</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">*</span><span class="n">rho</span><span class="o">/</span><span class="mf">0.1</span>

<span class="n">sens_stealth</span> <span class="o">=</span> <span class="n">compute_sens</span><span class="p">(</span><span class="n">rho</span><span class="p">,</span> <span class="n">gammao</span><span class="p">,</span> <span class="n">V</span><span class="p">,</span> <span class="n">Q</span><span class="p">,</span> <span class="n">PowerList</span><span class="p">,</span> <span class="n">vot</span><span class="p">,</span> <span class="n">energy</span><span class="p">,</span> <span class="n">gs</span><span class="p">,</span> <span class="n">kc</span><span class="p">,</span> <span class="n">kc1</span><span class="p">,</span> <span class="n">Vd</span><span class="p">)</span>

<span class="n">P_per_NV</span> <span class="o">=</span> <span class="mi">8</span><span class="o">/</span><span class="p">(</span><span class="mf">3e-3</span><span class="o">*</span><span class="mf">3e-3</span><span class="o">*</span><span class="mf">0.9e-3</span><span class="o">*</span><span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="mf">3.51</span> <span class="o">/</span> <span class="mf">12.01</span> <span class="o">*</span> <span class="mf">6.022e23</span><span class="p">))</span>
<span class="n">power1</span> <span class="o">=</span> <span class="n">P_per_NV</span> <span class="o">*</span> <span class="n">Vd</span> <span class="o">*</span> <span class="p">(</span><span class="n">rho</span> <span class="o">*</span> <span class="mf">3.51</span> <span class="o">/</span> <span class="mf">12.01</span> <span class="o">*</span> <span class="mf">6.022e23</span><span class="p">)</span> 

<span class="n">absorp_cs</span> <span class="o">=</span> <span class="mf">8e-17</span> <span class="o">/</span> <span class="p">(</span><span class="mi">100</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="n">gamma_th</span> <span class="o">=</span> <span class="mi">90</span> <span class="c1"># thermal relxation rate</span>
<span class="n">I</span> <span class="o">=</span> <span class="mf">1.225</span> <span class="o">*</span> <span class="n">gammao</span> <span class="o">-</span> <span class="mf">4.809</span> <span class="o">*</span> <span class="n">gamma_th</span> <span class="o">+</span> <span class="mf">3.085</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">0.1577</span> <span class="o">*</span> <span class="n">gammao</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="mf">0.5229</span> <span class="o">*</span> <span class="n">gammao</span> <span class="o">*</span> <span class="n">gamma_th</span> <span class="o">+</span> <span class="n">gamma_th</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="n">power2</span> <span class="o">=</span> <span class="n">w</span> <span class="o">*</span> <span class="n">w</span> <span class="o">*</span> <span class="p">(</span><span class="mf">6.626e-34</span><span class="o">*</span><span class="p">(</span><span class="mf">3e8</span><span class="o">/</span><span class="mf">532e-9</span><span class="p">))</span><span class="o">*</span><span class="n">I</span><span class="o">/</span><span class="n">absorp_cs</span>

<span class="n">display</span><span class="p">(</span><span class="n">Latex</span><span class="p">(</span><span class="sa">f</span><span class="s2">"This stealth magnet model predicts sensitivity of $</span><span class="si">{</span><span class="n">sens_stealth</span><span class="si">:</span><span class="s2">.2e</span><span class="si">}</span><span class="s2">$ $T/\sqrt</span><span class="se">{{</span><span class="s2">Hz</span><span class="se">}}</span><span class="s2">$. "</span>
                <span class="sa">f</span><span class="s2">"Optical power required is roughly $</span><span class="si">{</span><span class="mf">1e3</span><span class="o">*</span><span class="n">power1</span><span class="si">:</span><span class="s2">.0f</span><span class="si">}</span><span class="s2">$-$</span><span class="si">{</span><span class="mf">1e3</span><span class="o">*</span><span class="n">power2</span><span class="si">:</span><span class="s2">.0f</span><span class="si">}</span><span class="s2">$ mW."</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_latex math notranslate nohighlight">
\[This stealth magnet model predicts sensitivity of $1.20e-13$ $T/\sqrt{Hz}$. Optical power required is roughly $120$-$140$ mW.\]</div>
</div>
</div>
<p><img alt="11_7_contour_close.png" src="attachment:11_7_contour_close.png"/></p>
<p>Above is a top down view of a contour plot of magnetic flux density. The circles represent the cyclindrical re-entrances, and the rectangles within them are permanent magnets. This displays the non-uniformity of the magnetic field across the region of the cavity where the diamond will be placed, which is one challenge of this setup.</p>
</section>
</section>
<section id="dispersive-readout-model">
<h3>Dispersive Readout Model<a class="headerlink" href="#dispersive-readout-model" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="k">def</span> <span class="nf">sensitivity_disp_readout</span><span class="p">(</span><span class="n">Q</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="n">V</span><span class="p">,</span> <span class="n">Vd</span><span class="p">):</span>
    <span class="n">Delta</span> <span class="o">=</span> <span class="mf">2e6</span><span class="p">;</span>
<span class="c1">#     f = 0.1;</span>
    <span class="n">f</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">V</span><span class="o">/</span><span class="n">Vd</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">Sphi</span> <span class="o">=</span> <span class="mf">1e-9</span><span class="p">;</span> <span class="c1"># phase noise</span>

    <span class="n">hbar</span> <span class="o">=</span> <span class="mf">1.05e-34</span><span class="p">;</span>  

    <span class="n">gs</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span> 

    <span class="n">muB</span> <span class="o">=</span> <span class="mf">9.27e-24</span><span class="p">;</span> 

<span class="c1">#     rho = np.logspace(8,20,40)*1e6;</span>
    <span class="n">rho</span> <span class="o">=</span> <span class="n">rho</span> <span class="o">*</span> <span class="mf">3.51</span> <span class="o">/</span> <span class="mf">12.01</span> <span class="o">*</span> <span class="mf">6.022e23</span>

    <span class="n">Tc</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="mf">3.3e-19</span><span class="o">/</span><span class="p">(</span><span class="n">rho</span><span class="o">*</span><span class="p">(</span><span class="mf">0.95</span><span class="o">/</span><span class="mf">0.05</span><span class="p">));</span>

    <span class="n">T2c</span> <span class="o">=</span> <span class="mf">300e-6</span><span class="p">;</span>

    <span class="n">T2</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">T2c</span><span class="o">+</span><span class="mi">1</span><span class="o">/</span><span class="n">Tc</span><span class="p">);</span>

    <span class="n">mu0</span> <span class="o">=</span> <span class="mi">4</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="mf">1e-7</span><span class="p">;</span>

    <span class="n">C</span> <span class="o">=</span> <span class="mf">0.015</span><span class="p">;</span>
    <span class="n">etaB</span> <span class="o">=</span> <span class="mi">8</span> <span class="o">*</span> <span class="nb">pow</span><span class="p">((</span><span class="n">hbar</span><span class="o">/</span><span class="n">gs</span><span class="o">/</span><span class="n">muB</span><span class="p">),</span><span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="n">Delta</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="n">Q</span><span class="o">/</span><span class="n">T2</span> <span class="o">*</span> <span class="n">Sphi</span> <span class="o">*</span> <span class="mi">1</span><span class="o">/</span><span class="n">mu0</span><span class="o">/</span><span class="n">hbar</span><span class="o">/</span><span class="n">rho</span> <span class="o">*</span><span class="n">f</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="nb">pow</span><span class="p">((</span><span class="n">T2</span><span class="o">/</span><span class="n">T2c</span><span class="p">),</span><span class="mi">3</span><span class="p">))</span><span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">T2</span><span class="o">/</span><span class="n">Tc</span><span class="p">)</span><span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="mf">1e-6</span><span class="o">/</span><span class="n">T2</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">etaB</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Qlist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">101</span><span class="p">)</span>   <span class="c1">#quality factor</span>

<span class="n">PowerList</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">70</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">51</span><span class="p">)</span>
<span class="n">vot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="n">PowerList</span> <span class="o">/</span> <span class="mi">10</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1e-3</span> <span class="o">*</span> <span class="mi">50</span><span class="p">)</span>
<span class="n">Vd</span> <span class="o">=</span> <span class="mf">3e-3</span> <span class="o">*</span> <span class="mf">3e-3</span> <span class="o">*</span> <span class="mf">0.9e-3</span>   <span class="c1">#diamond volume</span>
<span class="n">Vlist</span> <span class="o">=</span> <span class="n">Vd</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">101</span><span class="p">)</span>   <span class="c1">#cavity mode volume</span>
<span class="n">mu0</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="mf">1e-7</span>   
<span class="n">energy</span> <span class="o">=</span> <span class="mf">6.626e-34</span> <span class="o">*</span> <span class="mf">2.87e9</span>   <span class="c1">#h*omega</span>
<span class="n">rho</span> <span class="o">=</span> <span class="mi">4</span>

<span class="n">sens_V_Q</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">Vlist</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">Qlist</span><span class="p">)))</span>

<span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Vlist</span><span class="p">)):</span>
    <span class="n">V</span> <span class="o">=</span> <span class="n">Vlist</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Qlist</span><span class="p">)):</span>
        <span class="n">Q</span> <span class="o">=</span> <span class="n">Qlist</span><span class="p">[</span><span class="n">jj</span><span class="p">]</span>   <span class="c1"># Quality factor</span>
        <span class="n">sens_V_Q</span><span class="p">[</span><span class="n">ii</span><span class="p">,</span><span class="n">jj</span><span class="p">]</span> <span class="o">=</span> <span class="n">sensitivity_disp_readout</span><span class="p">(</span><span class="n">Q</span><span class="p">,</span><span class="n">rho</span><span class="p">,</span> <span class="n">V</span><span class="p">,</span> <span class="n">Vd</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">matplotlib.colors</span> <span class="kn">import</span> <span class="n">LogNorm</span>

<span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">Qlist</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">energy</span> <span class="o">*</span> <span class="p">(</span><span class="mf">28e9</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">mu0</span> <span class="o">/</span> <span class="mi">3</span> <span class="o">/</span> <span class="n">Vlist</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">Y</span><span class="p">,</span> <span class="n">sens_V_Q</span><span class="p">,</span> <span class="n">shading</span><span class="o">=</span><span class="s1">'auto'</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">LogNorm</span><span class="p">(),</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">'hot'</span><span class="p">)</span>

<span class="c1"># Add color bar and label it</span>
<span class="n">cbar</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
<span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="sa">r</span><span class="s1">'$\eta$ (T/$\sqrt</span><span class="si">{Hz}</span><span class="s1">$)'</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">270</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">22</span><span class="p">)</span>
<span class="n">cbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>

<span class="n">contour</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">Y</span><span class="p">,</span> <span class="n">sens_V_Q</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="p">[</span><span class="mf">1e-16</span><span class="p">,</span><span class="mf">1e-15</span><span class="p">,</span> <span class="mf">1e-14</span><span class="p">,</span> <span class="mf">1e-13</span><span class="p">,</span> <span class="mf">1e-12</span><span class="p">],</span> <span class="n">colors</span><span class="o">=</span><span class="s1">'w'</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xscale</span><span class="p">(</span><span class="s1">'log'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yscale</span><span class="p">(</span><span class="s1">'log'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="mf">1e2</span><span class="p">,</span> <span class="mf">8e5</span><span class="p">])</span>
<span class="c1"># plt.ylim([9e-3, 300])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="mf">3e-4</span><span class="p">,</span> <span class="mi">20</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">'$g_</span><span class="si">{s}</span><span class="s1">$(Hz)'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">'Q'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">fmt</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s1">'</span><span class="si">{</span><span class="n">x</span><span class="si">:</span><span class="s1">.1e</span><span class="si">}</span><span class="s1"> T/$\sqrt</span><span class="se">{{</span><span class="s1">Hz</span><span class="se">}}</span><span class="s1">$'</span>  <span class="c1"># Replace 'units' with your desired unit</span>
<span class="n">plt</span><span class="o">.</span><span class="n">clabel</span><span class="p">(</span><span class="n">contour</span><span class="p">,</span> <span class="n">inline</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">18</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="n">fmt</span><span class="p">)</span>

<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">'both'</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">'major'</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>  <span class="c1"># Major tick labels</span>

<span class="c1"># Compute sensitivity for some of the cavity designs from Choi &amp; Englund "Ultrastrong magnetic light-matter interaction with cavity mode engineering"</span>
<span class="n">double_reentrance</span> <span class="o">=</span> <span class="p">((</span><span class="mf">9e-7</span><span class="p">,</span> <span class="mf">2e3</span><span class="p">),</span> <span class="p">(</span><span class="mf">4e-6</span><span class="p">,</span> <span class="mf">4e3</span><span class="p">),</span> <span class="p">(</span><span class="mf">2e-5</span><span class="p">,</span> <span class="mf">1e4</span><span class="p">),</span> <span class="p">(</span><span class="mf">2e-4</span><span class="p">,</span> <span class="mf">4e4</span><span class="p">),</span> <span class="p">(</span><span class="mf">1e-3</span><span class="p">,</span> <span class="mf">8e4</span><span class="p">),</span> <span class="p">(</span><span class="mf">4e-3</span><span class="p">,</span> <span class="mf">1e5</span><span class="p">))</span>
<span class="n">dr_y_values</span><span class="p">,</span> <span class="n">dr_x_values</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">double_reentrance</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">dr_x_values</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">energy</span> <span class="o">*</span> <span class="p">(</span><span class="mf">28e9</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">mu0</span> <span class="o">/</span> <span class="mi">3</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">dr_y_values</span><span class="p">)</span><span class="o">*</span> <span class="p">(</span><span class="mf">3e8</span><span class="o">/</span><span class="mf">2.87e9</span><span class="p">)</span><span class="o">**</span><span class="mi">3</span><span class="p">)),</span> <span class="n">color</span><span class="o">=</span><span class="s1">'blue'</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">dr_x_values</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">energy</span> <span class="o">*</span> <span class="p">(</span><span class="mf">28e9</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">mu0</span> <span class="o">/</span> <span class="mi">3</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">dr_y_values</span><span class="p">)</span><span class="o">*</span> <span class="p">(</span><span class="mf">3e8</span><span class="o">/</span><span class="mf">2.87e9</span><span class="p">)</span><span class="o">**</span><span class="mi">3</span><span class="p">)),</span> <span class="n">color</span><span class="o">=</span><span class="s1">'blue'</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'Double Re-entrance'</span><span class="p">)</span>
<span class="c1"># long_squeeze = ((7e-4,2e3), (3e-3,1e4), (7e-3, 2e4), (1e-2,4e4), (4e-2,9e4), (7e-2,1e5), (1e-1,2e5))</span>
<span class="c1"># long_y_values, long_x_values = zip(*long_squeeze)</span>
<span class="c1"># plt.scatter(np.array(long_x_values), np.sqrt(energy * (28e9)**2 * mu0 / 3 / (np.array(long_y_values)* (3e8/2.87e9))), color='white', s=50, zorder=5, label='Longitudinally Squeezed')</span>
<span class="n">tapered</span> <span class="o">=</span> <span class="p">((</span><span class="mf">1e-7</span><span class="p">,</span> <span class="mf">2e3</span><span class="p">),</span> <span class="p">(</span><span class="mf">7e-7</span><span class="p">,</span><span class="mf">7e3</span><span class="p">),</span> <span class="p">(</span><span class="mf">2e-6</span><span class="p">,</span> <span class="mf">1e4</span><span class="p">),(</span><span class="mf">5e-5</span><span class="p">,</span><span class="mf">5e4</span><span class="p">))</span>
<span class="n">tapered_y_values</span><span class="p">,</span> <span class="n">tapered_x_values</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">tapered</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">tapered_x_values</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">energy</span> <span class="o">*</span> <span class="p">(</span><span class="mf">28e9</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">mu0</span> <span class="o">/</span> <span class="mi">3</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">tapered_y_values</span><span class="p">)</span><span class="o">*</span> <span class="p">(</span><span class="mf">3e8</span><span class="o">/</span><span class="mf">2.87e9</span><span class="p">)</span><span class="o">**</span><span class="mi">3</span><span class="p">)),</span> <span class="n">color</span><span class="o">=</span><span class="s1">'green'</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">tapered_x_values</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">energy</span> <span class="o">*</span> <span class="p">(</span><span class="mf">28e9</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">mu0</span> <span class="o">/</span> <span class="mi">3</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">tapered_y_values</span><span class="p">)</span><span class="o">*</span> <span class="p">(</span><span class="mf">3e8</span><span class="o">/</span><span class="mf">2.87e9</span><span class="p">)</span><span class="o">**</span><span class="mi">3</span><span class="p">)),</span> <span class="n">color</span><span class="o">=</span><span class="s1">'green'</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'Tapered Double Re-entrance'</span><span class="p">)</span>

<span class="n">V_comsol</span> <span class="o">=</span> <span class="mf">1.128e-16</span><span class="o">/</span><span class="p">((</span><span class="mf">1.8026e-5</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="n">Q_comsol</span> <span class="o">=</span> <span class="mf">3.1972e9</span> <span class="o">*</span> <span class="n">mu0</span> <span class="o">*</span><span class="mf">1.128e-16</span> <span class="o">/</span><span class="mf">2.2154e-14</span><span class="o">/</span><span class="mf">1e-3</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">Q_comsol</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">6.626e-34</span> <span class="o">*</span> <span class="mf">3.1972e9</span> <span class="o">*</span> <span class="p">(</span><span class="mf">28e9</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">mu0</span> <span class="o">/</span> <span class="mi">3</span> <span class="o">/</span> <span class="n">V_comsol</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">'violet'</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'COMSOL Model'</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">energy</span> <span class="o">*</span> <span class="p">(</span><span class="mf">28e9</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">mu0</span> <span class="o">/</span> <span class="mi">3</span> <span class="o">/</span> <span class="n">Vd</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/dcb96101a6e981cbf5058b20145af8818fdbcd6620c663d02f92e5f49b882559.png" src="_images/dcb96101a6e981cbf5058b20145af8818fdbcd6620c663d02f92e5f49b882559.png"/>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">min_power_disp</span><span class="p">(</span><span class="n">max_sens</span><span class="p">,</span> <span class="n">V</span><span class="p">,</span> <span class="n">Q</span><span class="p">):</span>
    <span class="c1"># Locate the minimum power that can achieve some sensitivity value max_sense or better based on linear scaling</span>
    <span class="c1"># of optical power with number of NVs</span>
    
    <span class="n">P_per_NV</span> <span class="o">=</span> <span class="mi">8</span><span class="o">/</span><span class="p">(</span><span class="mf">3e-3</span><span class="o">*</span><span class="mf">3e-3</span><span class="o">*</span><span class="mf">0.9e-3</span><span class="o">*</span><span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="mf">3.51</span> <span class="o">/</span> <span class="mf">12.01</span> <span class="o">*</span> <span class="mf">6.022e23</span><span class="p">))</span>
    <span class="c1"># P_per_NV = 5/(1e14)</span>
    <span class="n">rholist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">50</span><span class="p">)</span> <span class="o">*</span> <span class="mi">5</span>
    <span class="n">Vdlist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">50</span><span class="p">)</span> <span class="o">*</span> <span class="mf">3e-3</span><span class="o">*</span><span class="mf">3e-3</span><span class="o">*</span><span class="mf">0.9e-3</span>
    <span class="n">powers</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">Vds</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">rhos</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Vdlist</span><span class="p">)):</span>
        <span class="n">Vd</span><span class="o">=</span><span class="n">Vdlist</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">rholist</span><span class="p">)):</span>
            <span class="n">rho</span><span class="o">=</span><span class="n">rholist</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
            <span class="n">rhomax</span> <span class="o">=</span> <span class="mf">0.1231</span> <span class="o">*</span> <span class="mi">4</span> <span class="o">*</span> <span class="mf">1e-6</span> <span class="o">/</span> <span class="n">Vd</span>
            <span class="k">if</span> <span class="n">rho</span><span class="o">&gt;</span><span class="n">rhomax</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">sensi</span> <span class="o">=</span> <span class="n">sensitivity_disp_readout</span><span class="p">(</span><span class="n">Q</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="n">V</span><span class="p">,</span> <span class="n">Vd</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">sensi</span> <span class="o">&lt;</span> <span class="n">max_sens</span><span class="p">:</span>
                <span class="n">power</span> <span class="o">=</span> <span class="n">P_per_NV</span> <span class="o">*</span> <span class="n">Vd</span> <span class="o">*</span> <span class="p">(</span><span class="n">rho</span> <span class="o">*</span> <span class="mf">3.51</span> <span class="o">/</span> <span class="mf">12.01</span> <span class="o">*</span> <span class="mf">6.022e23</span><span class="p">)</span> 
                <span class="n">powers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">power</span><span class="p">)</span>
                <span class="n">Vds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Vd</span><span class="p">)</span>
                <span class="n">rhos</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rho</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">powers</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>
    <span class="n">min_index</span> <span class="o">=</span> <span class="n">powers</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">powers</span><span class="p">))</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">powers</span><span class="p">[</span><span class="n">min_index</span><span class="p">],</span> <span class="n">Vds</span><span class="p">[</span><span class="n">min_index</span><span class="p">],</span> <span class="n">rhos</span><span class="p">[</span><span class="n">min_index</span><span class="p">]]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># See what the minimum power is to reach some sensitivity value or better (100fT/sqrt(Hz) in this case)</span>
<span class="c1"># for different combinations of mode volume and quality factor</span>

<span class="n">Qlist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">101</span><span class="p">)</span>   <span class="c1">#quality factor</span>
<span class="n">Vd_ref</span> <span class="o">=</span> <span class="mf">3e-3</span> <span class="o">*</span> <span class="mf">3e-3</span> <span class="o">*</span> <span class="mf">0.9e-3</span>   <span class="c1">#diamond volume for reference</span>
<span class="n">Vlist</span> <span class="o">=</span> <span class="n">Vd_ref</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">101</span><span class="p">)</span>   <span class="c1">#cavity mode volume</span>
<span class="n">mu0</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="mf">1e-7</span>   
<span class="n">energy</span> <span class="o">=</span> <span class="mf">6.626e-34</span> <span class="o">*</span> <span class="mf">2.87e9</span>   <span class="c1">#h*omega</span>

<span class="n">max_sens</span> <span class="o">=</span> <span class="mf">1e-15</span>

<span class="n">sens_args</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">Vlist</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">Qlist</span><span class="p">)),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)</span>
<span class="n">opt_power_lin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">Vlist</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">Qlist</span><span class="p">)))</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Vlist</span><span class="p">)):</span>
    <span class="n">V</span><span class="o">=</span><span class="n">Vlist</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Qlist</span><span class="p">)):</span>
        <span class="n">Q</span><span class="o">=</span><span class="n">Qlist</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
        <span class="n">power</span><span class="p">,</span> <span class="n">Vd</span><span class="p">,</span> <span class="n">rho</span> <span class="o">=</span>  <span class="n">min_power_disp</span><span class="p">(</span><span class="n">max_sens</span><span class="p">,</span> <span class="n">V</span><span class="p">,</span> <span class="n">Q</span><span class="p">)</span>
        <span class="n">opt_power_lin</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">power</span>
        <span class="n">sens_args</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">Vd</span><span class="p">,</span><span class="n">rho</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">KeyboardInterrupt</span><span class="g g-Whitespace">                         </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">43</span><span class="p">],</span> <span class="n">line</span> <span class="mi">18</span>
<span class="g g-Whitespace">     </span><span class="mi">16</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Qlist</span><span class="p">)):</span>
<span class="g g-Whitespace">     </span><span class="mi">17</span>     <span class="n">Q</span><span class="o">=</span><span class="n">Qlist</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
<span class="ne">---&gt; </span><span class="mi">18</span>     <span class="n">power</span><span class="p">,</span> <span class="n">Vd</span><span class="p">,</span> <span class="n">rho</span> <span class="o">=</span>  <span class="n">min_power_disp</span><span class="p">(</span><span class="n">max_sens</span><span class="p">,</span> <span class="n">V</span><span class="p">,</span> <span class="n">Q</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">19</span>     <span class="n">opt_power_lin</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">power</span>
<span class="g g-Whitespace">     </span><span class="mi">20</span>     <span class="n">sens_args</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">Vd</span><span class="p">,</span><span class="n">rho</span><span class="p">])</span>

<span class="nn">Cell In[42], line 19,</span> in <span class="ni">min_power_disp</span><span class="nt">(max_sens, V, Q)</span>
<span class="g g-Whitespace">     </span><span class="mi">17</span> <span class="k">if</span> <span class="n">rho</span><span class="o">&gt;</span><span class="n">rhomax</span><span class="p">:</span>
<span class="g g-Whitespace">     </span><span class="mi">18</span>     <span class="k">continue</span>
<span class="ne">---&gt; </span><span class="mi">19</span> <span class="n">sensi</span> <span class="o">=</span> <span class="n">sensitivity_disp_readout</span><span class="p">(</span><span class="n">Q</span><span class="p">,</span> <span class="n">rho</span><span class="p">,</span> <span class="n">V</span><span class="p">,</span> <span class="n">Vd</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">20</span> <span class="k">if</span> <span class="n">sensi</span> <span class="o">&lt;</span> <span class="n">max_sens</span><span class="p">:</span>
<span class="g g-Whitespace">     </span><span class="mi">21</span>     <span class="n">power</span> <span class="o">=</span> <span class="n">P_per_NV</span> <span class="o">*</span> <span class="n">Vd</span> <span class="o">*</span> <span class="p">(</span><span class="n">rho</span> <span class="o">*</span> <span class="mf">3.51</span> <span class="o">/</span> <span class="mf">12.01</span> <span class="o">*</span> <span class="mf">6.022e23</span><span class="p">)</span> 

<span class="nn">Cell In[39], line 28,</span> in <span class="ni">sensitivity_disp_readout</span><span class="nt">(Q, rho, V, Vd)</span>
<span class="g g-Whitespace">     </span><span class="mi">25</span> <span class="n">mu0</span> <span class="o">=</span> <span class="mi">4</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="mf">1e-7</span><span class="p">;</span>
<span class="g g-Whitespace">     </span><span class="mi">27</span> <span class="n">C</span> <span class="o">=</span> <span class="mf">0.015</span><span class="p">;</span>
<span class="ne">---&gt; </span><span class="mi">28</span> <span class="n">etaB</span> <span class="o">=</span> <span class="mi">8</span> <span class="o">*</span> <span class="nb">pow</span><span class="p">((</span><span class="n">hbar</span><span class="o">/</span><span class="n">gs</span><span class="o">/</span><span class="n">muB</span><span class="p">),</span><span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="n">Delta</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="n">Q</span><span class="o">/</span><span class="n">T2</span> <span class="o">*</span> <span class="n">Sphi</span> <span class="o">*</span> <span class="mi">1</span><span class="o">/</span><span class="n">mu0</span><span class="o">/</span><span class="n">hbar</span><span class="o">/</span><span class="n">rho</span> <span class="o">*</span><span class="n">f</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="nb">pow</span><span class="p">((</span><span class="n">T2</span><span class="o">/</span><span class="n">T2c</span><span class="p">),</span><span class="mi">3</span><span class="p">))</span><span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">T2</span><span class="o">/</span><span class="n">Tc</span><span class="p">)</span><span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="mf">1e-6</span><span class="o">/</span><span class="n">T2</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">29</span> <span class="k">return</span> <span class="n">etaB</span>

<span class="ne">KeyboardInterrupt</span>: 
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">matplotlib.colors</span> <span class="kn">import</span> <span class="n">LogNorm</span>

<span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">Qlist</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">energy</span> <span class="o">*</span> <span class="p">(</span><span class="mf">28e9</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">mu0</span> <span class="o">/</span> <span class="mi">3</span> <span class="o">/</span> <span class="n">Vlist</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">Y</span><span class="p">,</span> <span class="n">opt_power_lin</span><span class="p">,</span> <span class="n">shading</span><span class="o">=</span><span class="s1">'auto'</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">LogNorm</span><span class="p">(),</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">'hot'</span><span class="p">)</span>

<span class="c1"># Add color bar and label it</span>
<span class="n">cbar</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
<span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">'Power (W)'</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">270</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>

<span class="c1"># contour = plt.contour(X,Y, sensitivity, levels=[1.3e-14, 1e-13, 1e-12, 1e-11], colors='w', linewidths=2)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xscale</span><span class="p">(</span><span class="s1">'log'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yscale</span><span class="p">(</span><span class="s1">'log'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="mf">1e2</span><span class="p">,</span> <span class="mf">8e5</span><span class="p">])</span>
<span class="c1"># plt.ylim([9e-3, 300])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="mf">3e-4</span><span class="p">,</span> <span class="mi">20</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">'Minimum power at </span><span class="si">{</span><span class="n">max_sens</span><span class="si">}</span><span class="s1"> T/$\sqrt</span><span class="se">{{</span><span class="s1">Hz</span><span class="se">}}</span><span class="s1">$ Sensitivity'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">'$g_</span><span class="si">{s}</span><span class="s1">$(Hz)'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">'Q'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/fad76a7cf35fe88340865c80fd9fd3b27b85ba0d8e87a077c719edbffdfbb10d.png" src="_images/fad76a7cf35fe88340865c80fd9fd3b27b85ba0d8e87a077c719edbffdfbb10d.png"/>
</div>
</div>
</section>
</section>
</section>
<script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
<script>kernelName = 'python3'</script>
</article>
<footer class="prev-next-footer d-print-none">
<div class="prev-next-area">
<a class="left-prev" href="TEMPLATES/TEMPLATE-6.2410-summary-report.html" title="previous page">
<i class="fa-solid fa-angle-left"></i>
<div class="prev-next-info">
<p class="prev-next-subtitle">previous</p>
<p class="prev-next-title">Summary Report Template</p>
</div>
</a>
</div>
</footer>
</div>
<dialog id="pst-secondary-sidebar-modal"></dialog>
<div class="bd-sidebar-secondary bd-toc" id="pst-secondary-sidebar"><div class="sidebar-secondary-items sidebar-secondary__inner">
<div class="sidebar-secondary-item">
<div class="page-toc tocsection onthispage">
<i class="fa-solid fa-list"></i> Contents
  </div>
<nav class="bd-toc-nav page-toc">
<ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#cavity-coupled-quantum-electrodynamic-qed-sensor">Cavity-coupled quantum electrodynamic (QED) sensor</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#minimum-detectable-magnetic-field">Minimum detectable magnetic field</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lab-aims">Lab aims</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#sensitivity-model">Sensitivity Model</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#sensitivity-optimization-over-diamond-volume-and-nv-density">Sensitivity Optimization Over Diamond Volume and NV Density</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#sensitivity-optimization-over-cavity-mode-volume-and-quality-factor">Sensitivity Optimization over Cavity Mode Volume and Quality Factor</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#power-scaling">Power Scaling</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#linear-scaling">Linear Scaling</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#power-optimization">Power Optimization</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#current-experimental-setup">Current Experimental Setup</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Power Optimization</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#note-this-next-three-cells-are-commented-out-because-this-process-takes-a-long-time-to-run">NOTE: This next three cells are commented out because this process takes a long time to run</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#a-more-rigorous-method">A more rigorous method</a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">Current Experimental Setup</a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">Power Optimization</a></li>
</ul>
</li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">NOTE: This next three cells are commented out because this process takes a long time to run</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#power-optimized-over-diamond-parameters-with-current-resonator">Power Optimized over Diamond Parameters with Current Resonator</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#power-optimized-over-cavity-design-and-diamond-parameters">Power Optimized over Cavity Design and Diamond Parameters</a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#parameter-selection">Parameter Selection</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#high-frequency">High Frequency</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#sensitivity-improvements-at-high-frequency">Sensitivity Improvements at High Frequency</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#power-reduction-at-high-frequency">Power Reduction at High Frequency</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#first-power-model">First Power Model</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#second-power-model">Second Power Model</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#stealth-magnet">Stealth Magnet</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#permanent-magnets">Permanent Magnets</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#dispersive-readout-model">Dispersive Readout Model</a></li>
</ul>
</li>
</ul>
</nav></div>
</div></div>
</div>
<footer class="bd-footer-content">
<div class="bd-footer-content__inner container">
<div class="footer-item">
<p class="component-author">
By Dirk Englund, Donnie Keathley, Jane Heyes, Kevin Chen
</p>
</div>
<div class="footer-item">
<p class="copyright">
    
      © Copyright 2023.
      <br/>
</p>
</div>
<div class="footer-item">
</div>
<div class="footer-item">
</div>
</div>
</footer>
</main>
</div>
</div>
<!-- Scripts loaded after <body> so the DOM is not blocked -->
<script defer="" src="_static/scripts/bootstrap.js?digest=26a4bc78f4c0ddb94549"></script>
<script defer="" src="_static/scripts/pydata-sphinx-theme.js?digest=26a4bc78f4c0ddb94549"></script>
<footer class="bd-footer">
</footer>
<script src="_static/scripts/chattutor.config.js"></script><script src="_static/scripts/chattutor.min.js"></script></body>
</html>